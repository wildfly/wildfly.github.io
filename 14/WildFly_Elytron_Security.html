<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>WildFly Elytron Security</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="WildFly_Elytron_Security" class="book toc2 toc-left">
<div id="header">
<h1>WildFly Elytron Security</h1>
<div class="details">
<span id="revnumber">version 14.0.0.Beta2,</span>
<span id="revdate">2018-08-15T23:20:08Z</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">WildFly Elytron Security Guide</div>
<ul class="sectlevel1">
<li><a href="#about">1. About</a>
<ul class="sectlevel2">
<li><a href="#elytron-authentication">1.1. Authentication</a></li>
<li><a href="#elytron-authorization">1.2. Authorization</a></li>
<li><a href="#ssl-tls">1.3. SSL / TLS</a></li>
<li><a href="#secure-credential-storage">1.4. Secure Credential Storage</a></li>
</ul>
</li>
<li><a href="#General_Elytron_Architecture">2. General Elytron Architecture</a>
<ul class="sectlevel2">
<li><a href="#security-domains">2.1. Security Domains</a></li>
<li><a href="#sasl-authentication">2.2. SASL Authentication</a></li>
<li><a href="#http-authentication">2.3. HTTP Authentication</a></li>
<li><a href="#ssl-tls">2.4. SSL / TLS</a></li>
</ul>
</li>
<li><a href="#Elytron_Subsystem">3. Elytron Subsystem</a>
<ul class="sectlevel2">
<li><a href="#get-started-using-the-elytron-subsystem">3.1. Get Started using the Elytron Subsystem</a></li>
<li><a href="#provided-components">3.2. Provided components</a></li>
<li><a href="#out-of-the-box-configuration">3.3. Out of the Box Configuration</a></li>
<li><a href="#default-application-authentication-configuration">3.4. Default Application Authentication Configuration</a></li>
<li><a href="#default-management-authentication-configuration">3.5. Default Management Authentication Configuration</a></li>
<li><a href="#comparing-legacy-approaches-to-elytron-approaches">3.6. Comparing Legacy Approaches to Elytron Approaches</a></li>
</ul>
</li>
<li><a href="#Using_the_Elytron_Subsystem">4. Using the Elytron Subsystem</a>
<ul class="sectlevel2">
<li><a href="#set-up-and-configure-authentication-for-applications">4.1. Set Up and Configure Authentication for Applications</a></li>
<li><a href="#set-up-and-configure-authentication-for-the-management-interfaces">4.2. Set up and Configure Authentication for the Management Interfaces</a></li>
<li><a href="#configure-ssltls">4.3. Configure SSL/TLS</a></li>
<li><a href="#configuring-the-elytron-and-security-subsystems">4.4. Configuring the Elytron and Security Subsystems</a></li>
<li><a href="#creating-elytron-subsystem-components">4.5. Creating Elytron Subsystem Components</a></li>
</ul>
</li>
<li><a href="#Using_WildFly_Elytron_with_WildFly">5. Using Elytron within WildFly</a>
<ul class="sectlevel2">
<li><a href="#using-the-out-of-the-box-elytron-components">5.1. Using the Out of the Box Elytron Components</a></li>
<li><a href="#undertow-subsystem">5.2. Undertow Subsystem</a></li>
<li><a href="#ejb-subsystem">5.3. EJB Subsystem</a></li>
<li><a href="#webservices-subsystem">5.4. WebServices Subsystem</a></li>
<li><a href="#legacy-security-subsystem">5.5. Legacy Security Subsystem</a></li>
</ul>
</li>
<li><a href="#Client_Authentication_with_Elytron_Client">6. Client Authentication with Elytron Client</a>
<ul class="sectlevel2">
<li><a href="#the-configuration-file-approach">6.1. The Configuration File Approach</a></li>
<li><a href="#the-programmatic-approach">6.2. The Programmatic Approach</a></li>
<li><a href="#the-default-configuration-approach">6.3. The Default Configuration Approach</a></li>
<li><a href="#using-elytron-client-with-clients-deployed-to-wildfly">6.4. Using Elytron Client with Clients Deployed to WildFly</a></li>
<li><a href="#Configuring_other_clients_using_wildfly-config">6.5. Client configuration using wildfly-config.xml</a></li>
</ul>
</li>
<li><a href="#Elytron_and_Java_Authorization_Contract_for_Containers-JACC">7. Elytron and Java Authorization Contract for Containers (JACC)</a>
<ul class="sectlevel2">
<li><a href="#disabling-jacc-in-legacy-security-subsystem-picketbox">7.1. Disabling JACC in Legacy Security Subsystem (PicketBox)</a></li>
<li><a href="#defining-a-jacc-policy-provider">7.2. Defining a JACC Policy Provider</a></li>
<li><a href="#enabling-jacc-to-a-web-deployment">7.3. Enabling JACC to a Web Deployment</a></li>
<li><a href="#enabling-jacc-to-a-ejb-deployment">7.4. Enabling JACC to a EJB Deployment</a></li>
</ul>
</li>
<li><a href="#KeyCloak_Integration">8. Using KeyCloak with WildFly Elytron</a></li>
<li><a href="#Bearer_Token_Authorization">9. Bearer Token Authorization</a>
<ul class="sectlevel2">
<li><a href="#how-it-works">9.1. How it Works</a></li>
<li><a href="#validating-jwt-tokens">9.2. Validating JWT Tokens</a></li>
<li><a href="#validating-oauth2-bearer-tokens">9.3. Validating OAuth2 Bearer Tokens</a></li>
<li><a href="#quickstarts">9.4. Quickstarts</a></li>
<li><a href="#cli-examples-on-how-to-create-a-token-realm">9.5. CLI Examples on How to Create a Token Realm</a></li>
</ul>
</li>
<li><a href="#OpenSSL">10. OpenSSL</a></li>
<li><a href="#Web_Single_Sign_On">11. Web Single Sign-On</a>
<ul class="sectlevel2">
<li><a href="#create-a-server-configuration-template">11.1. Create a Server Configuration Template</a></li>
<li><a href="#create-two-server-instances">11.2. Create Two Server Instances</a></li>
<li><a href="#deploy-an-application">11.3. Deploy an Application</a></li>
</ul>
</li>
<li><a href="#Custom_Components">12. Custom Components</a>
<ul class="sectlevel2">
<li><a href="#security-event-listener">12.1. Security event listener</a></li>
<li><a href="#configurable-custom-components">12.2. Configurable custom components</a></li>
</ul>
</li>
<li><a href="#Migrate_Legacy_Security_to_Elytron_Security">13. Migrate Legacy Security to Elytron Security</a>
<ul class="sectlevel2">
<li><a href="#authentication-configuration">13.1. Authentication Configuration</a></li>
<li><a href="#Properties_File_Based_Authentication_Migration">13.2. Properties Based Authentication / Authorization</a></li>
<li><a href="#LDAP_Based_Authentication_Migration">13.3. LDAP Authentication Migration</a></li>
<li><a href="#Composite_Stores_Migration">13.4. Composite Stores Migration</a></li>
<li><a href="#Database_Authentication_Migration">13.5. Database Authentication</a></li>
<li><a href="#Kerberos_Based_Authentication_Migration">13.6. Kerberos Authentication Migration</a></li>
<li><a href="#Caching_Migration">13.7. Caching Migration</a></li>
<li><a href="#clients">13.8. Clients</a></li>
<li><a href="#Application_Client_Migration">13.9. Application Client Migration</a></li>
<li><a href="#general-utilities">13.10. General Utilities</a></li>
<li><a href="#Security_Vault_Migration">13.11. Security Vault Migration</a></li>
<li><a href="#Security_Property_Migration">13.12. Security Properties</a></li>
<li><a href="#ssl-migration">13.13. SSL Migration</a></li>
<li><a href="#Simple_SSL_Migration">13.14. Simple SSL Migration</a></li>
<li><a href="#SSL_with_Client_Cert_Migration">13.15. SSL with Client Cert Migration</a></li>
<li><a href="#documentation-still-needed">13.16. Documentation Still Needed</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="about">1. About</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WildFly Elytron project is a new security framework brought to
WildFly to provide a single unified security framework across the whole
of the application server. As a single framework it will be usable both
for configuring management access to the server and for applications
deployed to the server, it will also be usable across all process types
so there will be no need to learn a different security framework for
host controllers in a domain compared to configuring a standalone
server.</p>
</div>
<div class="paragraph">
<p>The project covers these main areas: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication</p>
</li>
<li>
<p>Authorization</p>
</li>
<li>
<p>SSL / TLS</p>
</li>
<li>
<p>Secure Credential Storage</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="elytron-authentication">1.1. Authentication</h3>
<div class="paragraph">
<p>One of the fundamental objectives of the project was to ensure that we
can use stronger authentication mechanisms for both HTTP and SASL based
authentication, in both cases the new framework also makes it possible
to bring in new implementations opening up various integration
opportunities with external solutions.</p>
</div>
</div>
<div class="sect2">
<h3 id="elytron-authorization">1.2. Authorization</h3>
<div class="paragraph">
<p>The architecture of the project makes a very clear distinction between
the raw representation of the identity as returned by a SecurityRealm
from the repository of identities and the final representation as a
SecurityIdentity after roles have been decoded and mapped and
permissions have been mapped.</p>
</div>
<div class="paragraph">
<p>Custom implementations of the components to perform role decoding and
mapping, and permission mapping can be provided allowing for further
flexibility beyond the default set of components provided by the
project.</p>
</div>
</div>
<div class="sect2">
<h3 id="ssl-tls">1.3. SSL / TLS</h3>
<div class="paragraph">
<p>The project becomes the centralised point within the application server
for configuring SSL related resources meaning they can be configured in
a central location and referenced by resources across the application
server. The centralised configuration also covers advanced options such
as configuration of enabled cipher suites and protocols without this
information needing to be distributed across the management model.</p>
</div>
<div class="paragraph">
<p>The SSL / TLS implementation also includes an optimisation where it can
be closely tied to authentication allowing for permissions checks to be
performed on establishment of a connection before the first request is
received and the eager construction of a SecurityIdentity eliminating
the need for it to be constructed on a per-request basis.</p>
</div>
</div>
<div class="sect2">
<h3 id="secure-credential-storage">1.4. Secure Credential Storage</h3>
<div class="paragraph">
<p>The previous vault used for plain text String encryption is replaced
with a newly designed credential store. in addition to the protection it
offers for the credentials stored within it, the store currently
supports storage of clear text credentials.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="General_Elytron_Architecture">2. General Elytron Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The overall architecture for WildFly Elytron is building up a full
security policy from assembling smaller components together, by default
we include various implementations of the components - in addition to
this, custom implementations of many components can be provided in order
to provide more specialised implementations.</p>
</div>
<div class="paragraph">
<p>Within WildFly the different Elytron components are handled as
capabilities meaning that different implementations can be mixed and
matched, however the different implementations are modelled using
distinct resources. This section contains a number of diagrams to show
the general relationships between different components to provide a high
level view, however the different resource definitions may use different
dependencies depending on their purpose.</p>
</div>
<div class="sect2">
<h3 id="security-domains">2.1. Security Domains</h3>
<div class="paragraph">
<p>Within WildFly Elytron a SecurityDomain can be considered as a security
policy backed by one or more SecurityRealm instances. Resources that
make authorization decisions will be associated with a SecurityDomain,
from the SecurityDomain a SecurityIdentity can be obtained which is a
representation of the current identity, from this the identities roles
and permissions can be checked to make the authorization decision for
the resource.</p>
</div>
<div class="paragraph">
<p>The SecurityDomain is the general wrapper around the policy describing a
resulting SecurityIdentity and makes use of the following components to
define this policy.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NameRewriter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>NameRewriters are used in multiple places within the Elytron
configuration, as their name implies, their purpose is to take a name
and map it to another representation of the name or perform some
normalisation or clean up of the name.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RealmMapper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a SecurityDomain is able to reference multiple SecurityRealms the
RealmMapper is responsible for identifying which SecurityRealm to use
based on the supplied name for authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SecurityRealm</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One more more named SecurityRealms are associated with a SecurityDomain,
the SecurityRealms are the access to the underlying repository of
identities and are used for obtaining credentials to allow
authentication mechanisms to perform verification, for validation of
Evidence and for obtaining the raw AuthorizationIdentity performing the
authentication.</p>
</div>
<div class="paragraph">
<p>Some SecurityRealm implementations are also modifiable so expose an API
that allows for updates to be made to the repository containing the
identities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RoleDecoder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Along with the SecurityRealm association is also a reference to a
RoleDecoder, the RoleDecoder takes the raw AuthorizationIdentity
returned from the SecurityRealm and converts it&#8217;s attributes into roles.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RoleMapper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the roles have been decoded for an identity further mapping can be
applied, this could be as simple at normalising the format of the names
through to adding or removing specific role names. If a RoleMapper is
referenced by the SecurityRealm association that RoleMapper is applied
first before applying the RoleMapper associated with the SecurityDomain.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PrincipalDecoder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A PrincipalDecoder converts from a Principal to a String representation
of a name, one example for this is we have an X500PrincipalDecoder which
is able to extract an attribute from a distinguished name.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PermissionMapper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to having roles a SecurityIdentity can also have a set of
permissions, the PermissionMapper assigns those permissions to the
identity.</p>
</div>
<div class="paragraph">
<p>Different secured resources can be associated with different
SecurityDomains for their authorization decisions, within WildFly
Elytron we have the ability to configure inflow between different
SecurityDomains. The inflow process means that a SecurityIdentity
inflowed into a second SecurityDomain has the mappings of the new
SecurityDomain applied to it so although a common identity may be
calling different resources each of those resources could have a very
different view.</p>
</div>
</div>
<div class="sect2">
<h3 id="sasl-authentication">2.2. SASL Authentication</h3>
<div class="paragraph">
<p>The SaslAuthenticationFactory is an authentication policy for
authentication using SASL authentication mechanisms, in addition to
being a policy it is also a factory for configured authentication
mechanisms backed by a SecurityDomain.</p>
</div>
<div class="paragraph">
<p>The SaslAuthenticationFactory references the following: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SecurityDomain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the security domain that any mechanism authentication will be
performed against.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SaslServerFactory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the general factory for server side SASL authentication
mechanisms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MechanismConfigurationSelector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional configuration can be supplied for the authentication
mechanisms, the configuration will be described in more detail later but
the purpose of the MechanismConfigurationSelector is to obtain
configuration specific to the mechanism selected. This can include
information about realm names a mechanism should present to a remote
client plus additional NameRewriters and RealmMappers to use during the
authentication process.</p>
</div>
<div class="paragraph">
<p>The reason some of the components referenced by the SecurityDomain are
duplicated is so that mechanism specific mappings can be applied.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-authentication">2.3. HTTP Authentication</h3>
<div class="paragraph">
<p>The HttpAuthenticationFactory is an authentication policy for
authentication using HTTP authentication mechanisms, in addition to
being a policy it is also a factory for configured authentication
mechanisms backed by a SecurityDomain.</p>
</div>
<div class="paragraph">
<p>The HttpAuthenticationFactory references the following: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SecurityDomain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the security domain that any mechanism authentication will be
performed against.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HttpServerAuthenticationMechanismFactory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the general factory for server side HTTP authentication
mechanisms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MechanismConfigurationSelector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional configuration can be supplied for the authentication
mechanisms, the configuration will be described in more detail later but
the purpose of the MechanismConfigurationSelector is to obtain
configuration specific to the mechanism selected. This can include
information about realm names a mechanism should present to a remote
client plus additional NameRewriters and RealmMappers to use during the
authentication process.</p>
</div>
<div class="paragraph">
<p>The reason some of the components referenced by the SecurityDomain are
duplicated is so that mechanism specific mappings can be applied.</p>
</div>
</div>
<div class="sect2">
<h3 id="ssl-tls">2.4. SSL / TLS</h3>
<div class="paragraph">
<p>The SSLContext defined within Elytron is a javax.net.ssl.SSLContext
meaning it can be used by anything that uses an SSLContext directly.</p>
</div>
<div class="paragraph">
<p>In addition to the usual configuration for an SSLContext it is possible
to configure additional items such as cipher suites and protocols and
the SSLContext returned will wrap any engines created to set these
values.</p>
</div>
<div class="paragraph">
<p>The SSLContext within Elytron can also reference the following: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KeyManagers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An array of KeyManager instances to be used by the SSLContext, this in
turn can reference a KeyStore to load the keys.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TrustManagers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An array of TrustManager instances to be used by the SSLContext, this in
turn can also reference a KeyStore to load the certificates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SecurityDomain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is optional, however if an SSLContext is configured to reference a
SecurityDomain then verification of a clients certificate can be
performed as an authentication ensuring the appropriate permissions to
Logon are assigned before even allowing the connection to be fully
opened, additionally the SecurityIdentity can be established at the time
the connection is opened and used for any invocations over the
connection.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Elytron_Subsystem">3. Elytron Subsystem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly Elytron is a security framework used to unify security across
the entire application server. The <em>elytron</em> subsystem enables a single
point of configuration for securing both applications and the management
interfaces. WildFly Elytron also provides a set of APIs and SPIs for
providing custom implementations of functionality and integrating with
the <em>elytron</em> subsystem.</p>
</div>
<div class="paragraph">
<p>In addition, there are several other important features of the WildFly
Elytron:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stronger authentication mechanisms for HTTP and SASL authentication.</p>
</li>
<li>
<p>Improved architecture that allows for <em>SecurityIdentities</em> to be
propagated across security domains and transparently transformed ready
to be used for authorization. This transformation takes place using
configurable role decoders, role mappers, and permission mappers.</p>
</li>
<li>
<p>Centralized point for SSL/TLS configuration including cipher suites
and protocols.</p>
</li>
<li>
<p>SSL/TLS optimizations such as eager <em>SecureIdentity</em> construction and
closely tying authorization to establishing an SSL/TLS connection. Eager
<em>SecureIdentity</em> construction eliminates the need for a <em>SecureIdentity</em>
to be constructed on a per-request basis. Closely tying authentication
to establishing an SSL/TLS connection enables permission checks to
happen <em>BEFORE</em> the first request is received.</p>
</li>
<li>
<p>A secure credential store that replaces the previous vault
implementation to store clear text credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The new <em>elytron</em> subsystem exists in parallel to the legacy <em>security</em>
subsystem and legacy core management authentication. Both the legacy and
Elytron methods may be used for securing the management interfaces as
well as providing security for applications.</p>
</div>
<div class="sect2">
<h3 id="get-started-using-the-elytron-subsystem">3.1. Get Started using the Elytron Subsystem</h3>
<div class="paragraph">
<p>To get started using Elytron, refer to these topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the default Elytron components for
<a href="#default-application-authentication-configuration">application</a>
and
<a href="#src-557147_ElytronSubsystem-use-default-elytron-mgmt-auth">management</a>
authentication</p>
</li>
<li>
<p>Secure an application with a new identity store stored in a
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithaFilesystem-BasedIdentityStore">filesystem</a>
or
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithaDatabaseIdentityStore">database</a>.</p>
</li>
<li>
<p>Set up one-way SSL/TLS for
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-one-way-apps">applications</a>
or the
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-one-way-mgmt">management
interfaces</a>.</p>
</li>
<li>
<p>Set up two-way SSL/TLS for
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-two-way-apps">applications</a>
or the
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-two-way-mgmt">management
interfaces</a>.</p>
</li>
<li>
<p><a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-CreateandUseaCredentialStore">Create
a credential store and use it with your SSL/TLS configuration</a>.</p>
</li>
<li>
<p><a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithCertificates">Use
certificate-based authentication with applications</a>.</p>
</li>
<li>
<p><a href="Using_the_Elytron_Subsystem.html#src-557140_safe-id-VXNpbmd0aGVFbHl0cm9uU3Vic3lzdGVtLU92ZXJyaWRlYW5BcHBsaWNhdGlvbidzQXV0aGVudGljYXRpb25Db25maWd1cmF0aW9u">Override
an application&#8217;s authentication configuration</a> with Elytron
authentication.</p>
</li>
<li>
<p><a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithaKerberos-BasedIdentityStore">Configure
Kerberos authentication for applications</a>.</p>
</li>
<li>
<p>Secure
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureAuthenticationwithanLDAP-BasedIdentityStore">applications</a>
and the
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-SecuretheManagementInterfaceswithaNewIdentityStore">management
interfaces</a> with an LDAP-based identity store.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="provided-components">3.2. Provided components</h3>
<div class="paragraph">
<p>Wildfly Elytron provides a default set of implementations in the
<em>elytron</em> subsystem.</p>
</div>
<div class="sect3">
<h4 id="factories">3.2.1. Factories</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-http-server-mechanism-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP server factory
definition where the HTTP server factory is an aggregation of other HTTP
server factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory definition where
the SASL server factory is an aggregation of other SASL server
factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable-http-server-mechanism-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory
definition where the SASL server factory is an aggregation of other SASL
server factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory definition
where the SASL server factory is an aggregation of other SASL server
factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-credential-security-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom credential SecurityFactory
definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http-authentication-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource containing the association of a
security domain with a HttpServerAuthenticationMechanismFactory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kerberos-security-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security factory for obtaining a
GSSCredential for use during authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mechanism-provider-filtering-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory
definition that enables filtering by provider where the factory was
loaded using a provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider-http-server-mechanism-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP server factory
definition where the HTTP server factory is an aggregation of factories
from the provider list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory definition where
the SASL server factory is an aggregation of factories from the provider
list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sasl-authentication-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource containing the association of a
security domain with a SaslServerFactory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-loader-http-server-mechanism-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP server factory
definition where the HTTP server factory is an aggregation of factories
identified using a ServiceLoader</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-loader-sasl-server-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A SASL server factory definition
where the SASL server factory is an aggregation of factories identified
using a ServiceLoader</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="principal-transformers">3.2.2. Principal Transformers</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal transformer definition
where the principal transformer is an aggregation of other principal
transformers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">chained-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal transformer definition where
the principal transformer is a chaining of other principal transformers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal transformer definition
where the principal transformer always returns the same constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom principal transformer
definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A regular expression based principal
transformer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex-validating-principal-transformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A regular expression based
principal transformer which uses the regular expression to validate the
name.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="principal-decoders">3.2.3. Principal Decoders</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal decoder definition where the
principal decoder is an aggregation of other principal decoders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concatenating-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A principal decoder definition where
the principal decoder is a concatenation of other principal decoders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a principal decoder that
always returns the same constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom principal decoder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x500-attribute-principal-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a X500 attribute based
principal decoder.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="realm-mappers">3.2.4. Realm Mappers</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-realm-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a constant realm mapper that
always returns the same value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-realm-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom realm mapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapped-regex-realm-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a realm mapper implementation
that first uses a regular expression to extract the realm name, this is
then converted using the configured mapping of realm names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple-regex-realm-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a simple realm mapper that
attempts to extract the realm name using the capture group from the
regular expression, if that does not provide a match then the delegate
realm mapper is used instead.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="realms">3.2.5. Realms</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A realm definition that is an aggregation of two
realms, one for the authentication steps and one for loading the
identity for the authorization steps.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">caching-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A realm definition that enables caching to another
security realm. Caching strategy is Least Recently Used where least
accessed entries are discarded when maximum number of entries is
reached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-modifiable-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom realm configured as being modifiable
will be expected to implement the ModifiableSecurityRealm interface. By
configuring a realm as being modifiable management operations will be
made available to manipulate the realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom realm definitions can implement either the s
SecurityRealm interface or the ModifiableSecurityRealm interface.
Regardless of which interface is implemented management operations will
not be exposed to manage the realm. However other services that depend
on the realm will still be able to perform a type check and cast to gain
access to the modification API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filesystem-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simple security realm definition backed by the
filesystem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identity-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition where identities are
represented in the management model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition backed by database using JDBC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-store-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition backed by a keystore.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition backed by LDAP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">properties-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition backed by properties
files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">token-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security realm definition capable of validating and
extracting identities from security tokens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trust-managers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A trust manager definition for creating the
TrustManager list as used to create an SSL context.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="permission-mappers">3.2.6. Permission Mappers</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom permission mapper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a logical permission mapper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a simple configured permission
mapper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a permission mapper that
always returns the same constant.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="role-decoders">3.2.7. Role Decoders</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-role-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom RoleDecoder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple-role-decoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a simple RoleDecoder that takes a
single attribute and maps it directly to roles.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="role-mappers">3.2.8. Role Mappers</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">add-prefix-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition for a role mapper that
adds a prefix to each provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">add-suffix-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition for a role mapper that
adds a suffix to each provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constant-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition where a constant set of
roles is always returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition where the role mapper
is an aggregation of other role mappers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition for a role mapper that
performs a logical operation using two referenced role mappers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a custom role mapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapped-role-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role mapper definition for a role mapper that uses
configured mapping of role names to map role names.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ssl-components">3.2.9. SSL Components</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">client-ssl-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An SSLContext for use on the client side of a
connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filtering-key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A filtering keystore definition, which provides a
keystore by filtering a key-store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-managers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A key manager definition for creating the key manager
list as used to create an SSL context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A keystore definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap-key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An LDAP keystore definition, which loads a keystore
from an LDAP server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">server-ssl-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An SSL context for use on the server side of a
connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate-authority-account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A certificate authority account which can
be used to obtain and revoke signed certificates.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="other">3.2.10. Other</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate-providers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An aggregation of two or more Provider[]
resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication-configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An individual authentication
configuration definition, which is used by clients deployed to Wildfly
and other resources for authenticating when making a remote connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An individual authentication context
definition, which is used to supply an ssl-context and
authentication-configuration when clients deployed to Wildfly and other
resources make a remoting connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Credential store to keep alias for sensitive
information such as passwords for external services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dir-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configuration to connect to a directory (LDAP) server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider-loader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A definition for a provider loader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A security domain definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security-property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A definition of a security property to be set.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="out-of-the-box-configuration">3.3. Out of the Box Configuration</h3>
<div class="paragraph">
<p>WildFly provides a set of components configured by default. While these
components are ready to use, the legacy <em>security</em> subsystem and legacy
core management authentication is still used by default. To configure
WildFly to use the these configured components as well as create new
ones, see the <a href="#Using_the_Elytron_Subsystem">Using the Elytron
Subsystem</a> section.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ApplicationDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ApplicationDomain security domain uses
ApplicationRealm and groups-to-roles for authentication. It also uses
default-permission-mapper to assign the login permission.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagementDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ManagementDomain security domain uses two
security realms for authentication: ManagementRealm with groups-to-roles
and local with super-user-mapper. It also uses default-permission-mapper
to assign the login permission.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local (security realm)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The local security realm does no authentication
and sets the identity of principals to $local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ApplicationRealm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ApplicationRealm security realm is a properties
realm that authenticates principals using application-users.properties
and assigns roles using application-roles.properties. These files are
located under jboss.server.config.dir, which by default, maps to
EAP_HOME/standalone/configuration. They are also the same files used by
the legacy security default configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagementRealm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ManagementRealm security realm is a properties
realm that authenticates principals using mgmt-users.properties and
assigns roles using mgmt-groups.properties. These files are located
under jboss.server.config.dir, which by default, maps to
EAP_HOME/standalone/configuration. They are also the same files used by
the legacy security default configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-permission-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default-permission-mapper mapper is a
simple permission mapper that uses the default-permissions permission set
to assign the full set of permissions that an identity would require to
access any services on the server. For example, the default-permission-mapper
mapper uses org.wildfly.extension.batch.jberet.deployment.BatchPermission
specified by the default-permissions permission set to assign permission for
batch jobs. The batch permissions are start, stop, restart, abandon, and read
which aligns with javax.batch.operations.JobOperator. The default-permission-mapper
mapper also uses org.wildfly.security.auth.permission.LoginPermission specified
by the the login-permission permission set to assign the login permission.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local (mapper)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The local mapper is a constant role mapper that maps to
the local security realm. This is used to map authentication to the
local security realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groups-to-roles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The groups-to-roles mapper is a simple-role-decoder
that will decode the groups information of a principal and use it for
the role information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">super-user-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The super-user-mapper mapper is a constant role
mapper that maps the SuperUser role to a principal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management-http-authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The management-http-authentication
http-authentication-factory can be used for doing authentication over
http. It uses the global provider-http-server-mechanism-factory to
filter authentication mechanism and uses ManagementDomain for
authenticating principals. It accepts the DIGEST authentication
mechanisms and exposes it as ManagementRealm to applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application-http-authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application-http-authentication
http-authentication-factory can be used for doing authentication over
http. It uses the global provider-http-server-mechanism-factory to
filter authentication mechanism and uses ApplicationDomain for
authenticating principals. It accepts BASIC and FORM authentication
mechanisms and exposes BASIC as Application Realm to applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global (provider-http-server-mechanism-factory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the HTTP
server factory mechanism definition used to list the provided
authentication mechanisms when creating an http authentication factory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management-sasl-authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The management-sasl-authentication
sasl-authentication-factory can be used for authentication using SASL.
It uses the configured sasl-server-factory to filter authentication
mechanisms, which also uses the global provider-sasl-server-factory to
filter by provider names. management-sasl-authentication uses the
ManagementDomain security domain for authentication of principals. It
also maps authentication using JBOSS-LOCAL-USER mechanisms using the
local realm mapper and authentication using DIGEST-MD5 to
ManagementRealm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application-sasl-authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application-sasl-authentication
sasl-authentication-factory can be used for authentication using SASL.
It uses the configured sasl-server-factory to filter authentication
mechanisms, which also uses the global provider-sasl-server-factory to
filter by provider names. application-sasl-authentication uses the
ApplicationDomain security domain for authentication of principals.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global (provider-sasl-server-factory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the SASL server factory
definition used to create SASL authentication factories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elytron (mechanism-provider-filtering-sasl-server-factor)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is used
to filter which sasl-authentication-factory is used based on the
provider. In this case, elytron will match on the WildFlyElytron
provider name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configured (configurable-sasl-server-factory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is used to filter
sasl-authentication-factory is used based on the mechanism name. In this
case, configured will match on JBOSS-LOCAL-USER and DIGEST-MD5. It also
sets the wildfly.sasl.local-user.default-user to $local.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">combined-providers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is an aggregate provider that aggreates the elytron
and openssl provider loaders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elytron</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A provider loader</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A provider loader</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Default WildFly Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=elytron:read-resource(recursive=<span class="predefined-constant">true</span>)
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">default-authentication-context</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">disallowed-providers</span><span class="delimiter">&quot;</span></span> =&gt; [<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span>],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">final-providers</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">initial-providers</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-properties</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">add-prefix-role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">add-suffix-role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">aggregate-http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">aggregate-principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">aggregate-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">aggregate-providers</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">providers</span><span class="delimiter">&quot;</span></span> =&gt; [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">elytron</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">openssl</span><span class="delimiter">&quot;</span></span>
        ]}},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">aggregate-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">aggregate-role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">aggregate-sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">aggregate-security-event-listener</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">authentication-configuration</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">authentication-context</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">caching-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">certificate-authority-account</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">chained-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">client-ssl-context</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">concatenating-principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">configurable-http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">configurable-sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">configured</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">filters</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">wildfly.sasl.local-user.default-user</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">$local</span><span class="delimiter">&quot;</span></span>},
            <span class="string"><span class="delimiter">&quot;</span><span class="content">protocol</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">elytron</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">server-name</span><span class="delimiter">&quot;</span></span> =&gt; undefined
        }},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">constant-permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">constant-principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">constant-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">constant-realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>}},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">constant-role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">super-user-mapper</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span> =&gt; [<span class="string"><span class="delimiter">&quot;</span><span class="content">SuperUser</span><span class="delimiter">&quot;</span></span>]}},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">credential-store</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-credential-security-factory</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-modifiable-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-role-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">custom-role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">dir-context</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">file-audit-log</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">local-audit</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">JSON</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">audit.log</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.log.dir</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">synchronized</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>
        }},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">filesystem-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">filtering-key-store</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-authentication-factory</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">management-http-authentication</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>}]
                }],
                <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementDomain</span><span class="delimiter">&quot;</span></span>
            },
            <span class="string"><span class="delimiter">&quot;</span><span class="content">application-http-authentication</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [
                    {
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">BASIC</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Application Realm</span><span class="delimiter">&quot;</span></span>}]
                    },
                    {<span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">FORM</span><span class="delimiter">&quot;</span></span>}
                ],
                <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationDomain</span><span class="delimiter">&quot;</span></span>
            }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">identity-realm</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">attribute-name</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">attribute-values</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">$local</span><span class="delimiter">&quot;</span></span>
        }},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-security-factory</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">key-manager</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">key-store</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">key-store-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-key-store</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">logical-permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">logical-role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mapped-regex-realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-provider-filtering-sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">elytron</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">enabling</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">filters</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">provider-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">WildFlyElytron</span><span class="delimiter">&quot;</span></span>}],
            <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span>
        }},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">periodic-rotating-file-audit-log</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">permission-set</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">login-permission</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">permissions</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">class-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.security.auth.permission.LoginPermission</span><span class="delimiter">&quot;</span></span>}]},
            <span class="string"><span class="delimiter">&quot;</span><span class="content">default-permissions</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">permissions</span><span class="delimiter">&quot;</span></span> =&gt; [
                {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">class-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.extension.batch.jberet.deployment.BatchPermission</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">module</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.extension.batch.jberet</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">target-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>
                },
                {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">class-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.transaction.client.RemoteTransactionPermission</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">module</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.transaction.client</span><span class="delimiter">&quot;</span></span>
                },
                {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">class-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.RemoteEJBPermission</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">module</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb-client</span><span class="delimiter">&quot;</span></span>
                }
            ]}
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">policy</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">properties-realm</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-attribute</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-properties</span><span class="delimiter">&quot;</span></span> =&gt; {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">application-roles.properties</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span>
                },
                <span class="string"><span class="delimiter">&quot;</span><span class="content">users-properties</span><span class="delimiter">&quot;</span></span> =&gt; {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">application-users.properties</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">digest-realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>
                }
            },
            <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-attribute</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-properties</span><span class="delimiter">&quot;</span></span> =&gt; {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">mgmt-groups.properties</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span>
                },
                <span class="string"><span class="delimiter">&quot;</span><span class="content">users-properties</span><span class="delimiter">&quot;</span></span> =&gt; {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">mgmt-users.properties</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">digest-realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>
                }
            }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">provider-http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">providers</span><span class="delimiter">&quot;</span></span> =&gt; undefined}},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">provider-loader</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">elytron</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">argument</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">class-names</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">configuration</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">module</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.security.elytron</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; undefined
            },
            <span class="string"><span class="delimiter">&quot;</span><span class="content">openssl</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">argument</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">class-names</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">configuration</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">module</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.openssl</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; undefined
            }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">provider-sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">providers</span><span class="delimiter">&quot;</span></span> =&gt; undefined}},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">regex-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">regex-validating-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-authentication-factory</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">management-sasl-authentication</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [
                    {
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">JBOSS-LOCAL-USER</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>
                    },
                    {
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>}]
                    }
                ],
                <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">configured</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementDomain</span><span class="delimiter">&quot;</span></span>
            },
            <span class="string"><span class="delimiter">&quot;</span><span class="content">application-sasl-authentication</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [
                    {
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">JBOSS-LOCAL-USER</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>
                    },
                    {
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>}]
                    }
                ],
                <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">configured</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationDomain</span><span class="delimiter">&quot;</span></span>
            }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationDomain</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">default-realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">outflow-anonymous</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">false</span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">outflow-security-domains</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">post-realm-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">pre-realm-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">realms</span><span class="delimiter">&quot;</span></span> =&gt; [
                    {
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">role-decoder</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-to-roles</span><span class="delimiter">&quot;</span></span>
                    },
                    {<span class="string"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>}
                ],
                <span class="string"><span class="delimiter">&quot;</span><span class="content">role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">security-event-listener</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">trusted-security-domains</span><span class="delimiter">&quot;</span></span> =&gt; undefined
            },
            <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementDomain</span><span class="delimiter">&quot;</span></span> =&gt; {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">default-realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">outflow-anonymous</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">false</span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">outflow-security-domains</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">post-realm-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">pre-realm-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">realms</span><span class="delimiter">&quot;</span></span> =&gt; [
                    {
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">role-decoder</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-to-roles</span><span class="delimiter">&quot;</span></span>
                    },
                    {
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">super-user-mapper</span><span class="delimiter">&quot;</span></span>
                    }
                ],
                <span class="string"><span class="delimiter">&quot;</span><span class="content">role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">security-event-listener</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">trusted-security-domains</span><span class="delimiter">&quot;</span></span> =&gt; undefined
            }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">server-ssl-context</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">service-loader-http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">service-loader-sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">simple-permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping-mode</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">first</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">permission-mappings</span><span class="delimiter">&quot;</span></span> =&gt; [
                {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">principals</span><span class="delimiter">&quot;</span></span> =&gt; [<span class="string"><span class="delimiter">&quot;</span><span class="content">anonymous</span><span class="delimiter">&quot;</span></span>],
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">permission-sets</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">permission-set</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">default-permissions</span><span class="delimiter">&quot;</span></span>}]
                },
                {
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">match-all</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">permission-sets</span><span class="delimiter">&quot;</span></span> =&gt; [
                        {<span class="string"><span class="delimiter">&quot;</span><span class="content">permission-set</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">login-permission</span><span class="delimiter">&quot;</span></span>},
                        {<span class="string"><span class="delimiter">&quot;</span><span class="content">permission-set</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">default-permissions</span><span class="delimiter">&quot;</span></span>}
                    ]
                }
            ]
        }},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">simple-regex-realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">simple-role-decoder</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">groups-to-roles</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">attribute</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>}},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">size-rotating-file-audit-log</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">syslog-audit-log</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">token-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">trust-manager</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">x500-attribute-principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="default-application-authentication-configuration">3.4. Default Application Authentication Configuration</h3>
<div class="paragraph">
<p>By default, applications are secured using legacy security domains.
Applications must specify a security domain in their <em>web.xml</em> as well
as the authentication method. If no security domain is specified by the
application, WildFly will use the provided <em>other</em> legacy security
domain.</p>
</div>
<div class="sect3">
<h4 id="update-wildfly-to-use-the-default-elytron-components-for-application-authentication">3.4.1. Update WildFly to Use the Default Elytron Components for Application</h4>
<div class="paragraph">
<p>Authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:add(http-authentication-factory=application-http-authentication)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="default-elytron-application-http-authentication-configuration">3.4.2. Default Elytron Application HTTP Authentication Configuration</h4>
<div class="paragraph">
<p>By default, the <em>application-http-authentication</em>
http-authentication-factory is provided for application http
authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=application-http-<span class="key">authentication</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [
            {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">BASIC</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Application Realm</span><span class="delimiter">&quot;</span></span>}]
            },
            {<span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">FORM</span><span class="delimiter">&quot;</span></span>}
        ],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationDomain</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>application-http-authentication</em> http-authentication-factory is
configured to use the <em>ApplicationDomain</em> security domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">ApplicationDomain</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">default-realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">post-realm-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">pre-realm-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">realms</span><span class="delimiter">&quot;</span></span> =&gt; [{
            <span class="string"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">role-decoder</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-to-roles</span><span class="delimiter">&quot;</span></span>
        }],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">trusted-security-domains</span><span class="delimiter">&quot;</span></span> =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>ApplicationDomain</em> security domain is backed by the
<em>ApplicationRealm</em> Elytron security realm, which is a properties-based
realm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>properties-realm=<span class="key">ApplicationRealm</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-attribute</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-properties</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">application-roles.properties</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span>
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">users-properties</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">application-users.properties</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">digest-realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="default-management-authentication-configuration">3.5. Default Management Authentication Configuration</h3>
<div class="paragraph">
<p>By default, the WildFly management interfaces are secured by the legacy
core management authentication.</p>
</div>
<div class="paragraph">
<p><strong>Default Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-<span class="type">interface</span>=<span class="class">http</span>-<span class="type">interface</span>:<span class="class">read</span>-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">allowed-origins</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">console-enabled</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-authentication-factory</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-upgrade</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>},
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-upgrade-enabled</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-protocol</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">remote</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">secure-socket-binding</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">server-name</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">socket-binding</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">management-http</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ssl-context</span><span class="delimiter">&quot;</span></span> =&gt; undefined
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>WildFly does provide <em>management-http-authentication</em> and
<em>management-sasl-authentication</em> in the <em>elytron</em> subsystem for securing
the management interfaces as well.</p>
</div>
<div class="sect3">
<h4 id="update-wildfly-to-use-the-default-elytron-components-for-management-authentication">3.5.1. Update WildFly to Use the Default Elytron Components for Management</h4>
<div class="paragraph">
<p>Authentication</p>
</div>
<div class="sect4">
<h5 id="set-http-authentication-factory-to-use-management-http-authentication">Set http-authentication-factory to use</h5>
<div class="paragraph">
<p>management-http-authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-<span class="type">interface</span>=<span class="class">http</span>-<span class="type">interface</span>:<span class="class">write</span>-attribute( \
  name=http-authentication-factory, \
  value=management-http-authentication \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="set-sasl-authentication-factory-to-use-management-sasl-authentication">Set sasl-authentication-factory to use</h5>
<div class="paragraph">
<p>management-sasl-authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-<span class="type">interface</span>=<span class="class">http</span>-<span class="type">interface</span>:<span class="class">write</span>-attribute( \
  name=http-upgrade.sasl-authentication-factory, \
  value=management-sasl-authentication \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="undefine-security-realm">Undefine security-realm</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-<span class="type">interface</span>=<span class="class">http</span>-<span class="type">interface</span>:<span class="class">undefine</span>-attribute(name=security-realm)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reload-wildfly-for-the-changes-to-take-affect.">Reload WildFly for the changes to take affect.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>The management interfaces are now secured using the default components
provided by the 'elytron' subsystem.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="default-elytron-management-http-authentication-configuration">3.5.2. Default Elytron Management HTTP Authentication Configuration</h4>
<div class="paragraph">
<p>When you access the management interface over HTTP, for example when
using the web-based management console, WildFly will use the
<em>management-http-authentication</em> http-authentication-factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=management-http-<span class="key">authentication</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{
            <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>}]
        }],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementDomain</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>management-http-authentication</em> http-authentication-factory, is
configured to use the <em>ManagementDomain</em> security domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">ManagementDomain</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">default-realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">permission-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">post-realm-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">pre-realm-principal-transformer</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">principal-decoder</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">realms</span><span class="delimiter">&quot;</span></span> =&gt; [
            {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">role-decoder</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-to-roles</span><span class="delimiter">&quot;</span></span>
            },
            {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">super-user-mapper</span><span class="delimiter">&quot;</span></span>
            }
        ],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">role-mapper</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">trusted-security-domains</span><span class="delimiter">&quot;</span></span> =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>ManagementDomain</em> security domain is backed by the
<em>ManagementRealm</em> Elytron security realm, which is a properties-based
realm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>properties-realm=<span class="key">ManagementRealm</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-attribute</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">groups-properties</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">mgmt-groups.properties</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span>
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">plain-text</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">false</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">users-properties</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">mgmt-users.properties</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">relative-to</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="default-elytron-management-cli-authentication">3.5.3. Default Elytron Management CLI Authentication</h4>
<div class="paragraph">
<p>By default, the management CLI ( <em>jboss-cli.sh</em>) is configured to
connect over <em>remotehttp</em>.</p>
</div>
<div class="paragraph">
<p><strong>Default jboss-cli.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss-cli</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:cli:3.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 
    <span class="tag">&lt;default-protocol</span> <span class="attribute-name">use-legacy-override</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>remotehttp<span class="tag">&lt;/default-protocol&gt;</span>
 
    <span class="comment">&lt;!-- The default controller to connect to when 'connect' command is executed w/o arguments --&gt;</span>
    <span class="tag">&lt;default-controller&gt;</span>
        <span class="tag">&lt;protocol&gt;</span>remotehttp<span class="tag">&lt;/protocol&gt;</span>
        <span class="tag">&lt;host&gt;</span>localhost<span class="tag">&lt;/host&gt;</span>
        <span class="tag">&lt;port&gt;</span>9990<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;/default-controller&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will establish a connection over HTTP and use HTTP upgrade to
change the communication protocol to <em>native</em>. The HTTP upgrade
connection is secured in the <em>http-upgrade</em> section of the
<em>http-interface</em> using a <em>sasl-authentication-factory</em>.</p>
</div>
<div class="paragraph">
<p><strong>Example Configuration with Default Components</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/management-<span class="type">interface</span>=<span class="class">http</span>-<span class="type">interface</span>:<span class="class">read</span>-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">allowed-origins</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">console-enabled</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-authentication-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">management-http-authentication</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-upgrade</span><span class="delimiter">&quot;</span></span> =&gt; {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-authentication-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">management-sasl-authentication</span><span class="delimiter">&quot;</span></span>
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-upgrade-enabled</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-protocol</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">remote</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">secure-socket-binding</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-realm</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">server-name</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">socket-binding</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">management-http</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ssl-context</span><span class="delimiter">&quot;</span></span> =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default sasl-authentication-factory is
<em>management-sasl-authentication</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">s</span></span>asl-authentication-factory=management-sasl-<span class="key">authentication</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [
            {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">JBOSS-LOCAL-USER</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>
            },
            {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>}]
            }
        ],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">configured</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementDomain</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>management-sasl-authentication</em> sasl-authentication-factory
specifies <em>JBOSS-LOCAL-USER</em> and <em>DIGEST-MD5</em> mechanisms.</p>
</div>
<div class="paragraph">
<p><strong>JBOSS-LOCAL-USER Realm</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">i</span></span>dentity-realm=<span class="key">local</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">attribute-name</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">attribute-values</span><span class="delimiter">&quot;</span></span> =&gt; undefined,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">$local</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>local</em> Elytron security realm is for handling silent authentication
for local users.</p>
</div>
<div class="paragraph">
<p>The <em>ManagementRealm</em> Elytron security realm is the same realm used in
the <em>management-http-authentication</em> http-authentication-factory.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="comparing-legacy-approaches-to-elytron-approaches">3.6. Comparing Legacy Approaches to Elytron Approaches</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy Approach</th>
<th class="tableblock halign-left valign-top">Elytron Approach</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UsersRoles Login Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication with a Properties
File-Based Identity Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database Login Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication with a Database
Identity Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ldap, LdapExtended, AdvancedLdap, AdvancedADLdap Login Modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication with an LDAP-Based Identity Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate, Certificate Roles Login Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication
with Certificates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos, SPNEGO Login Modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication with a
Kerberos-Based Identity Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos, SPNEGO Login Modules with Fallback</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication
with a Form as a Fallback for Kerberos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RoleMapping Login Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Authentication
with a Mapped Role Mapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and Use a Credential Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy Security Realms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure the Management Interfaces with a New
Identity Store, Silent Authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RBAC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using RBAC with Elytron</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy Security Realms for One-way and Two-way SSL/TLS for Applications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable One-way SSL/TLS for Applications, Enable Two-way SSL/TLS in
WildFly for Applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy Security Realms for One-way and Two-way SSL/TLS for Management
Interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable One-way for the Management Interfaces Using the
Elytron Subsystem, Enable Two-way SSL/TLS for the Management Interfaces
using the Elytron Subsystem</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_the_Elytron_Subsystem">4. Using the Elytron Subsystem</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="set-up-and-configure-authentication-for-applications">4.1. Set Up and Configure Authentication for Applications</h3>
<div class="sect3">
<h4 id="configure-authentication-with-a-properties-file-based-identity-store">4.1.1. Configure Authentication with a Properties File-Based Identity Store</h4>
<div class="sect4">
<h5 id="create-properties-files">Create properties files:</h5>
<div class="paragraph">
<p>You need to create two properties files: one that maps user to passwords
and another that maps users to roles. Usually these files are located in
the <em>jboss.server.config.dir</em> directory and follow the naming convention
<em>*-users.properties</em> and <em>*-roles.properties</em>, but other locations and
names may be used. The <em>*-users.properties</em> file must also contain a
reference to the <em>properties-realm</em>, which you will create in the next
step: <em>#$REALM_NAME=YOUR_PROPERTIES_REALM_NAME$</em></p>
</div>
<div class="paragraph">
<p><strong>Example user to password file: example-users.properties</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>#$REALM_NAME=examplePropRealm$
user1=password123
user2=password123</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example user to roles file: example-roles.properties</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>user1=Admin
user2=Guest</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-properties-realm-in-wildfly">Configure a properties-realm in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>properties-realm=<span class="key">examplePropRealm</span>:add(groups-attribute=groups,groups-properties={path=example-roles.properties,relative-to=jboss.server.config.dir},users-properties={path=example-users.properties,relative-to=jboss.server.config.dir,plain-text=<span class="predefined-constant">true</span>})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the <em>properties-realm</em> is <em>examplePropRealm</em>, which is used
in the previous step in the <em>example-users.properties</em> file. Also, if
your properties files are located outside of <em>jboss.server.config.dir</em>,
then you need to change the <em>path</em> and <em>relative-to</em> values
appropriately.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain">Configure a security-domain:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">exampleSD</span>:add(realms=[{realm=examplePropRealm,role-decoder=groups-to-roles}],default-realm=examplePropRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory">Configure an http-authentication-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=example-http-<span class="key">auth</span>:add(http-server-mechanism-factory=global,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=<span class="constant">BASIC</span>,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:add(http-authentication-factory=example-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-a-filesystem-based-identity-store">4.1.2. Configure Authentication with a Filesystem-Based Identity Store</h4>
<div class="sect4">
<h5 id="chose-a-directory-for-users">Chose a directory for users:</h5>
<div class="paragraph">
<p>You need a directory where your users will be stored. In this example,
we are using a directory called <em>fs-realm-users</em> located in
<em>jboss.server.config.dir</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-filesystem-realm-in-wildfly">Configure a filesystem-realm in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=<span class="key">exampleFsRealm</span>:add(path=fs-realm-users,relative-to=jboss.server.config.dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your directory is located outside of <em>jboss.server.config.dir</em>, then
you need to change the <em>path</em> and <em>relative-to</em> values appropriately.</p>
</div>
</div>
<div class="sect4">
<h5 id="add-a-user">Add a user:</h5>
<div class="paragraph">
<p>When using the <em>filesystem-realm</em>, you can add users using the
management CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=exampleFsRealm/identity=<span class="key">user1</span>:add()
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=exampleFsRealm/identity=<span class="key">user1</span>:set-password( clear={password=<span class="string"><span class="delimiter">&quot;</span><span class="content">password123</span><span class="delimiter">&quot;</span></span>})
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=exampleFsRealm/identity=<span class="key">user1</span>:add-attribute(name=<span class="constant">Roles</span>, value=[<span class="string"><span class="delimiter">&quot;</span><span class="content">Admin</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">Guest</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-a-simple-role-decoder">Add a simple-role-decoder:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">sim</span></span>ple-role-decoder=from-roles-<span class="key">attribute</span>:add(attribute=<span class="constant">Roles</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <em>simple-role-decoder</em> decodes a principal&#8217;s roles from the <em>Roles</em>
attribute. You can change this value if your roles are in a different
attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain-1">Configure a security-domain:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">exampleFsSD</span>:add(realms=[{realm=exampleFsRealm,role-decoder=from-roles-attribute}],default-realm=exampleFsRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory-1">Configure an http-authentication-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=example-fs-http-<span class="key">auth</span>:add(http-server-mechanism-factory=global,security-domain=exampleFsSD,mechanism-configurations=[{mechanism-name=<span class="constant">BASIC</span>,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem-1">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:add(http-authentication-factory=example-fs-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.-1">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>Your application is now using a filesystem-based identity store for
authentication.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-a-database-identity-store">4.1.3. Configure Authentication with a Database Identity Store</h4>
<div class="sect4">
<h5 id="determine-your-database-format-for-usernames-passwords-and-roles">Determine your database format for usernames, passwords, and roles:</h5>
<div class="paragraph">
<p>To set up authentication using a database for an identity store, you
need to determine how your usernames, passwords, and roles are stored in
that database. In this example, we are using a single table with the
following sample data:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">username</th>
<th class="tableblock halign-left valign-top">password</th>
<th class="tableblock halign-left valign-top">roles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guest</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="configure-a-datasource">Configure a datasource:</h5>
<div class="paragraph">
<p>To connect to a database from WildFly, you must have the appropriate
database driver deployed as well as a datasource configured. This
example shows deploying the driver for postgres and configuring a
datasource in WildFly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">deploy <span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/postgresql-<span class="float">9.4</span>.<span class="error">1210</span>.jar
 
data-source add --name=examplePostgresDS --jndi-name=<span class="key">java</span>:jboss/examplePostgresDS --driver-name=postgresql-<span class="float">9.4</span>.<span class="error">1210</span>.jar  --connection-url=<span class="key">jdbc</span>:<span class="key">postgresql</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="key">localhost</span>:<span class="integer">5432</span>/postgresdb --user-name=postgresAdmin --password=mysecretpassword</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-jdbc-realm-in-wildfly">Configure a jdbc-realm in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>jdbc-realm=<span class="key">exampleDbRealm</span>:add(principal-query=[{sql=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT password,roles FROM wildfly_users WHERE username=?</span><span class="delimiter">&quot;</span></span>,data-source=examplePostgresDS,clear-password-mapper={password-index=<span class="integer">1</span>},attribute-mapping=[{index=<span class="integer">2</span>,to=groups}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above example shows how to obtain passwords and roles from a
single <em>principal-query</em>. You can also create additional
<em>principal-query</em> with <em>attribute-mapping</em> attributes if you require
multiple queries to obtain roles or additional authentication or
authorization information.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain-2">Configure a security-domain:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">exampleDbSD</span>:add(realms=[{realm=exampleDbRealm,role-decoder=groups-to-roles}],default-realm=exampleDbRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory-2">Configure an http-authentication-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=example-db-http-<span class="key">auth</span>:add(http-server-mechanism-factory=global,security-domain=exampleDbSD,mechanism-configurations=[{mechanism-name=<span class="constant">BASIC</span>,mechanism-realm-configurations=[{realm-name=exampleDbSD}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem-2">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:add(http-authentication-factory=example-db-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.-2">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-an-ldap-based-identity-store">4.1.4. Configure Authentication with an LDAP-Based Identity Store</h4>
<div class="sect4">
<h5 id="determine-your-ldap-format-for-usernames-passwords-and-roles">Determine your LDAP format for usernames, passwords, and roles:</h5>
<div class="paragraph">
<p>To set up authentication using an LDAP server for an identity store, you
need to determine how your usernames, passwords, and roles are stored.
In this example, we are using the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dn: dc=wildfly,dc=org
dc: wildfly
objectClass: top
objectClass: domain
<span class="error"> </span>
dn: ou=Users,dc=wildfly,dc=org
objectClass: organizationalUnit
objectClass: top
ou: Users
<span class="error"> </span>
dn: uid=jsmith,ou=Users,dc=wildfly,dc=org
objectClass: top
objectClass: person
objectClass: inetOrgPerson
cn: John Smith
sn: smith
uid: jsmith
userPassword: password123
<span class="error"> </span>
dn: ou=Roles,dc=wildfly,dc=org
objectclass: top
objectclass: organizationalUnit
ou: Roles
<span class="error"> </span>
dn: cn=Admin,ou=Roles,dc=wildfly,dc=org
objectClass: top
objectClass: groupOfNames
cn: Admin
member: uid=jsmith,ou=Users,dc=wildfly,dc=org</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-dir-context">Configure a dir-context:</h5>
<div class="paragraph">
<p>To connect to the LDAP server from WildFly, you need to configure a
<em>dir-context</em> that provides the URL as well as the principal used to
connect to the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>dir-context=<span class="key">exampleDC</span>:add(url=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://127.0.0.1:10389</span><span class="delimiter">&quot;</span></span>,principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>,credential-reference={clear-text=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-ldap-realm-in-wildfly">Configure an ldap-realm in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>ldap-realm=<span class="key">exampleLR</span>:add(dir-context=exampleDC,identity-mapping={search-base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=Users,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>,rdn-identifier=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>,user-password-mapper={from=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPassword</span><span class="delimiter">&quot;</span></span>},attribute-mapping=[{filter-base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=Roles,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>,filter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(&amp;(objectClass=groupOfNames)(member={1}))</span><span class="delimiter">&quot;</span></span>,from=<span class="string"><span class="delimiter">&quot;</span><span class="content">cn</span><span class="delimiter">&quot;</span></span>,to=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>}]})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-a-simple-role-decoder-1">Add a simple-role-decoder:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">sim</span></span>ple-role-decoder=from-roles-<span class="key">attribute</span>:add(attribute=<span class="constant">Roles</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain-3">Configure a security-domain:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">exampleLdapSD</span>:add(realms=[{realm=exampleLR,role-decoder=from-roles-attribute}],default-realm=exampleLR,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory-3">Configure an http-authentication-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=example-ldap-http-<span class="key">auth</span>:add(http-server-mechanism-factory=global,security-domain=exampleLdapSD,mechanism-configurations=[{mechanism-name=<span class="constant">BASIC</span>,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows creating an <em>http-authentication-factory</em> using
<em>BASIC</em> authentication, but it could be updated to other mechanisms such
as <em>FORM</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem-3">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:add(http-authentication-factory=example-ldap-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.-3">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> In cases where you configure an LDAP server in the
<em>elytron</em> subsystem for authentication and that LDAP server then becomes
unreachable, WildFly will return a <em>500</em>, or internal server error,
error code when attempting authentication using that unreachable LDAP
server. This behavior differs from the legacy <em>security</em> subsystem,
which will return a <em>401</em>, or unauthorized, error code under the same
conditions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-certificates">4.1.5. Configure Authentication with Certificates</h4>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Before you can set up certificate-based authentication, you
must have two-way SSL configured.</p>
</div>
<div class="sect4">
<h5 id="configure-a-key-store-realm.">Configure a key-store-realm.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store-realm=<span class="key">ksRealm</span>:add(key-store=twoWayTS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must configure this realm with a truststore that contains the
client&#8217;s certificate. The authentication process uses the same
certificate presented by the client during the two-way SSL handshake.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-a-decoder.">Create a Decoder.</h5>
<div class="paragraph">
<p>You need to create a <em>x500-attribute-principal-decoder</em> to decode the
principal you get from your certificate. The below example will decode
the principal based on the first <em>CN</em> value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">x</span></span><span class="integer">500</span>-attribute-principal-decoder=<span class="key">CNDecoder</span>:add(oid=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.5.4.3</span><span class="delimiter">&quot;</span></span>,maximum-segments=<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, if the full <em>DN</em> was
<em>CN=client,CN=client-certificate,DC=example,DC=jboss,DC=org</em>,
<em>CNDecoder</em> would decode the principal as <em>client</em>. This decoded
principal is used as the <em>alias</em> value to lookup a certificate in the
truststore configured in <em>ksRealm</em>.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> The decoded principal * <strong>MUST</strong>* must be the <em>alias</em> value
you set in your server&#8217;s truststore for the client&#8217;s certificate.</p>
</div>
</div>
<div class="sect4">
<h5 id="add-a-constant-role-mapper-for-assigning-roles.">Add a constant-role-mapper for assigning roles.</h5>
<div class="paragraph">
<p>This is example uses a <em>constant-role-mapper</em> to assign roles to a
principal from <em>ksRealm</em> but other approaches may also be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>constant-role-mapper=<span class="key">constantClientCertRole</span>:add(roles=[<span class="constant">Admin</span>,<span class="constant">Guest</span>])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain.">Configure a security-domain.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">exampleCertSD</span>:add(realms=[{realm=ksRealm}],default-realm=ksRealm,permission-mapper=default-permission-mapper,principal-decoder=<span class="constant">CNDecoder</span>,role-mapper=constantClientCertRole)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory.">Configure an http-authentication-factory.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=<span class="key">exampleCertHttpAuth</span>:add(http-server-mechanism-factory=global,security-domain=exampleCertSD,mechanism-configurations=[{mechanism-name=<span class="constant">CLIENT_CERT</span>,mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem.">Configure an application-security-domain in the Undertow subsystem.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:add(http-authentication-factory=exampleCertHttpAuth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="update-server-ssl-context.">Update server-ssl-context.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">twoWaySSC</span>:write-attribute(name=security-domain,value=exampleCertSD)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">twoWaySSC</span>:write-attribute(name=authentication-optional, value=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-and-jboss-web.xml.-4">Configure your application&#8217;s web.xml and jboss-web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>In addition, you need to update your <em>web.xml</em> to use <em>CLIENT-CERT</em> as
its authentication method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
  <span class="tag">&lt;auth-method&gt;</span>CLIENT-CERT<span class="tag">&lt;/auth-method&gt;</span>
  <span class="tag">&lt;realm-name&gt;</span>exampleApplicationDomain<span class="tag">&lt;/realm-name&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-a-kerberos-based-identity-store">4.1.6. Configure Authentication with a Kerberos-Based Identity Store</h4>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: The following steps assume you have a working KDC and
Kerberos domain as well as your client browsers configured.</p>
</div>
<div class="sect4">
<h5 id="configure-a-kerberos-security-factory.">Configure a kerberos-security-factory.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>kerberos-security-factory=<span class="key">krbSF</span>:add(principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/host@REALM</span><span class="delimiter">&quot;</span></span>,path=<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/http.keytab</span><span class="delimiter">&quot;</span></span>,mechanism-oids=[<span class="float">1.2</span>.<span class="error">840.113554</span>.<span class="error">1.2</span>.<span class="error">2</span>,<span class="float">1.3</span>.<span class="error">6.1</span>.<span class="error">5.5</span>.<span class="error">2</span>])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-the-system-properties-for-kerberos.">Configure the system properties for Kerberos.</h5>
<div class="paragraph">
<p>Depending on how your environment is configured, you will need to set
some of the system properties below.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.kdc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host name of the KDC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.security.krb5.conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the configuration krb5.conf file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sun.security.krb5.debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, debugging mode will be enabled.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To configure a system property in WildFly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/system-property=java.security.krb5.conf:add(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/krb5.conf</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-eltyron-security-realm-for-assigning-roles.">Configure an Eltyron security realm for assigning roles.</h5>
<div class="paragraph">
<p>The the client&#8217;s Kerberos token will provide the principal, but you need
a way to map that principal to a role for your application. There are
several ways to accomplish this, but this example creates a
<em>filesystem-realm</em>, adds a user to the realm that matches the principal
from the Kerberos token, and assigns roles to that user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=<span class="key">exampleFsRealm</span>:add(path=fs-realm-users,relative-to=jboss.server.config.dir)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=exampleFsRealm/identity=user1<span class="instance-variable">@REALM</span><span class="symbol">:add</span>()
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=exampleFsRealm/identity=user1<span class="instance-variable">@REALM</span><span class="symbol">:add</span>-attribute(name=<span class="constant">Roles</span>, value=[<span class="string"><span class="delimiter">&quot;</span><span class="content">Admin</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">Guest</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-a-simple-role-decoder.">Add a simple-role-decoder.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">sim</span></span>ple-role-decoder=from-roles-<span class="key">attribute</span>:add(attribute=<span class="constant">Roles</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <em>simple-role-decoder</em> decodes a principal&#8217;s roles from the <em>Roles</em>
attribute. You can change this value if your roles are in a different
attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-security-domain.-1">Configure a security-domain.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">exampleFsSD</span>:add(realms=[{realm=exampleFsRealm,role-decoder=from-roles-attribute}],default-realm=exampleFsRealm,permission-mapper=default-permission-mapper)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-http-authentication-factory-that-uses-the-kerberos-security-factory.">Configure an http-authentication-factory that uses the</h5>
<div class="paragraph">
<p>kerberos-security-factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=example-krb-http-<span class="key">auth</span>:add(http-server-mechanism-factory=global,security-domain=exampleFsSD,mechanism-configurations=[{mechanism-name=<span class="constant">SPNEGO</span>,mechanism-realm-configurations=[{realm-name=exampleFsSD}],credential-security-factory=krbSF}])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-application-security-domain-in-the-undertow-subsystem-4">Configure an application-security-domain in the Undertow subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:add(http-authentication-factory=example-krb-http-auth)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml-jboss-web.xml-and-jboss-deployment-structure.xml.">Configure your application&#8217;s web.xml, jboss-web.xml and</h5>
<div class="paragraph">
<p>jboss-deployment-structure.xml.</p>
</div>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> and <em>jboss-web.xml</em> must be updated to use
the <em>application-security-domain</em> you configured in WildFly. An example
of this is available in the
<a href="#configure-applications-to-use-elytron-or-legacy-security-for-authentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>
section.</p>
</div>
<div class="paragraph">
<p>In addition, you need to update your <em>web.xml</em> to use <em>SPNEGO</em> as its
authentication method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
  <span class="tag">&lt;auth-method&gt;</span>SPNEGO<span class="tag">&lt;/auth-method&gt;</span>
  <span class="tag">&lt;realm-name&gt;</span>exampleApplicationDomain<span class="tag">&lt;/realm-name&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-authentication-with-a-form-as-a-fallback-for-kerberos">4.1.7. Configure Authentication with a Form as a Fallback for Kerberos</h4>
<div class="sect4">
<h5 id="configure-kerberos-based-authentication.">Configure kerberos-based authentication.</h5>
<div class="paragraph">
<p>Configuring kerberos-based authentication is covered in a previous
section.</p>
</div>
</div>
<div class="sect4">
<h5 id="add-a-mechanism-for-form-authentication-in-the-http-authentication-factory.">Add a mechanism for FORM authentication in the</h5>
<div class="paragraph">
<p>http-authentication-factory.</p>
</div>
<div class="paragraph">
<p>You can use the existing <em>http-authentication-factory</em> you configured
for kerberos-based authentication and and an additional mechanism for
<em>FORM</em> authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=example-krb-http-<span class="key">auth</span>:list-add(name=mechanism-configurations, value={mechanism-name=<span class="constant">FORM</span>})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-additional-fallback-principals.">Add additional fallback principals.</h5>
<div class="paragraph">
<p>The existing configuration for kerberos-based authentication should
already have a security realm configured for mapping principals from
kerberos token to roles for the application. You can add additional
users for fallback authentication to that realm. For example if you used
a <em>filesystem-realm</em>, you can simply create a new user with the
appropriate roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=exampleFsRealm/identity=<span class="key">fallbackUser1</span>:add()
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=exampleFsRealm/identity=<span class="key">fallbackUser1</span>:set-password(clear={password=<span class="string"><span class="delimiter">&quot;</span><span class="content">password123</span><span class="delimiter">&quot;</span></span>})
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filesystem-realm=exampleFsRealm/identity=<span class="key">fallbackUser1</span>:add-attribute(name=<span class="constant">Roles</span>, value=[<span class="string"><span class="delimiter">&quot;</span><span class="content">Admin</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">Guest</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="update-the-web.xml-for-form-fallback.">Update the web.xml for FORM fallback.</h5>
<div class="paragraph">
<p>You need to update the <em>web.xml</em> to use the value <em>SPNEGO,FORM</em> for the
<em>auth-method</em>, which will use <em>FORM</em> as a fallback authentication method
if <em>SPNEGO</em> fails. You also need to specify the location of your login
and error pages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
  <span class="tag">&lt;auth-method&gt;</span>SPNEGO,FORM<span class="tag">&lt;/auth-method&gt;</span>
  <span class="tag">&lt;realm-name&gt;</span>exampleApplicationDomain<span class="tag">&lt;/realm-name&gt;</span>
  <span class="tag">&lt;form-login-config&gt;</span>
    <span class="tag">&lt;form-login-page&gt;</span>/login.jsp<span class="tag">&lt;/form-login-page&gt;</span>
    <span class="tag">&lt;form-error-page&gt;</span>/error.jsp<span class="tag">&lt;/form-error-page&gt;</span>
  <span class="tag">&lt;/form-login-config&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-applications-to-use-elytron-or-legacy-security-for-authentication">4.1.8. Configure Applications to Use Elytron or Legacy Security for</h4>
<div class="paragraph">
<p>Authentication</p>
</div>
<div class="paragraph">
<p>After you have configured the <em>elytron</em> or legacy <em>security</em> subsystems
for authentication, you need to configure your application to use it.</p>
</div>
<div class="sect4">
<h5 id="configure-your-applications-web.xml.">Configure your application&#8217;s web.xml.</h5>
<div class="paragraph">
<p>Your application&#8217;s <em>web.xml</em> needs to be configured to use the
appropriate authentication method. When using <em>elytron</em>, this is defined
in the <em>http-authentication-factory</em> you created. When using the legacy
<em>security</em> subsystem, this depends on your login module and the type of
authentication you want to configure.</p>
</div>
<div class="paragraph">
<p>Example <em>web.xml</em> with <em>BASIC</em> Authentication</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;web-app&gt;</span>
  <span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
      <span class="tag">&lt;web-resource-name&gt;</span>secure<span class="tag">&lt;/web-resource-name&gt;</span>
      <span class="tag">&lt;url-pattern&gt;</span>/secure/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
      <span class="tag">&lt;role-name&gt;</span>Admin<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
  <span class="tag">&lt;/security-constraint&gt;</span>
  <span class="tag">&lt;security-role&gt;</span>
    <span class="tag">&lt;description&gt;</span>The role that is required to log in to /secure/*<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>Admin<span class="tag">&lt;/role-name&gt;</span>
  <span class="tag">&lt;/security-role&gt;</span>
  <span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>BASIC<span class="tag">&lt;/auth-method&gt;</span>
    <span class="tag">&lt;realm-name&gt;</span>exampleApplicationDomain<span class="tag">&lt;/realm-name&gt;</span>
  <span class="tag">&lt;/login-config&gt;</span>
<span class="tag">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-application-to-use-a-security-domain.">Configure your application to use a security domain.</h5>
<div class="paragraph">
<p>You can configure your application&#8217;s <em>jboss-web.xml</em> to specify the
security domain you want to use for authentication. When using the
<em>elytron</em> subsystem, this is defined when you created the
<em>application-security-domain</em>. When using the legacy <em>security</em>
subsystem, this is the name of the legacy security domain.</p>
</div>
<div class="paragraph">
<p>Example <em>jboss-web.xml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss-web&gt;</span>
  <span class="tag">&lt;security-domain&gt;</span>exampleApplicationDomain<span class="tag">&lt;/security-domain&gt;</span>
<span class="tag">&lt;/jboss-web&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <em>jboss-web.xml</em> allows you to configure the security domain for a
single application only. Alternatively, you can specify a default
security domain for all applications using the <em>undertow</em> subsystem.
This allows you to omit using <em>jboss-web.xml</em> to configure a security
domain for an individual application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow:write-attribute(name=default-security-domain, value=&quot;exampleApplicationDomain&quot;)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: Setting <em>default-security-domain</em> in the <em>undertow</em>
subsystem will apply to <strong>ALL</strong> applications. If <em>default-security-domain</em>
is set and an application specifies a security domain in a
<em>jboss-web.xml</em> file, the configuration in <em>jboss-web.xml</em> will override
the <em>default-security-domain</em> in the <em>undertow</em> subsystem.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-elytron-and-legacy-security-subsystems-in-parallel">Using Elytron and Legacy Security Subsystems in Parallel</h5>
<div class="paragraph">
<p>You can define authentication in both the <em>elytron</em> and legacy
<em>security</em> subsystems and use them in parallel. If you use both
<em>jboss-web.xml</em> and <em>default-security-domain</em> in the <em>undertow</em>
subsystem, WildFly will first try to match the configured security
domain in the <em>elytron</em> subsystem. If a match is not found, then WildFly
will attempt to match the security domain with one configured in the
legacy <em>security</em> subsystem. If the <em>elytron</em> and legacy <em>security</em>
subsystem each have a security domain with the same name, the <em>elytron</em>
security domain is used.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="override-an-applications-authentication-configuration">4.1.9. Override an Application&#8217;s Authentication Configuration</h4>
<div class="paragraph">
<p>You can override the authentication configuration of an application with
one configured in WildFly. To do this, use the
<em>override-deployment-configuration</em> property in the
<em>application-security-domain</em> section of the <em>undertow</em> subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:write-attribute(name=override-deployment-config,value=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, an application is configured to use <em>FORM</em> authentication
with the <em>exampleApplicationDomain</em> in its <em>jboss-web.xml</em>.</p>
</div>
<div class="paragraph">
<p><em>Example jboss-web.xml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
  <span class="tag">&lt;auth-method&gt;</span>FORM<span class="tag">&lt;/auth-method&gt;</span>
  <span class="tag">&lt;realm-name&gt;</span>exampleApplicationDomain<span class="tag">&lt;/realm-name&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By enabling <em>override-deployment-configuration</em>, you can create a new
<em>http-authentication-factory</em> that specifies a different authentication
mechanism such as <em>BASIC</em>.</p>
</div>
<div class="paragraph">
<p><em>Example http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=<span class="key">exampleHttpAuth</span>:read-resource()
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-server-mechanism-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{
            <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">BASIC</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">exampleApplicationDomain</span><span class="delimiter">&quot;</span></span>}]
        }],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">exampleSD</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will override the authentication mechanism defined in the
application&#8217;s <em>jboss-web.xml</em> and attempt to authenticate a user using
<em>BASIC</em> instead of <em>FORM</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-and-use-a-credential-store">4.1.10. Create and Use a Credential Store</h4>
<div class="sect4">
<h5 id="create-credential-store.">Create credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>credential-store=<span class="key">exampleCS</span>:add(uri=<span class="string"><span class="delimiter">&quot;</span><span class="content">cr-store://exampleCS?create=true</span><span class="delimiter">&quot;</span></span>,credential-reference={clear-text=cs-secret})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-a-credential-to-a-credential-store.">Add a credential to a credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>credential-store=exampleCS/<span class="keyword">alias</span>=<span class="key">keystorepw</span>:add(secret-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="list-all-credentials-in-a-credential-store.">List all credentials in a credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>credential-store=<span class="key">exampleCS</span>:read-children-names(child-type=<span class="keyword">alias</span>)
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; [<span class="string"><span class="delimiter">&quot;</span><span class="content">keystorepw</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="remove-a-credential-from-a-credential-store.">Remove a credential from a credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>credential-store=exampleCS/<span class="keyword">alias</span>=<span class="key">keystorepw</span>:remove</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-a-credential-store.">Use a credential store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:write-attribute(name=credential-reference,value={store=exampleCS,<span class="keyword">alias</span>=keystorepw})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set-up-and-configure-authentication-for-the-management-interfaces">4.2. Set up and Configure Authentication for the Management Interfaces</h3>
<div class="sect3">
<h4 id="secure-the-management-interfaces-with-a-new-identity-store">4.2.1. Secure the Management Interfaces with a New Identity Store</h4>
<div class="sect4">
<h5 id="create-a-security-domain-and-any-supporting-security-realms-decoders-or-mappers-for-your-identity-store.">Create a security domain and any supporting security realms,</h5>
<div class="paragraph">
<p>decoders, or mappers for your identity store.</p>
</div>
<div class="paragraph">
<p>This process is covered in a previous section. For example, if you
wanted to secure the management interfaces using a filesystem-based
identity store, you would follow the steps in
<a href="#configure-authentication-with-a-filesystem-based-identity-store">Configure
Authentication with a Filesystem-Based Identity Store</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-an-http-authentication-factory-or-sasl-authentication-factory.">Create an http-authentication-factory or</h5>
<div class="paragraph">
<p>sasl-authentication-factory.</p>
</div>
<div class="paragraph">
<p>Example <em>http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>http-authentication-factory=example-http-<span class="key">auth</span>:add(http-server-mechanism-factory=global,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=<span class="constant">DIGEST</span>,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <em>sasl-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">s</span></span>asl-authentication-factory=example-sasl-<span class="key">auth</span>:add(sasl-server-factory=configured,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=<span class="constant">DIGEST</span>-<span class="constant">MD5</span>,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]}])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="update-the-management-interfaces-to-use-your-http-authentication-factory-or-sasl-authentication-factory.">Update the management interfaces to use your</h5>
<div class="paragraph">
<p>http-authentication-factory or sasl-authentication-factory.</p>
</div>
<div class="paragraph">
<p>Example update <em>http-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">core-service=management</span><span class="delimiter">/</span><span class="modifier">m</span></span>anagement-interface=http-<span class="key">interface</span>:write-attribute(name=http-authentication-factory, value=example-http-auth)
{
   <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
   <span class="string"><span class="delimiter">&quot;</span><span class="content">response-headers</span><span class="delimiter">&quot;</span></span> =&gt; {
       <span class="string"><span class="delimiter">&quot;</span><span class="content">operation-requires-reload</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
       <span class="string"><span class="delimiter">&quot;</span><span class="content">process-state</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">reload-required</span><span class="delimiter">&quot;</span></span>
   }
}
 
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example update <em>sasl-authentication-factory</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">core-service=management</span><span class="delimiter">/</span><span class="modifier">m</span></span>anagement-interface=http-<span class="key">interface</span>:write-attribute(name=http-upgrade.sasl-authentication-factory, value=example-sasl-auth)
{
   <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
   <span class="string"><span class="delimiter">&quot;</span><span class="content">response-headers</span><span class="delimiter">&quot;</span></span> =&gt; {
       <span class="string"><span class="delimiter">&quot;</span><span class="content">operation-requires-reload</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span>,
       <span class="string"><span class="delimiter">&quot;</span><span class="content">process-state</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">reload-required</span><span class="delimiter">&quot;</span></span>
   }
}
 
reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="silent-authentication">4.2.2. Silent Authentication</h4>
<div class="paragraph">
<p>By default, WildFly provides an authentication mechanism for local
users, also know as silent authentication, through the <em>local</em> security
realm.</p>
</div>
<div class="paragraph">
<p>Silent authentication must be used via a <em>sasl-authentication-factory</em>.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: When enabling silent authentication, you must ensure the
security domain referenced by your <em>sasl-authentication-factory</em>
references a security realm that contains the <em>$local</em> user. By default,
WildFly provides the <em>local</em> identity realm that provides this user.</p>
</div>
<div class="sect4">
<h5 id="add-silent-authentication-to-an-existing-sasl-authentication-factory.">Add silent authentication to an existing</h5>
<div class="paragraph">
<p>sasl-authentication-factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">s</span></span>asl-authentication-factory=example-sasl-<span class="key">auth</span>:list-add(name=mechanism-configurations, value={mechanism-name=<span class="constant">JBOSS</span>-<span class="constant">LOCAL</span>-<span class="constant">USER</span>, realm-mapper=local})
 
reload</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="create-a-new-sasl-server-factory-with-silent-authentication.">Create a new sasl-server-factory with silent authentication.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">s</span></span>asl-authentication-factory=example-sasl-<span class="key">auth</span>:add(sasl-server-factory=configured,security-domain=exampleSD,mechanism-configurations=[{mechanism-name=<span class="constant">DIGEST</span>-<span class="constant">MD5</span>,mechanism-realm-configurations=[{realm-name=exampleManagementRealm}]},{mechanism-name=<span class="constant">JBOSS</span>-<span class="constant">LOCAL</span>-<span class="constant">USER</span>, realm-mapper=local}])
 
reload</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="remove-silent-authentication-from-an-existing-sasl-server-factory">Remove silent authentication from an existing sasl-server-factory:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">s</span></span>asl-authentication-factory=managenet-sasl-<span class="key">authentication</span>:read-resource
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [
            {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">JBOSS-LOCAL-USER</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">realm-mapper</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span>
            },
            {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">mechanism-realm-configurations</span><span class="delimiter">&quot;</span></span> =&gt; [{<span class="string"><span class="delimiter">&quot;</span><span class="content">realm-name</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>}]
            }
        ],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">sasl-server-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">configured</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">security-domain</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementDomain</span><span class="delimiter">&quot;</span></span>
    }
}
 
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">s</span></span>asl-authentication-factory=temp-sasl-<span class="key">authentication</span>:list-remove(name=mechanism-configurations,index=<span class="integer">0</span>)
 
reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-rbac-with-elytron">4.2.3. Using RBAC with Elytron</h4>
<div class="paragraph">
<p>RBAC can be configured to automatically assign or exclude roles for
users that are members of groups. This is configured in the
<em>access-control</em> section of the core management. When the management
interfaces are secured with the <em>elytron</em> subsystem, and users are
assigned groups when they authenticate. You can also configure roles to
be assigned to authenticated users in a variety of ways using the
<em>elytron</em> subsystem, for example using a role mapper or a role decoder.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-ssltls">4.3. Configure SSL/TLS</h3>
<div class="sect3">
<h4 id="enable-one-way-ssltls-for-applications">4.3.1. Enable One-way SSL/TLS for Applications</h4>
<div class="paragraph">
<p>There are a couple ways to enable one-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect4">
<h5 id="one-way-ssl-applications-using-security-command">Using a security command:</h5>
<div class="paragraph">
<p>The <em>security enable-ssl-http-server</em> command can be used to enable one-way
SSL/TLS for deployed applications. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">security enable-ssl-http-server --interactive
Please provide required pieces of information to enable SSL:
<span class="predefined-type">Key</span>-store file name (<span class="keyword">default</span> <span class="keyword">default</span>-server.keystore): keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code <span class="keyword">for</span> <span class="local-variable">this</span> unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank <span class="keyword">default</span>): <span class="integer">365</span>
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): n

SSL options:
key store file: keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: <span class="integer">365</span>
alias: localhost
Server keystore file keystore.jks, certificate file keystore.pem and keystore.csr file
will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server.</p>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for applications.</p>
</div>
</div>
<div class="sect4">
<h5 id="one-way-ssl-applications-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h5>
<div class="paragraph">
<p>You can also use the Elytron subsystem, along with the Undertow subsystem, to
enable HTTPS for deployed applications.</p>
</div>
<div class="sect5">
<h6 id="configure-a-key-store-in-wildfly">Configure a key-store in WildFly:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:add(path=<span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/keystore.jks,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command uses an absolute path to the keystore.
Alternatively you can use the <em>relative-to</em> attribute to specify the
base directory variable and <em>path</em> specify a relative path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:add(path=keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the keystore file does not exist yet, the following commands can be used to
generate an example key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:generate-key-pair(<span class="keyword">alias</span>=localhost,algorithm=<span class="constant">RSA</span>,key-size=<span class="integer">1024</span>,validity=<span class="integer">365</span>,credential-reference={clear-text=secret},distinguished-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN=localhost</span><span class="delimiter">&quot;</span></span>)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:store()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-key-manager-in-that-references-your-key-store">Configure a key-manager that references your key-store:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-manager=<span class="key">httpsKM</span>:add(key-store=httpsKS,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-server-ssl-context-in-that-references-your-key-manager">Configure a server-ssl-context that references your key-manager:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">httpsSSC</span>:add(key-manager=httpsKM,protocols=[<span class="string"><span class="delimiter">&quot;</span><span class="content">TLSv1.2</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="check-and-see-if-the-https-listener-is-configured-to-use-a-legacy-security-realm-for-its-ssl-configuration">Check and see if the https-listener is configured to use a legacy security realm for its SSL configuration:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:read-attribute(name=security-realm)
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command shows that the <em>https-listener</em> is configured to use
the <em>ApplicationRealm</em> legacy security realm for its SSL configuration.
Undertow cannot reference both a legacy security realm and an
<em>ssl-context</em> in Elytron at the same time so you must remove the
reference to the legacy security realm. Also there has to be always
configured either <em>ssl-context</em> or <em>security-realm</em>. Thus when changing
between those, you have to use batch operation:</p>
</div>
<div class="paragraph">
<p><strong>Remove the reference to the legacy security realm and update the</strong>
<strong><em>https-listener</em></strong> <strong>to use the</strong> <strong><em>ssl-context</em></strong> <strong>from Elytron</strong> <strong>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">batch
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:undefine-attribute(name=security-realm)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:write-attribute(name=ssl-context,value=httpsSSC)
run-batch</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reload-the-server">Reload the server:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for applications.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-two-way-ssltls-in-wildfly-for-applications">4.3.2. Enable Two-way SSL/TLS in WildFly for Applications</h4>
<div class="paragraph">
<p>First, obtain or generate your client keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -genkeypair -alias client -keyalg RSA -keysize 1024 -validity 365 -keystore client.keystore.jks -dname &quot;CN=client&quot; -keypass secret -storepass secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export the client certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -exportcert  -keystore client.keystore.jks -alias client -keypass secret -storepass secret -file /path/to/client.cer</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple ways to enable two-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect4">
<h5 id="two-way-ssl-applications-using-security-command">Using a security command:</h5>
<div class="paragraph">
<p>The <em>security enable-ssl-http-server</em> command can be used to enable two-way
SSL/TLS for the deployed applications. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">security enable-ssl-http-server --interactive
Please provide required pieces of information to enable SSL:
<span class="predefined-type">Key</span>-store file name (<span class="keyword">default</span> <span class="keyword">default</span>-server.keystore): server.keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code <span class="keyword">for</span> <span class="local-variable">this</span> unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank <span class="keyword">default</span>): <span class="integer">365</span>
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): y
Client certificate (path to pem file): /path/to/client.cer
Validate certificate y/n (blank y):
Trust-store file name (management.truststore): server.truststore.jks
Password (blank generated): secret

SSL options:
key store file: server.keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: <span class="integer">365</span>
alias: localhost
client certificate: /path/to/client.cer
trust store file: server.trustore.jks
trust store password: secret
Server keystore file server.keystore.jks, certificate file server.pem and server.csr file will be generated in server configuration directory.
Server truststore file server.trustore.jks will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server. To complete
the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-applications">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-applications">configure your client</a>
to present the client certificate.</p>
</div>
</div>
<div class="sect4">
<h5 id="two-way-ssl-applications-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h5>
<div class="paragraph">
<p>You can also use the Elytron subsystem, along with the Undertow subsystem,
to enable two-way SSL/TLS for deployed applications.</p>
</div>
<div class="sect5">
<h6 id="obtain-or-generate-your-keystores-applications">Obtain or generate your key stores:</h6>
<div class="paragraph">
<p>Before enabling HTTPS in WildFly, you must obtain or generate the server key
store and trust store you plan on using. To generate an example key store and
trust store, use the following commands.</p>
</div>
<div class="paragraph">
<p>Create a server key-store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:add(path=<span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/server.keystore.jks,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:generate-key-pair(<span class="keyword">alias</span>=localhost,algorithm=<span class="constant">RSA</span>,key-size=<span class="integer">1024</span>,validity=<span class="integer">365</span>,credential-reference={clear-text=secret},distinguished-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN=localhost</span><span class="delimiter">&quot;</span></span>)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:store()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE</strong><br>
The first command above uses an absolute path to the keystore.
Alternatively you can use the <em>relative-to</em> attribute to specify the
base directory variable and <em>path</em> specify a relative path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:add(path=server.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export the server certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:export-certificate(<span class="keyword">alias</span>=localhost,path=<span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/server.cer,pem=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div id="import-client-certificate" class="paragraph">
<p>Create a key-store for the server truststore and import the client certificate
into the server truststore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayTS</span>:add(path=<span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/server.truststore.jks,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayTS</span>:import-certificate(<span class="keyword">alias</span>=client,path=<span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/client.cer,credential-reference={clear-text=secret},trust-cacerts=<span class="predefined-constant">true</span>)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayTS</span>:store()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-key-manager-in-that-references-your-key-store-key-store">Configure a key-manager that references your key store key-store:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-manager=<span class="key">twoWayKM</span>:add(key-store=twoWayKS,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-trust-manager-in-that-references-your-truststore-key-store">Configure a trust-manager that references your truststore key-store:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>trust-manager=<span class="key">twoWayTM</span>:add(key-store=twoWayTS)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-server-ssl-context-in-that-references-your-key-manager-trust-manager-and-enables-client-authentication">Configure a server-ssl-context that references your key-manager, trust-manager, and enables client authentication:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">twoWaySSC</span>:add(key-manager=twoWayKM,protocols=[<span class="string"><span class="delimiter">&quot;</span><span class="content">TLSv1.2</span><span class="delimiter">&quot;</span></span>],trust-manager=twoWayTM,need-client-auth=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong><br>
You need to determine what SSL/TLS protocols you want to support. The
example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="check-and-see-if-the-https-listener-is-configured-to-use-a-legacy-security-realm-for-its-ssl-configuration-1">Check and see if the https-listener is configured to use a legacy security realm for its SSL configuration:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:read-attribute(name=security-realm)
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command shows that the <em>https-listener</em> is configured to use
the <em>ApplicationRealm</em> legacy security realm for its SSL configuration.
Undertow cannot reference both a legacy security realm and an
<em>ssl-context</em> in Elytron at the same time so you must remove the
reference to the legacy security realm. Also there has to be always
configured either <em>ssl-context</em> or <em>security-realm</em>. Thus when changing
between those, you have to use batch operation:</p>
</div>
</div>
<div class="sect5">
<h6 id="remove-the-reference-to-the-legacy-security-realm-and-update-the-https-listener-to-use-the-ssl-context-from-elytron">Remove the reference to the legacy security realm and update the</h6>
<div class="paragraph">
<p>https-listener to use the ssl-context from Elytron:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">batch
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:undefine-attribute(name=security-realm)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:write-attribute(name=ssl-context,value=twoWaySSC)
run-batch</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reload-the-server-1">Reload the server</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-applications">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-applications">configure your client</a>
to present the client certificate.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="import-server-certificate-into-client-truststore-applications">Import the server certificate into the client truststore</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -importcert -keystore client.truststore.jks -storepass secret -alias localhost -trustcacerts -file /path/to/server.cer</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-client-to-use-the-client-certificate-applications">Configure your client to use the client certificate</h5>
<div class="paragraph">
<p>You need to configure your client to present the trusted client
certificate to the server to complete the two-way SSL/TLS
authentication. For example, if using a browser, you need to import the
trusted certificate into the browser&#8217;s truststore.</p>
</div>
<div class="paragraph">
<p>Two-Way HTTPS is now enabled for applications.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-one-way-ssltls-for-the-management-interfaces">4.3.3. Enable One-way SSL/TLS for the Management Interfaces</h4>
<div class="paragraph">
<p>There are a couple ways to enable one-way SSL/TLS for the management interfaces.</p>
</div>
<div class="sect4">
<h5 id="one-way-ssl-management-interfaces-using-security-command">Using a security command:</h5>
<div class="paragraph">
<p>The <em>security enable-ssl-management</em> command can be used to enable one-way
SSL/TLS for the management interfaces. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">security enable-ssl-management --interactive
Please provide required pieces of information to enable SSL:
<span class="predefined-type">Key</span>-store file name (<span class="keyword">default</span> management.keystore): keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code <span class="keyword">for</span> <span class="local-variable">this</span> unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank <span class="keyword">default</span>): <span class="integer">365</span>
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): n

SSL options:
key store file: keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: <span class="integer">365</span>
alias: localhost
Server keystore file keystore.jks, certificate file keystore.pem and keystore.csr file
will be generated in server configuration directory.
Do you confirm y/n :y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server and reconnect to it.</p>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for the management interfaces.</p>
</div>
</div>
<div class="sect4">
<h5 id="one-way-ssl-management-interfaces-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h5>
<div class="paragraph">
<p>Elytron subsystem commands can also be used to enable one-way SSL/TLS for the
management interfaces.</p>
</div>
<div class="sect5">
<h6 id="configure-key-store">Configure a key-store:</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:add(path=keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above command uses <em>relative-to</em> to reference the location
of the keystore file. Alternatively, you can specify the full path to
the keystore in <em>path</em> and omit <em>relative-to</em>.</p>
</div>
<div class="paragraph">
<p>If the keystore file does not exist yet, the following commands can be used to
generate an example key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:generate-key-pair(<span class="keyword">alias</span>=localhost,algorithm=<span class="constant">RSA</span>,key-size=<span class="integer">1024</span>,validity=<span class="integer">365</span>,credential-reference={clear-text=secret},distinguished-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN=localhost</span><span class="delimiter">&quot;</span></span>)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:store()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="create-a-key-manager-and-server-ssl-context">Create a key-manager and server-ssl-context.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-manager=<span class="key">httpsKM</span>:add(key-store=httpsKS,credential-reference={clear-text=secret})
 
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">httpsSSC</span>:add(key-manager=httpsKM,protocols=[<span class="string"><span class="delimiter">&quot;</span><span class="content">TLSv1.2</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="enable-https-on-the-management-interface.">Enable HTTPS on the management interface.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">core-service=management</span><span class="delimiter">/</span><span class="modifier">m</span></span>anagement-interface=http-<span class="key">interface</span>:write-attribute(name=ssl-context, value=httpsSSC)
 
<span class="regexp"><span class="delimiter">/</span><span class="content">core-service=management</span><span class="delimiter">/</span><span class="modifier">m</span></span>anagement-interface=http-<span class="key">interface</span>:write-attribute(name=secure-socket-binding, value=management-https)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reload-the-wildfly-instance.">Reload the WildFly instance.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTPS is now enabled for the management interfaces.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-two-way-ssltls-for-the-management-interfaces">4.3.4. Enable Two-way SSL/TLS for the Management Interfaces</h4>
<div class="paragraph">
<p>First, obtain or generate your client keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -genkeypair -alias client -keyalg RSA -keysize 1024 -validity 365 -keystore client.keystore.jks -dname &quot;CN=client&quot; -keypass secret -storepass secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export your client certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -exportcert  -keystore client.keystore.jks -alias client -keypass secret -storepass secret -file /path/to/client.cer</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple ways to enable two-way SSL/TLS for the management interfaces.</p>
</div>
<div class="sect4">
<h5 id="two-way-ssl-management-interfaces-using-security-command">Using a security command:</h5>
<div class="paragraph">
<p>The <em>security enable-ssl-management</em> command can be used to enable two-way
SSL/TLS for the management interfaces. Example of wizard usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">security enable-ssl-management --interactive
Please provide required pieces of information to enable SSL:
<span class="predefined-type">Key</span>-store file name (<span class="keyword">default</span> management.keystore): server.keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code <span class="keyword">for</span> <span class="local-variable">this</span> unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank <span class="keyword">default</span>): <span class="integer">365</span>
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): y
Client certificate (path to pem file): /path/to/client.cer
Validate certificate y/n (blank y):
Trust-store file name (management.truststore): server.truststore.jks
Password (blank generated): secret

SSL options:
key store file: server.keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: <span class="integer">365</span>
alias: localhost
client certificate: /path/to/client.cer
trust store file: server.trustore.jks
trust store password: secret
Server keystore file server.keystore.jks, certificate file server.pem and server.csr file will be generated in server configuration directory.
Server truststore file server.trustore.jks will be generated in server configuration directory.
Do you confirm y/n: y</code></pre>
</div>
</div>
<div class="paragraph">
<p>NB: Once the command is executed, the CLI will reload the server and
attempt to reconnect to it. To complete the two-way SSL/TLS authentication,
you need to <a href="#import-server-certificate-into-client-truststore-management">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-management">configure your client</a>
to present the client certificate.</p>
</div>
</div>
<div class="sect4">
<h5 id="two-way-ssl-management-interfaces-using-elytron-subsystem-commands">Using Elytron subsystem commands:</h5>
<div class="paragraph">
<p>Elytron subsystem commands can also be used to enable two-way SSL/TLS for the
management interfaces.</p>
</div>
<div class="sect5">
<h6 id="obtain-or-generate-your-key-stores-management">Obtain or generate your key stores.</h6>
<div class="paragraph">
<p>Before enabling HTTPS in WildFly, you must obtain or generate the server
key store and trust store you plan on using. To generate an example key
store and trust store, use the following commands.</p>
</div>
<div class="paragraph">
<p>Configure a key-store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:add(path=server.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)

<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:generate-key-pair(<span class="keyword">alias</span>=localhost,algorithm=<span class="constant">RSA</span>,key-size=<span class="integer">1024</span>,validity=<span class="integer">365</span>,credential-reference={clear-text=secret},distinguished-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN=localhost</span><span class="delimiter">&quot;</span></span>)

<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:store()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> The above command uses <em>relative-to</em> to reference the location
of the keystore file. Alternatively, you can specify the full path to
the keystore in <em>path</em> and omit <em>relative-to</em>.</p>
</div>
<div class="paragraph">
<p>Export your server certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayKS</span>:export-certificate(<span class="keyword">alias</span>=localhost,path=<span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/server.cer,pem=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div id="import-client-certificate-into-server-truststore" class="paragraph">
<p>Create a key-store for the server trust store and import the client certificate
into the server trust store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayTS</span>:add(path=server.truststore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)

<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayTS</span>:import-certificate(<span class="keyword">alias</span>=client,path=<span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/client.cer,credential-reference={clear-text=secret},trust-cacerts=<span class="predefined-constant">true</span>)

<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">twoWayTS</span>:store()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-key-manager-trust-manager-and-server-ssl-context-for-the-server-key-store-and-trust-store">Configure a key-manager, trust-manager, and server-ssl-context for the server key store and trust store.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-manager=<span class="key">twoWayKM</span>:add(key-store=twoWayKS,credential-reference={clear-text=secret})
 
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>trust-manager=<span class="key">twoWayTM</span>:add(key-store=twoWayTS)
 
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">twoWaySSC</span>:add(key-manager=twoWayKM,protocols=[<span class="string"><span class="delimiter">&quot;</span><span class="content">TLSv1.2</span><span class="delimiter">&quot;</span></span>],trust-manager=twoWayTM,want-client-auth=<span class="predefined-constant">true</span>,need-client-auth=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> You need to determine what SSL/TLS protocols you want to
support. The example commands above uses <em>TLSv1.2</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="enable-https-on-the-management-interface.-1">Enable HTTPS on the management interface.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">core-service=management</span><span class="delimiter">/</span><span class="modifier">m</span></span>anagement-interface=http-<span class="key">interface</span>:write-attribute(name=ssl-context, value=twoWaySSC)
 
<span class="regexp"><span class="delimiter">/</span><span class="content">core-service=management</span><span class="delimiter">/</span><span class="modifier">m</span></span>anagement-interface=http-<span class="key">interface</span>:write-attribute(name=secure-socket-binding, value=management-https)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reload-the-wildfly-instance.-1">Reload the WildFly instance.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the two-way SSL/TLS authentication, you need to
<a href="#import-server-certificate-into-client-truststore-management">import the server certificate</a>
into the client truststore and
<a href="#configure-your-client-to-use-the-client-certificate-management">configure your client</a>
to present the client certificate.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="import-server-certificate-into-client-truststore-management">Import the server certificate into the client truststore.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -importcert -keystore client.truststore.jks -storepass secret -alias localhost -trustcacerts -file /path/to/server.cer</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-your-client-to-use-the-client-certificate-management">Configure your client to use the client certificate.</h5>
<div class="paragraph">
<p>You need to configure your client to present the trusted client
certificate to the server to complete the two-way SSL/TLS
authentication. For example, if using a browser, you need to import the
trusted certificate into the browser&#8217;s trust store.</p>
</div>
<div class="paragraph">
<p>Two-way SSL/TLS is now enabled for the management interfaces.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="keystore-manipulation-operations">4.3.5. KeyStore manipulation operations</h4>
<div class="paragraph">
<p>It is possible to perform various KeyStore manipulation operations on an
Elytron key-store resource using the management CLI.</p>
</div>
<div class="sect4">
<h5 id="generate-key-pair">Generate a key pair</h5>
<div class="paragraph">
<p>The <em>generate-key-pair</em> command generates a key pair and wraps the resulting
public key in a self-signed X.509 certificate. The generated private key and
self-signed certificate will be added to the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:generate-key-pair(<span class="keyword">alias</span>=example,algorithm=<span class="constant">RSA</span>,key-size=<span class="integer">1024</span>,validity=<span class="integer">365</span>,credential-reference={clear-text=secret},distinguished-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN=www.example.com</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="generate-certificate-signing-request">Generate a certificate signing request</h5>
<div class="paragraph">
<p>The <em>generate-certificate-signing-request</em> command generates a PKCS #10
certificate signing request using a PrivateKeyEntry from the KeyStore. The
generated certificate signing request will be output to a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:generate-certificate-signing-request(<span class="keyword">alias</span>=example,path=server.csr,relative-to=jboss.server.config.dir,distinguished-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN=www.example.com</span><span class="delimiter">&quot;</span></span>,extensions=[{critical=<span class="predefined-constant">false</span>,name=<span class="constant">KeyUsage</span>,value=digitalSignature}],credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="import-certificate">Import a certificate or certificate chain</h5>
<div class="paragraph">
<p>The <em>import-certificate</em> command imports a certificate or certificate chain
from a file into an entry in the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:import-certificate(<span class="keyword">alias</span>=example,path=<span class="regexp"><span class="delimiter">/</span><span class="content">path</span><span class="delimiter">/</span></span>to/certificate_or_chain/file,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},trust-cacerts=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="export-certificate">Export a certificate</h5>
<div class="paragraph">
<p>The <em>export-certificate</em> command exports a certificate from an entry in the
KeyStore to a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:export-certificate(<span class="keyword">alias</span>=example,path=serverCert.cer,relative-to=jboss.server.config.dir,pem=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="change-alias">Change an alias</h5>
<div class="paragraph">
<p>The <em>change-alias</em> command moves an existing KeyStore entry to a new alias.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:change-<span class="keyword">alias</span>(<span class="keyword">alias</span>=example,new-<span class="keyword">alias</span>=newExample,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="store-changes">Store changes made to key-stores</h5>
<div class="paragraph">
<p>The <em>store</em> command persists any changes that have been made to the file that
backs the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:store()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="obtain-certificate">Obtain a signed certificate from Let&#8217;s Encrypt</h5>
<div class="paragraph">
<p>Before obtaining a signed certificate from Let&#8217;s Encrypt, you must configure
a Let&#8217;s Encrypt account using the following commands.</p>
</div>
<div class="sect5">
<h6 id="create-le-account-key-store">Create a key-store to hold your Let&#8217;s Encrypt account key.</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">accountsKS</span>:add(path=accounts.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=<span class="constant">JKS</span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-le-account">Configure a Let&#8217;s Encrypt account</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>certificate-authority-account=<span class="key">myLEAccount</span>:add(<span class="keyword">alias</span>=example,key-store=accountsKS,contact-urls=[<span class="key">mailto</span>:admin<span class="instance-variable">@example</span>.org])</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="obtain-signed-certificate">Obtain a signed certificate from Let&#8217;s Encrypt</h6>
<div class="paragraph">
<p>The <em>obtain-certificate</em> command creates an account with Let&#8217;s Encrypt, if such an account does not already exist,
obtains a signed certificate from Let&#8217;s Encrypt, and stores it in the KeyStore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:obtain-certificate(<span class="keyword">alias</span>=server,domain-names=[www.example.org],certificate-authority-account=myLEAccount,agree-to-terms-of-service=<span class="predefined-constant">true</span>,algorithm=<span class="constant">RSA</span>,key-size=<span class="integer">1024</span>,credential-reference={clear-text=secret})</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="revoke-certificate">Revoke a signed certificate</h5>
<div class="paragraph">
<p>The <em>revoke-certificate</em> command revokes a certificate that was issued by Let&#8217;s Encrypt.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:revoke-certificate(<span class="keyword">alias</span>=server,reason=keyCompromise,certificate-authority-account=myLEAccount)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="should-renew-certificate">Check if a certificate is due for renewal</h5>
<div class="paragraph">
<p>The <em>should-renew-certificate</em> command checks if a certificate is due for renewal. In particular, it will return true if the certificate expires in less than the given number of days and false otherwise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:should-renew-certificate(<span class="keyword">alias</span>=server,expiration=<span class="integer">7</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="certificate-authority-account-operations">4.3.6. Certificate authority account operations</h4>
<div class="paragraph">
<p>It is possible to perform various operations on an Elytron certificate-authority-account
resource using the management CLI.</p>
</div>
<div class="sect4">
<h5 id="create-account">Create an account with the certificate authority</h5>
<div class="paragraph">
<p>The <em>create-account</em> command creates an account with the certificate authority if one does not already exist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>certificate-authority-account=<span class="key">myLEAccount</span>:create-account(agree-to-terms-of-service=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="update-account">Update an account with the certificate authority</h5>
<div class="paragraph">
<p>The <em>update-account</em> command updates an account with the certificate authority.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>certificate-authority-account=<span class="key">myLEAccount</span>:update-account(agree-to-terms-of-service=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="change-account-key">Change the account key</h5>
<div class="paragraph">
<p>The <em>change-account-key</em> command changes the key associated with the certificate authority account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>certificate-authority-account=<span class="key">myLEAccount</span>:change-account-key()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deactivate-account">Deactivate the account</h5>
<div class="paragraph">
<p>The <em>deactivate-account</em> command deactivates the certificate authority account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>certificate-authority-account=<span class="key">myLEAccount</span>:deactivate-account()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="get-metadata">Get metadata</h5>
<div class="paragraph">
<p>The <em>get-metadata</em> command retrieves the metadata (e.g., terms of service URL, website URL, CAA identities,
and whether or not an external account is required), if any, associated with the certificate authority.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>certificate-authority-account=<span class="key">myLEAccount</span>:get-metadata()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-an-ldap-key-store">4.3.7. Using an ldap-key-store</h4>
<div class="paragraph">
<p>An <em>ldap-key-store</em> allows you to use a keystore stored in an LDAP
server. You can use an <em>ldap-key-store</em> in same way you can use a
<em>key-store</em>.</p>
</div>
<div class="paragraph">
<p>To create and use an <em>ldap-key-store</em>:</p>
</div>
<div class="sect4">
<h5 id="configure-a-dir-context.">Configure a dir-context.</h5>
<div class="paragraph">
<p>To connect to the LDAP server from WildFly, you need to configure a
<em>dir-context</em> that provides the URL as well as the principal used to
connect to the server.</p>
</div>
<div class="paragraph">
<p><strong>Example dir-context</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>dir-context=<span class="key">exampleDC</span>:add( \
  url=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://127.0.0.1:10389</span><span class="delimiter">&quot;</span></span>, \
  principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, \
  credential-reference={clear-text=secret} \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-an-ldap-key-store.">Configure an ldap-key-store.</h5>
<div class="paragraph">
<p>When configure an <em>ldap-key-store</em>, you need to specify both the
<em>dir-context</em> used to connect to the LDAP server as well as how to
locate the keystore stored in the LDAP server. At a minimum, this
requires you specify a <em>search-path</em>.</p>
</div>
<div class="paragraph">
<p><strong>Example ldap-key-store</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>ldap-key-store=<span class="key">ldapKS</span>:add( \
  dir-context=exampleDC, \
  search-path=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=Keystores,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span> \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-the-ldap-key-store.">Use the ldap-key-store.</h5>
<div class="paragraph">
<p>Once you have defined your <em>ldap-key-store</em>, you can use it in the same
places where a <em>key-store</em> could be used. For example, you could use an
<em>ldap-key-store</em> when configuring HTTPS and Two-Way HTTPS for
applications.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-a-filtering-key-store">4.3.8. Using a filtering-key-store</h4>
<div class="paragraph">
<p>A <em>filtering-key-store</em> allows you to expose a subset of aliases from an
existing <em>key-store</em>, and use it in the same places you could use a
<em>key-store</em>. For example, if a keystore contained <em>alias1</em>, <em>alias2</em>,
and <em>alias3</em>, but you only wanted to expose <em>alias1</em> and <em>alias3</em>, a
<em>filtering-key-store</em> provides you several ways to do that.</p>
</div>
<div class="paragraph">
<p>To create a <em>filtering-key-store</em>:</p>
</div>
<div class="sect4">
<h5 id="configure-a-key-store.">Configure a key-store.</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">myKS</span>:add( \
  path=keystore.jks, \
  relative-to=jboss.server.config.dir, \
  credential-reference={ \
    clear-text=secret \
  }, \
  type=<span class="constant">JKS</span> \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-a-filtering-key-store.">Configure a filtering-key-store.</h5>
<div class="paragraph">
<p>When you configure a <em>filtering-key-store</em>, you specify which
<em>key-store</em> you want to filter and the <em>alias-filter</em> for filtering
aliases from the <em>key-store</em>. The filter can be specified in one of the
following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>alias1,alias3</em>, which is a comma-delimited list of aliases to expose.</p>
</li>
<li>
<p><em>ALL:-alias2</em>, which exposes all aliases in the keystore except the
ones listed.</p>
</li>
<li>
<p><em>NONE:+alias1:+alias3</em>, which exposes no aliases in the keystore
except the ones listed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example uses a comma-delimted list to expose <em>alias1</em> and <em>alias3</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>filtering-key-store=<span class="key">filterKS</span>:add( \
  key-store=myKS, \
  <span class="keyword">alias</span>-filter=<span class="string"><span class="delimiter">&quot;</span><span class="content">alias1,alias3</span><span class="delimiter">&quot;</span></span> \
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-the-filtering-key-store.">Use the filtering-key-store.</h5>
<div class="paragraph">
<p>Once you have defined your <em>filtering-key-store</em>, you can use it in the
same places where a <em>key-store</em> could be used. For example, you could
use a <em>filtering-key-store</em> when configuring HTTPS and Two-Way HTTPS for
applications.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reload-a-keystore">4.3.9. Reload a Keystore</h4>
<div class="paragraph">
<p>You can reload a keystore configured in WildFly from the management CLI.
This is useful in cases where you have made changes to certificates
referenced by a keystore.</p>
</div>
<div class="paragraph">
<p>To reload a keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">httpsKS</span>:load</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reinitialize-a-key-manager">4.3.10. Reinitialize a Key Manager</h4>
<div class="paragraph">
<p>You can reinitialize a key-manager configured in WildFly from the management CLI.
This is useful in cases where you have made changes in certificates provided by keystore
resource and you want to apply this change to new SSL connections without restarting the server.</p>
</div>
<div class="paragraph">
<p>If the key-store is file based then it must be loaded first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/subsystem=elytron/key-store=httpsKS:load()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To reinitialize a key-manager.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/subsystem=elytron/key-manager=httpsKM:init()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reinitialize-a-trust-manager">4.3.11. Reinitialize a Trust Manager</h4>
<div class="paragraph">
<p>You can reinitialize a trust-manager configured in WildFly from the management CLI.
This is useful in cases where you have made changes to certificates provided by keystore
resource and you want to apply this change to new SSL connections without restarting the server.</p>
</div>
<div class="paragraph">
<p>If the key-store is file based then it must be loaded first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/subsystem=elytron/key-store=httpsKS:load()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To reinitialize a trust-manager.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/subsystem=elytron/trust-manager=httpsTM:init()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="check-the-content-of-a-keystore-by-alias">4.3.12. Check the Content of a Keystore by Alias</h4>
<div class="paragraph">
<p>If you add a keystore to the <em>elytron</em> subsystem using the <em>key-store</em>
component, you can check the keystore&#8217;s contents using the <em>alias</em> child
element and reading its attributes.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=httpsKS/<span class="keyword">alias</span>=<span class="key">localhost</span>:read-attribute(name=certificate-chain)
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; [{
        <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">X.509</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">algorithm</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">RSA</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">X.509</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">public-key</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">30:81:9f:30:0d:06:09:2a:8......</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following attributes can be read:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate associated with the alias. If the alias
has a certificate chain this will always be undefined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate-chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chain associated with the alias.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creation-date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The creation date of the entry represented by this
alias.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entry-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the entry for this alias. Available types:
PasswordEntry, PrivateKeyEntry, SecretKeyEntry, TrustedCertificateEntry,
and Other. Unrecognized types will be reported as Other.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="custom-components">4.3.13. Custom Components</h4>
<div class="paragraph">
<p>When configuring SSL/TLS in the <em>elytron</em> subsystem, you can provide and
use custom implementations of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>key-store</em></p>
</li>
<li>
<p><em>key-manager</em></p>
</li>
<li>
<p><em>trust-manager</em></p>
</li>
<li>
<p><em>client-ssl-context</em></p>
</li>
<li>
<p><em>server-ssl-context</em></p>
</li>
<li>
<p><em>certificate-authority-account</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When creating custom implementations of Elytron components, they must
present the appropriate capabilities and requirements.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-elytron-and-security-subsystems">4.4. Configuring the Elytron and Security Subsystems</h3>
<div class="sect3">
<h4 id="enable-and-disable-the-elytron-subsystem">4.4.1. Enable and Disable the Elytron Subsystem</h4>
<div class="sect4">
<h5 id="to-add-the-elytron-extension-required-for-the-elytron-subsystem">To add the elytron extension required for the elytron subsystem:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">extension=org.wildfly.extension.elytron:add()</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="to-enable-the-elytron-subsystem-in-wildfly">To enable the Elytron subsystem in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron:add
 
reload</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="to-disable-the-elytron-subsystem-in-wildfly">To disable the Elytron subsystem in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron:remove
 
reload</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Other subsystems within WildFly may have dependencies on
the <em>elytron</em> subsystem. If these dependencies are not resolved before
disabling it, you will see errors when starting WildFly.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-and-disable-the-security-subsystem">4.4.2. Enable and Disable the Security Subsystem</h4>
<div class="sect4">
<h5 id="to-disable-the-security-subsystem-in-wildfly">To disable the security subsystem in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=security:remove
 
reload</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> Other subsystems within WildFly may have dependencies on
the <em>security</em> subsystem. If these dependencies are not resolved before
disabling it, you will see errors when starting WildFly.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-enable-the-security-subsystem-in-wildfly">To enable the security subsystem in WildFly:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=security:add
 
reload</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-the-elytron-and-security-subsystems-in-parallel">4.4.3. Use the Elytron and Security Subsystems in Parallel</h4>
<div class="paragraph">
<p>By default the <em>elytron</em> and <em>security</em> subsystems will run in parallel
if both are enabled. For authentication in applications, you can use the
<em>application-security-domain</em> property in the <em>undertow</em> subsystem to
configure a security domain in the <em>elytron</em> subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">exampleApplicationDomain</span>:add(http-authentication-factory=example-http-auth)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> This must match the <em>security-domain</em> configured in the
<em>jboss-web.xml</em> of your application.</p>
</div>
<div class="paragraph">
<p>If the <em>application-security-domain</em> is not set, WildFly will look for a
security domain configured in the <em>security</em> subsystem that matches the
<em>security-domain</em> configured in the <em>jboss-web.xml</em> of your application.</p>
</div>
<div class="paragraph">
<p>For enabling HTTPS using a legacy security realm, you can use the
<em>security-realm</em> attribute in the <em>https-listener</em> section of the
<em>undertow</em> subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:read-attribute(name=security-realm)
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For enabling HTTPS using <em>elytron</em>, you need to undefine the
<em>security-realm</em> attribute and set the <em>ssl-context</em> attribute. As there
has to be always configured either <em>ssl-context</em> or <em>security-realm</em> you
have to use batch operation when changing between those:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">batch
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:undefine-attribute(name=security-realm)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:write-attribute(name=ssl-context,value=httpsSSC)
run-batch</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-elytron-subsystem-components">4.5. Creating Elytron Subsystem Components</h3>
<div class="sect3">
<h4 id="create-an-elytron-security-realm">4.5.1. Create an Elytron Security Realm</h4>
<div class="paragraph">
<p>Security realms in the Elytron subsystem, when used in conjunction with
security domains, are use for both core management authentication as
well as for authentication with applications. Security realms are also
specifically typed based on their identity store, for example
<em>jdbc-realm</em>, <em>filesystem-realm</em>, <em>properties-realm</em>, etc.</p>
</div>
<div class="paragraph">
<p>Adding a security realm takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>type-of-realm=<span class="key">realmName</span>:add(....)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples of adding specific realms, such as <em>jdbc-realm</em>,
<em>filesystem-realm</em>, and <em>properties-realm</em> can be found in previous
sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-role-decoder">4.5.2. Create an Elytron Role Decoder</h4>
<div class="paragraph">
<p>A role decoder converts attributes from the identity provided by the
security realm into roles. Role decoders are also specifically typed
based on their functionality, for example <em>empty-role-decoder</em>,
<em>simple-role-decoder</em>, and <em>custom-role-decoder</em>.</p>
</div>
<div class="paragraph">
<p>Adding a role decoder takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span><span class="constant">ROLE</span>-<span class="constant">DECODER</span>-<span class="constant">TYPE</span>=<span class="key">roleDeoderName</span>:add(....)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-permission-set">4.5.3. Create an Elytron Permission Set</h4>
<div class="paragraph">
<p>Permission sets can be used to assign permissions to an identity.</p>
</div>
<div class="paragraph">
<p>Adding a permission set takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>permission-set=<span class="key">PermissionSetName</span>:add(permissions=[{<span class="keyword">class</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>, <span class="keyword">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>, target-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>, action=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>}...])</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>permissions</em> consists of a set of permissions, where each permission has the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>class-name</em> is the fully qualified class name of the permission. This is the only permission attribute that is required.</p>
</li>
<li>
<p><em>module</em> is the optional module to use to load the permission.</p>
</li>
<li>
<p><em>target-name</em> is the optional target name to pass to the permission as it is constructed.</p>
</li>
<li>
<p><em>action</em> is the optional action to pass to the permission as it is constructed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-permission-mapper">4.5.4. Create an Elytron Permission Mapper</h4>
<div class="paragraph">
<p>In addition to roles being assigned to a identity, permissions may also
be assigned. A permission mapper assigns permissions to an identity.
Permission mappers are also specifically typed based on their
functionality, for example <em>logical-permission-mapper</em>,
<em>simple-permission-mapper</em>, and <em>custom-permission-mapper</em>.</p>
</div>
<div class="paragraph">
<p>Adding a permission mapper takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">sim</span></span>ple-permission-mapper=<span class="key">PermissionMapperName</span>:add(...)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-role-mapper">4.5.5. Create an Elytron Role Mapper</h4>
<div class="paragraph">
<p>A role mapper maps roles after they have been decoded to other roles.
Examples include normalizing role names or adding and removing specific
roles from principals after they have been decoded. Role mappers are
also specifically typed based on their functionality, for example
<em>add-prefix-role-mapper</em>, <em>add-suffix-role-mapper</em>, and
<em>constant-role-mapper</em>.</p>
</div>
<div class="paragraph">
<p>Adding a role mapper takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span><span class="constant">ROLEM</span>-<span class="constant">MAPPER</span>-<span class="constant">TYPE</span>=<span class="key">roleMapperName</span>:add(...)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-security-domain">4.5.6. Create an Elytron Security Domain</h4>
<div class="paragraph">
<p>Security domains in the Elytron subsystem, when used in conjunction with
security realms, are use for both core management authentication as well
as for authentication with applications.</p>
</div>
<div class="paragraph">
<p>Adding a security domain takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>curity-domain=<span class="key">domainName</span>:add(realms=[{realm=realmName,role-decoder=roleDecoderName}],default-realm=realmName,permission-mapper=permissionMapperName,role-mapper=roleMapperName,...)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-authentication-factory">4.5.7. Create an Elytron Authentication Factory</h4>
<div class="paragraph">
<p>An authentication factory is an authentication policy used for specific
authentication mechanisms. Authenticaion factories are specifically
based on the authentication mechanism, for example
<em>http-authentication-factory</em> and<br>
<em>sasl-authentication-factory</em> and <em>kerberos-security-factory</em>.</p>
</div>
<div class="paragraph">
<p>Adding an authentication factory takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span><span class="constant">AUTH</span>-<span class="constant">FACTORY</span>-<span class="constant">TYPE</span>=<span class="key">authFactoryName</span>:add(....)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-elytron-policy-provider">4.5.8. Create an Elytron Policy Provider</h4>
<div class="paragraph">
<p>Elytron subsystem provides a specific resource definition that can be
used to configure a default ruby Policy provider. The subsystem allows
you to define multiple policy providers but select a single one as the
default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>policy=policy-provider-<span class="key">a</span>:add(custom-policy=<span class="error">\</span>[{name=policy-provider-a, <span class="keyword">class</span>-name=<span class="constant">MyPolicyProviderA</span>, <span class="keyword">module</span>=x.y.z}<span class="error">\</span>])</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_WildFly_Elytron_with_WildFly">5. Using Elytron within WildFly</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="using-the-out-of-the-box-elytron-components">5.1. Using the Out of the Box Elytron Components</h3>
<div class="sect3">
<h4 id="securing-management-interfaces">5.1.1. Securing Management Interfaces</h4>
<div class="paragraph">
<p>You can find more details on the enabling WildFly to use the out of the
box Elytron components for securing the management interfaces in the
<a href="Elytron_Subsystem.html#src-557147_ElytronSubsystem-DefaultManagementAuthenticationConfiguration">Default
Management Authentication Configuration</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="securing-applications">5.1.2. Securing Applications</h4>
<div class="paragraph">
<p>The <em>elytron</em> subsystem provides <em>application-http-authentication</em> by
default which can be used to secure applications. For more details on
how <em>application-http-authentication</em> is configured, see the
<a href="Elytron_Subsystem.html#src-557147_ElytronSubsystem-OutoftheBoxConfiguration">Out
of the Box Configuration</a> section.</p>
</div>
<div class="paragraph">
<p>To configure applications to use <em>application-http-authentication</em>, see
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ConfigureApplicationstoUseElytronorLegacySecurityforAuthentication">Configure
Applications to Use Elytron or Legacy Security for Authentication</a>. You
can also override the default behavior of all applications using the
steps in
<a href="Using_the_Elytron_Subsystem.html#src-557140_safe-id-VXNpbmd0aGVFbHl0cm9uU3Vic3lzdGVtLU92ZXJyaWRlYW5BcHBsaWNhdGlvbidzQXV0aGVudGljYXRpb25Db25maWd1cmF0aW9u">Override
an Application&#8217;s Authentication Configuration</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-ssltls">5.1.3. Using SSL/TLS</h4>
<div class="paragraph">
<p>WildFly does provide a default one-way SSL/TLS configuration using the
legacy core management authentication but does not provide one in the
<em>elytron</em> subsystem. You can find more details on configuring SSL/TLS
using the <em>elytron</em> subsystem for both the management interfaces as well
as for applications in
<a href="Using_the_Elytron_Subsystem.html#src-557140_UsingtheElytronSubsystem-ssl-tls">Configure
SSL/TLS</a></p>
</div>
</div>
<div class="sect3">
<h4 id="using-elytron-with-other-subsystems">5.1.4. Using Elytron with Other Subsystems</h4>
<div class="paragraph">
<p>In addition to securing applications and management interfaces, Elytron
also integrates with other subsystems in WildFly.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subsystem</th>
<th class="tableblock halign-left valign-top">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">batch-jberet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can configure the batch-jberet to run batch jobs
using an Elytron security domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can use a credential store or an Elytron security
domain to provide authentication information in a datasource definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messaging-activemq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can secure remote connections to the remote
connections used by the messaging-activemq subsystem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iiop-openjdk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can use the elytron subsystem to configure SSL/TLS
between clients and servers using the iiop-openjdk subsystem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can use a credential store to provide authentication
information in a server definition in the mail subsystem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">undertow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can use the elytron subsystem to configure both SSL/TLS
and application authentication.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="undertow-subsystem">5.2. Undertow Subsystem</h3>
<div class="paragraph">
<p>As a web application is deployed the name of the security domain required by that application will be identified, this will either be from within the deployment or if the deployment does not have a security domain the <code>default-security-domain</code> as defined on the Undertow subsystem will be assumed.  By default it is assumed that the security domain maps to a PicketBox domain defined in the legacy security subsystem, however an <code>application-security-domain</code> resource can be added to the Undertow subsystem which maps from the name of the security domain required by the application to the appropriate WildFly Elytron configuration.</p>
</div>
<div class="paragraph">
<p>As an example in it&#8217;s simplest form a mapping can be added as: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">MyAppSecurity</span>:add(security-domain=<span class="constant">ApplicationDomain</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:undertow:7.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span> <span class="attribute-name">default-security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">other</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
    <span class="tag">&lt;application-security-domains&gt;</span>
        <span class="tag">&lt;application-security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyAppSecurity</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationDomain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/application-security-domains&gt;</span>
...
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Note: If the deployment was already deployed at this point the
application server should be reloaded or the deployment redeployed for
the application security domain mapping to take effect.</em></p>
</div>
<div class="paragraph">
<p>Here we are mapping from the applications security domain <code>MyAppSecurity</code> to the WildFly Elytron defined domain <code>ApplicationDomain</code>.</p>
</div>
<div class="paragraph">
<p>This simple form is suitable where a deployment is using the standard HTTP mechanisms as defined within the Servlet specification i.e. <code>BASIC</code>, <code>CLIENT_CERT</code>, <code>DIGEST</code>, <code>FORM</code> and authentication will be performed against the <code>ApplicationDomain</code> security domain.  This form is also suitable where an application is not using any authentication mechanisms and instead is using programatic authentication or even wishes to obtain the SecurityDomain associated with the deployment and use it directly.</p>
</div>
<div class="paragraph">
<p>An advanced form of the mapping can be added as: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">MyAppSecurity</span>:add(http-authentication-factory=application-http-authentication)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:undertow:7.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span> <span class="attribute-name">default-security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">other</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
    <span class="tag">&lt;application-security-domains&gt;</span>
        <span class="tag">&lt;application-security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyAppSecurity</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">http-authentication-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-http-authentication</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/application-security-domains&gt;</span>
...
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this form of the configuration instead of referencing a security domain a <code>http-authentication-factory</code> is referenced instead, this is the factory that will be used to obtain the instances of the authentication mechansisms and is in turn associated with the security domain.  The standard mechanisms as defined in the Servlet specification can be used in this way but this approach also allows for other mechanisms to be used such as <code>SPNEGO</code> which requires additional configuration or even plug-in custom mechanism implementations.</p>
</div>
<div class="paragraph">
<p>When the advanced form of the mapping is used a further configuration option is available: -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>override-deployment-config</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The referenced <code>http-authentication-factory</code> can return a complete set of authentication mechanisms, by default these are filtered to just match the mechanisms requested by the application - if this option is set to <code>true</code> then the mechanisms offered by the factory will override the mechanisms requested by the application.  One example of where this could be useful is say an application has been developed to support <code>FORM</code> authentication, by overriding the mechanisms the application could be updated to support <code>SPNEGO</code>, and <code>FORM</code> authentication without any modifications to the deployment.</p>
</div>
<div class="paragraph">
<p>The <code>application-security-domain</code> resource also has one additional option <code>enable-jacc</code>, if this is set to true JACC will be enabled for any deployments matching against this mapping.</p>
</div>
<div class="sect3">
<h4 id="runtime-information">5.2.1. Runtime Information</h4>
<div class="paragraph">
<p>Where an <code>application-security-domain</code> mapping is in use it can be useful to double check that deployments did match against it as expected, if the resource is read with <code>include-runtime=true</code> the deployments that are associated with the mapping will also be shown: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /] /subsystem=undertow/application-security-domain=MyAppSecurity:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "enable-jacc" =&gt; false,
        "http-authentication-factory" =&gt; undefined,
        "override-deployment-config" =&gt; false,
        "referencing-deployments" =&gt; ["simple-webapp.war"],
        "security-domain" =&gt; "ApplicationDomain",
        "setting" =&gt; undefined
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>In this output the <code>referencing-deployments</code> attribute shows that the deployment <code>simple-webapp.war</code> has been deployed using this mapping.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ejb-subsystem">5.3. EJB Subsystem</h3>
<div class="paragraph">
<p>Configuration can be added to the EJB subsystem to map a security domain
name referenced in a deployment to an Elytron security domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=ejb3</span><span class="delimiter">/</span></span>application-security-domain=<span class="key">MyAppSecurity</span>:add(security-domain=<span class="constant">ApplicationDomain</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:ejb3:5.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
    <span class="tag">&lt;application-security-domains&gt;</span>
        <span class="tag">&lt;application-security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyAppSecurity</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationDomain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/application-security-domains&gt;</span>
...
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Note: If the deployment was already deployed at this point the
application server should be reloaded or the deployment redeployed for
the application security domain mapping to take effect.</em></p>
</div>
<div class="paragraph">
<p>An <code>application-security-domain</code> has two main attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name - the name of the security domain as specified in a deployment</p>
</li>
<li>
<p>security-domain - a reference to the Elytron security domain that
should be used</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an application security domain mapping is configured for a bean in
a deployment, this indicates that security should be handled by Elytron.</p>
</div>
</div>
<div class="sect2">
<h3 id="webservices-subsystem">5.4. WebServices Subsystem</h3>
<div class="paragraph">
<p>There is adapter in webservices subsystem to make authentication works
for elytron security domain automatically. Like configure with legacy
security domain, you can configure elytron security domain in deployment
descriptor or annotation to secure webservice endpoint.</p>
</div>
<div class="paragraph">
<p>When Elytron security is enabled, JAAS subject or principal can be pushed
to jbossws-cxf endpoint’s SecurityContext to propagate authenticated
identity to EJB container. Here is a CXF interceptor example to
propagate authenticated information to EJB container :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PropagateSecurityInterceptor</span> <span class="directive">extends</span> WSS4JInInterceptor {

   <span class="directive">public</span> PropagateSecurityInterceptor() {
      <span class="local-variable">super</span>();
      getAfter().add(PolicyBasedWSS4JInInterceptor.class.getName());
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> handleMessage(SoapMessage message) <span class="directive">throws</span> Fault {
      ...
      final Endpoint endpoint = message.getExchange().get(Endpoint.class);
      <span class="directive">final</span> SecurityDomainContext securityDomainContext = endpoint.getSecurityDomainContext();
      <span class="comment">//push subject principal retrieved from CXF to ElytronSecurityDomainContext</span>
      securityDomainContext.pushSubjectContext(subject, principal, <span class="predefined-constant">null</span>)
   }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-security-subsystem">5.5. Legacy Security Subsystem</h3>
<div class="paragraph">
<p>As previously described, Elytron based security is configured by
chaining together different capability references to form a complete
security policy. To allow an incremental migration from the legacy
Security subsystem some of the major components of this subsystem can be
mapped to Elytron capabilities and used within an Elytron based set up.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Client_Authentication_with_Elytron_Client">6. Client Authentication with Elytron Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly Elytron uses the Elytron Client project to enable remote clients
to authenticate using Elytron. Elytron Client has the following
components:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains authentication information such
as usernames, passwords, allowed SASL mechanisms, and the security realm
to use during digest authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MatchRule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rule used for deciding which authentication configuration to
use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of rules and authentication configurations
to use with a client for establishing a connection.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a connection is established, the client makes use of an
authentication context, which gives rules that match which
authentication configuration is used with an outbound connection. For
example, you could have a rules that use one authentication
configuration when connecting to <em>server1</em> and another authentication
configuration when connecting with <em>server2</em>. The authentication context
is comprised of a set of authentication configurations and a set of
rules that define how they are selected when establishing a connection.
An authentication context can also reference <em>ssl-context</em> and can be
matched with rules.</p>
</div>
<div class="paragraph">
<p>To create a client that uses security information when establishing a
connection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create one or more authentication configurations.</p>
</li>
<li>
<p>Create an authentication context by creating rule and authentication
configuration pairs.</p>
</li>
<li>
<p>Create a runnable for establishing your connection.</p>
</li>
<li>
<p>Use your authentication context to run your runnable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you establish your connection, Elytron Client will use the set of
rules provided by the authentication context to match the correct
authentication configuration to use during authentication.</p>
</div>
<div class="paragraph">
<p>You can use one of the following approaches to use security information
when establishing a client connection.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: When using Elytron Client to make EJB calls, any hard-coded
programatic authentication information, such as setting
<em>Context.SECURITY_PRINCIPAL</em> in the <em>javax.naming.InitialContext</em>, will
override the Elytron Client configuration.</p>
</div>
<div class="sect2">
<h3 id="the-configuration-file-approach">6.1. The Configuration File Approach</h3>
<div class="paragraph">
<p>The configuration file approach involves creating an XML file with your
authentication configuration, authentication context, and match rules.</p>
</div>
<div class="paragraph">
<p><strong>custom-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;authentication-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:elytron:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;authentication-rules&gt;</span>
            <span class="tag">&lt;rule</span> <span class="attribute-name">use-configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">monitor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;match-host</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/rule&gt;</span>
            <span class="tag">&lt;rule</span> <span class="attribute-name">use-configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">administrator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;match-host</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/rule&gt;</span>
        <span class="tag">&lt;/authentication-rules&gt;</span>
        <span class="tag">&lt;authentication-configurations&gt;</span>
            <span class="tag">&lt;configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">monitor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;allow-sasl-mechanisms</span> <span class="attribute-name">names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                 <span class="tag">&lt;use-service-loader-providers</span> <span class="tag">/&gt;</span>
                 <span class="tag">&lt;set-user-name</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">monitor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                 <span class="tag">&lt;credentials&gt;</span>
                     <span class="tag">&lt;clear-password</span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password1!</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                 <span class="tag">&lt;/credentials&gt;</span>
                 <span class="tag">&lt;set-mechanism-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
             <span class="tag">&lt;/configuration&gt;</span>

             <span class="tag">&lt;configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">administrator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;allow-sasl-mechanisms</span> <span class="attribute-name">names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                 <span class="tag">&lt;use-service-loader-providers</span> <span class="tag">/&gt;</span>
                 <span class="tag">&lt;set-user-name</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">administrator</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                 <span class="tag">&lt;credentials&gt;</span>
                     <span class="tag">&lt;clear-password</span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password1!</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                 <span class="tag">&lt;/credentials&gt;</span>
                 <span class="tag">&lt;set-mechanism-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
             <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/authentication-configurations&gt;</span>
    <span class="tag">&lt;/authentication-client&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then reference that file in your client&#8217;s code by setting a
system property when running your client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ java -Dwildfly.config.url=/path/to/the.xml .....</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT</strong>: If you use the
<a href="#the-programmatic-approach">The
Programmatic Approach</a>, it will override any provided configuration
files even if the <em>wildfly.config.url</em> system property is set.</p>
</div>
<div class="paragraph">
<p>When creating rules, you can look for matches on various parameters such
as hostname, port, protocol, or username. A full list of options for
<em>MatchRule</em> are available in the
<a href="http://wildfly-security.github.io/wildfly-elytron/org/wildfly/security/auth/client/MatchRule.html">Javadocs</a>.
Rules are evaluated in the order in which they are configured.</p>
</div>
<div class="paragraph">
<p><strong>Common Rules</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rule</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the security
domain to match against.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the hostname to
match against. For example, the host 127.0.0.1 would match on
<a href="http://127.0.0.1:9990/my/path" class="bare">http://127.0.0.1:9990/my/path</a> .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-no-userinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches against URIs with no userinfo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the path to match
against. For example, the path /my/path/ would match on
<a href="http://127.0.0.1:9990/my/path" class="bare">http://127.0.0.1:9990/my/path</a> .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the port to match
against. For example, the port 9990 would match on
<a href="http://127.0.0.1:9990/my/path" class="bare">http://127.0.0.1:9990/my/path</a> .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the protocol
to match against. For example, the protocol http would match on
<a href="http://127.0.0.1:9990/my/path" class="bare">http://127.0.0.1:9990/my/path</a> .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-purpose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a names attribute specifying the list of purposes
to match against.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-urn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the URN to match
against.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">match-userinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a single name attribute specifying the userinfo
to match against.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="the-programmatic-approach">6.2. The Programmatic Approach</h3>
<div class="paragraph">
<p>The programatic approach configures all the Elytron Client configuration
in the client&#8217;s code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//create your authentication configuration</span>
AuthenticationConfiguration adminConfig =
    AuthenticationConfiguration.EMPTY
      .useProviders(() -&gt; <span class="keyword">new</span> <span class="predefined-type">Provider</span><span class="type">[]</span> { <span class="keyword">new</span> WildFlyElytronProvider() })
      .allowSaslMechanisms(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>)
      .useRealm(<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>)
      .useName(<span class="string"><span class="delimiter">&quot;</span><span class="content">administrator</span><span class="delimiter">&quot;</span></span>)
      .usePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">password1!</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span>
<span class="comment">//create your authentication context</span>
AuthenticationContext context = AuthenticationContext.empty();
context = context.with(MatchRule.ALL.matchHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>), adminConfig);
<span class="error"> </span>
<span class="error"> </span>
<span class="comment">//create your runnable for establishing a connection</span>
<span class="predefined-type">Runnable</span> runnable =
    <span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
      <span class="directive">public</span> <span class="type">void</span> run() {
        <span class="keyword">try</span> {
           <span class="comment">//Establish your connection and do some work</span>
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
          e.printStackTrace();
        }
      }
    };
<span class="error"> </span>
<span class="comment">//use your authentication context to run your client</span>
context.run(runnable);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When adding configuration details to <em>AuthenticationConfiguration</em> and
<em>AuthenticationContext</em>, each method call returns a new instance of that
object. For example, if you wanted separate configurations when
connecting over different hostnames, you could do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//create your authentication configuration</span>
AuthenticationConfiguration commonConfig =
    AuthenticationConfiguration.EMPTY
      .useProviders(() -&gt; <span class="keyword">new</span> <span class="predefined-type">Provider</span><span class="type">[]</span> { <span class="keyword">new</span> WildFlyElytronProvider() })
      .allowSaslMechanisms(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span>)
      .useRealm(<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span>
AuthenticationConfiguration administrator =
    commonConfig
      .useName(<span class="string"><span class="delimiter">&quot;</span><span class="content">administrator</span><span class="delimiter">&quot;</span></span>)
      .usePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">password1!</span><span class="delimiter">&quot;</span></span>);


AuthenticationConfiguration monitor =
    commonConfig
      .useName(<span class="string"><span class="delimiter">&quot;</span><span class="content">monitor</span><span class="delimiter">&quot;</span></span>)
      .usePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">password1!</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span>
<span class="error"> </span>
<span class="comment">//create your authentication context</span>
AuthenticationContext context = AuthenticationContext.empty();
context = context.with(MatchRule.ALL.matchHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>), administrator);
context = context.with(MatchRule.ALL.matchHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>), monitor);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common Rules</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rule</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchLocalSecurityDomain(String name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-domain
in the configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchNoUser()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-no-user in the configuration
file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchPath(String pathSpec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-path in the
configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchPort(int port)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-port in the
configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchProtocol(String protoName)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-port in the
configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchPurpose(String purpose)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new rule which is the same as
this rule, but also matches the given purpose name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchPurposes(String&#8230;&#8203; purposes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-purpose in
the configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchUrnName(String name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-urn in the
configuration file approach.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchUser(String userSpec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the same as match-userinfo in the
configuration file approach.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Also, instead of starting with an empty authentication configuration,
you can start with the current configured one by using
<em>captureCurrent()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//create your authentication configuration</span>
AuthenticationConfiguration commonConfig = AuthenticationConfiguration.captureCurrent();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <em>captureCurrent()</em> will capture any previously established
authentication context and use it as your new base configuration. A
authentication context is established once its been activated by calling
<em>run()</em>. If <em>captureCurrent()</em> is called and no context is currently
active, it will try and use the default authentication if available. You
can find more details about this in
<a href="#the-configuration-file-approach">The
Configuration File Approach</a>,
<a href="#the-default-configuration-approach">The
Default Configuration Approach</a>, and
<a href="#src-557099_ClientAuthenticationwithElytronClient-UsingElytronClientwithClientsDeployedtoWildFly">Using
Elytron Client with Clients Deployed to WildFly</a> sections.</p>
</div>
<div class="paragraph">
<p>Using <em>AuthenticationConfiguration.EMPTY</em> should only be used as a base
to build a configuration on top of and should not be used on its own. It
provides a configuration that uses the JVM-wide registered providers and
enables anonymous authentication.</p>
</div>
<div class="paragraph">
<p>When specifying the providers on top of the
<em>AuthenticationConfiguration.EMPTY</em> configuration, you can specify a
custom list, but most users should use <em>WildFlyElytronProvider()</em>
providers.</p>
</div>
<div class="paragraph">
<p>When creating an authentication context, using the <em>context.with(&#8230;&#8203;)</em>
will create a new context that merges the rules and authentication
configuration from the current context with the provided rule and
authentication configuration. The provided rule and authentication
configuration will appear after the ones in the current context.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-default-configuration-approach">6.3. The Default Configuration Approach</h3>
<div class="paragraph">
<p>The default configuration approach relies completely on the
configuration provided by Elytron Client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//create your runnable for establishing a connection</span>
<span class="predefined-type">Runnable</span> runnable =
    <span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
      <span class="directive">public</span> <span class="type">void</span> run() {
        <span class="keyword">try</span> {
           <span class="comment">//Establish your connection and do some work</span>
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
          e.printStackTrace();
        }
      }
    };
<span class="error"> </span>
<span class="comment">// run runnable directly</span>
runnable.run();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To provide a default configuration, Elytron Client tries to
auto-discover a <em>wildfly-config.xml</em> file on the filesystem. It looks in
the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Location specified by the <em>wildfly.config.url</em> system property set
outside of the client code.</p>
</li>
<li>
<p>The classpath root directory.</p>
</li>
<li>
<p>The <em>META-INF</em> directory on the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If it does not find one, it will try and use the default
<em>wildfly-config.xml</em> provided in the
<em>$WILDFLY_HOME/bin/client/jboss-client.jar</em>.</p>
</div>
<div class="paragraph">
<p><strong>default wildfly-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
  <span class="tag">&lt;authentication-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:elytron:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;authentication-rules&gt;</span>
      <span class="tag">&lt;rule</span> <span class="attribute-name">use-configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/authentication-rules&gt;</span>
    <span class="tag">&lt;authentication-configurations&gt;</span>
      <span class="tag">&lt;configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;allow-all-sasl-mechanisms</span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;set-mechanism-properties&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wildfly.sasl.local-user.quiet-auth</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/set-mechanism-properties&gt;</span>
        <span class="tag">&lt;use-service-loader-providers</span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/configuration&gt;</span>
    <span class="tag">&lt;/authentication-configurations&gt;</span>
  <span class="tag">&lt;/authentication-client&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-elytron-client-with-clients-deployed-to-wildfly">6.4. Using Elytron Client with Clients Deployed to WildFly</h3>
<div class="paragraph">
<p>Clients deployed to WildFly can also make use of Elytron Client. In
cases where you have included a <em>wildfly-config.xml</em> with your
deployment or the system property has been set, an
<em>AuthenticationContext</em> is automatically parsed and created from that
file.</p>
</div>
<div class="paragraph">
<p>To load a configuration file outside of the deployment, you can use the
<em>parseAuthenticationClientConfiguration(URI)</em> method. This method will
return an <em>AuthentcationContext</em> which you can then use in your client&#8217;s
code using the
<a href="#the-programmatic-approach">The
Programmatic Approach</a>.</p>
</div>
<div class="paragraph">
<p>Additionally, clients will also automatically parse and create an
AuthenticationContext from the client configuration provided by the
<em>elytron</em> subsystem. The client configuration in the <em>elytron</em> subsystem
can also take advantage of other components defined in the <em>elytron</em>
subsystem such as credential stores. If client configuration is provided
by BOTH the deployment and the <em>elytron</em> subsystem, the <em>elytron</em>
subsystem&#8217;s configuration is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_other_clients_using_wildfly-config">6.5. Client configuration using wildfly-config.xml</h3>
<div class="paragraph">
<p>Prior to WildFly 11, many WildFly client libraries used different configuration strategies. WildFly 11 introduces a new <code>wildfly-config.xml</code> file which unifies all client configuration in a single place. In addition to being able to configure authentication using Elytron as described in the previous section, a <code>wildfly-config.xml</code> file can also be used to:</p>
</div>
<div class="sect3">
<h4 id="configure-ejb-client-connections-global-interceptors-and-invocation-timeout">6.5.1. Configure EJB client connections, global interceptors, and invocation timeout</h4>
<div class="paragraph">
<p>Schema location: [<a href="https://github.com/wildfly/jboss-ejb-client/blob/4.0.2.Final/src/main/resources/schema/wildfly-client-ejb_3_0.xsd" class="bare">https://github.com/wildfly/jboss-ejb-client/blob/4.0.2.Final/src/main/resources/schema/wildfly-client-ejb_3_0.xsd</a>]</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">wildfly-config.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
...
    <span class="tag">&lt;jboss-ejb-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:wildfly-client-ejb:3.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;invocation-timeout</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;connections&gt;</span>
            <span class="tag">&lt;connection</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote+http://10.20.30.40:8080</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/connections&gt;</span>
        <span class="tag">&lt;global-interceptors&gt;</span>
            <span class="tag">&lt;interceptor</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.example.ExampleInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/global-interceptors&gt;</span>
    <span class="tag">&lt;/jboss-ejb-client&gt;</span>
...
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-http-client">6.5.2. Configure HTTP client</h4>
<div class="paragraph">
<p>Schema location:[<a href="https://github.com/wildfly/wildfly-http-client/blob/1.0.2.Final/common/src/main/resources/schema/wildfly-http-client_1_0.xsd" class="bare">https://github.com/wildfly/wildfly-http-client/blob/1.0.2.Final/common/src/main/resources/schema/wildfly-http-client_1_0.xsd</a>]</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">wildfly-config.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
...
    <span class="tag">&lt;http-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly-http-client:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;defaults&gt;</span>
            <span class="tag">&lt;eagerly-acquire-session</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;buffer-pool</span> <span class="attribute-name">buffer-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">direct</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">thread-local-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/defaults&gt;</span>
    <span class="tag">&lt;/http-client&gt;</span>
...
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-a-remoting-endpoint">6.5.3. Configure a remoting endpoint</h4>
<div class="paragraph">
<p>Schema location:[<a href="https://github.com/jboss-remoting/jboss-remoting/blob/5.0.1.Final/src/main/resources/schema/jboss-remoting_5_0.xsd" class="bare">https://github.com/jboss-remoting/jboss-remoting/blob/5.0.1.Final/src/main/resources/schema/jboss-remoting_5_0.xsd</a>]</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">wildfly-config.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
...
    <span class="tag">&lt;endpoint</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss-remoting:5.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;connections&gt;</span>
            <span class="tag">&lt;connection</span> <span class="attribute-name">destination</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote+http://10.20.30.40:8080</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">read-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">write-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">heartbeat-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/connections&gt;</span>
    <span class="tag">&lt;/endpoint&gt;</span>
...
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configure-the-default-xnio-worker">6.5.4. Configure the default XNIO worker</h4>
<div class="paragraph">
<p>Schema location:[<a href="https://github.com/xnio/xnio/blob/3.5.1.Final/api/src/main/resources/schema/xnio_3_5.xsd" class="bare">https://github.com/xnio/xnio/blob/3.5.1.Final/api/src/main/resources/schema/xnio_3_5.xsd</a>]</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="paragraph">
<p><strong>wildfly-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
...
    <span class="tag">&lt;worker</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:xnio:3.5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;io-threads</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;task-keepalive</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;stack-size</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/worker&gt;</span>
...
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that WildFly client libraries do have reasonable default configuration. Thus, adding configuration for these clients to <code>wildfly-config.xml</code> isn’t mandatory.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Elytron_and_Java_Authorization_Contract_for_Containers-JACC">7. Elytron and Java Authorization Contract for Containers (JACC)</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
This document will guide you on how to enable JACC using Elytron
Subsystem.
</blockquote>
</div>
<div class="sect2">
<h3 id="disabling-jacc-in-legacy-security-subsystem-picketbox">7.1. Disabling JACC in Legacy Security Subsystem (PicketBox)</h3>
<div class="paragraph">
<p>By default, the application server uses the legacy security subsystem
(PicketBox) to configure the JACC policy provider and factory. The
default configuration maps to implementations from PicketBox.</p>
</div>
<div class="paragraph">
<p>In order to use Elytron to manage JACC configuration (or any other
policy you want to install to the application server) you must first
disable JACC in legacy security subsystem. For that, please execute the
following CLI command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=security:write-attribute(name=initialize-jacc, value=false)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The command above tells the legacy security subsystem to not initialize
any JACC related configuration, but rely on the policies defined via
Elytron subsystem as we&#8217;ll see in the next sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-a-jacc-policy-provider">7.2. Defining a JACC Policy Provider</h3>
<div class="paragraph">
<p>Elytron subsystem provides a built-in policy provider based on JACC
specification. To create the policy provider you can execute a CLI
command as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone<span class="instance-variable">@localhost</span>:<span class="integer">9990</span> /] /subsystem=elytron/policy=<span class="key">jacc</span>:add(jacc-policy={})</code></pre>
</div>
</div>
<div class="paragraph">
<p>After executing the command above, please reload the server
configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone<span class="instance-variable">@localhost</span>:<span class="integer">9990</span> /] reload</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-jacc-to-a-web-deployment">7.3. Enabling JACC to a Web Deployment</h3>
<div class="paragraph">
<p>Once JACC Policy Provider is defined you can enable JACC to web
deployments by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone<span class="instance-variable">@localhost</span>:<span class="integer">9990</span> /] /subsystem=undertow/application-security-domain=<span class="key">other</span>:add(http-authentication-factory=application-http-authentication,enable-jacc=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command above defines a default security domain for applications if
none is provided in <strong>jboss-web.xml.</strong> In case you already have a
<strong>application-security-domain</strong> defined and just want to enable JACC you
can execute a command as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone<span class="instance-variable">@localhost</span>:<span class="integer">9990</span> /] /subsystem=undertow/application-security-domain=my-security-<span class="key">domain</span>:write-attribute(name=enable-jacc,value=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-jacc-to-a-ejb-deployment">7.4. Enabling JACC to a EJB Deployment</h3>
<div class="paragraph">
<p>Once JACC Policy Provider is defined you can enable JACC to EJB
deployments by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone<span class="instance-variable">@localhost</span>:<span class="integer">9990</span> /] /subsystem=ejb3/application-security-domain=<span class="key">other</span>:add(security-domain=<span class="constant">ApplicationDomain</span>,enable-jacc=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command above defines a default security domain for EJBs. In case
you already have a *application-security-domain *defined and just want
to enable JACC you can execute a command as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone<span class="instance-variable">@localhost</span>:<span class="integer">9990</span> /] /subsystem=ejb3/application-security-domain=my-security-<span class="key">domain</span>:write-attribute(name=enable-jacc,value=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="KeyCloak_Integration">8. Using KeyCloak with WildFly Elytron</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TBD</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Bearer_Token_Authorization">9. Bearer Token Authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Bearer Token Authorization is the process of authorizing HTTP requests based on the existence and validity of a bearer
token representing a subject and his access context, where the token provides valuable information to determine the subject of the call as well whether or not a HTTP resource
can be accessed.</p>
</div>
<div class="paragraph">
<p>Elytron supports bearer token authorization by providing a <code>BEARER_TOKEN</code> HTTP authentication mechanism based on <a href="https://tools.ietf.org/html/rfc6750">RFC-6750</a> and
an specific <code>realm</code> implementation, the <code>token-realm</code>, to validate tokens using the JWT format (for instance, OpenID Connect ID Tokens) or opaque tokens issued by any OAuth2 compliant
authorization server.</p>
</div>
<div class="sect2">
<h3 id="how-it-works">9.1. How it Works</h3>
<div class="paragraph">
<p>When a HTTP request arrives to your application, the <code>BEARER_TOKEN</code> mechanism will check if a bearer token was provided by checking the existence of an <code>Authorization</code> HTTP header with the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">GET /resource HTTP/1.1
Host: server.example.com
Authorization: Bearer mF_9.B5f-4.1JqM</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no bearer token was provided, the mechanism will respond with a <code>401</code> HTTP status code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm=&quot;example&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a bearer token is provided, the mechanism will extract the token from the request (in the example above, the token is represented by the string <code>mF_9.B5f-4.1JqM</code>) and pass it over
to the <code>token-realm</code> in order to check if the token is valid and can be used to build a security context based on its information. Note that the <code>BEARER_TOKEN</code> mechanism is only responsible to
check and extract bearer tokens from an HTTP request, whereas the <code>token-realm</code> is the one responsible for validating the token.</p>
</div>
<div class="paragraph">
<p>If validation succeeds, a security context will be created based on the information represented by the token and the application can use the newly created
security context to obtain information about the subject making the request as well decide whether or not the request should be full filled. In case the validation fails,
the mechanism will respond with a <code>403</code> HTTP status code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">HTTP/1.1 403 Forbidden</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validating-jwt-tokens">9.2. Validating JWT Tokens</h3>
<div class="paragraph">
<p>Elytron provides built-in support for JWT tokens, which can be enabled by defining a <code>realm</code> in the Elytron subsystem as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;token-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JwtRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">principal-claim</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sub</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;jwt</span> <span class="attribute-name">issuer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">as.example.com</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">audience</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">api.example.com</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">public-key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-----BEGIN PUBLIC KEY-----MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCqGKukO1De7zhZj6+H0qtjTkVxwTCpvKe4eCZ0FPqri0cb2JZfXJ/DgYSF6vUpwmJG8wVQZKjeGcjDOL5UlsuusFncCzWBQ7RKNUSesmQRMSGkVb1/3j+skZ6UtW+5u09lHNsj6tQ51s1SPrCBkedbNf0Tp0GbMJDyR4e9T04ZZwIDAQAB-----END PUBLIC KEY-----</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
 <span class="tag">&lt;/token-realm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>token-realm</code> is defined with a <code>principal-claim</code> attribute. This attribute specifies which claim
within the token should be used to identity the principal. If you have a token as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"> {
   <span class="key"><span class="delimiter">&quot;</span><span class="content">iss</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">as.example.com</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">sub</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">24400320</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">aud</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">s6BhdRkqt3</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">exp</span><span class="delimiter">&quot;</span></span>: <span class="integer">1311281970</span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">nbf</span><span class="delimiter">&quot;</span></span>: <span class="integer">1311280970</span>,
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Elytron will use the value associated with the <code>sub</code> claim as the identifier of the subject represented by the token.</p>
</div>
<div class="paragraph">
<p>The <code>jwt</code> element within the <code>token-realm</code> specifies that tokens should be validated as JWT and provides different configuration options on how they
should be validated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>issuer</strong></p>
<div class="paragraph">
<p>A list of strings representing the issuers supported by this configuration. During validation JWT tokens must have an "iss" claim that contains one of the values defined here</p>
</div>
</li>
<li>
<p><strong>audience</strong></p>
<div class="paragraph">
<p>A list of strings representing the audiences supported by this configuration. During validation JWT tokens must have an "aud" claim that contains one of the values defined here</p>
</div>
</li>
<li>
<p><strong>public-key</strong></p>
<div class="paragraph">
<p>A public key in PEM Format. During validation, if a public key is provided, signature will be verified based on the key you provided here. Alternatively,
you can define a <code>key-store</code> and <code>certificate</code> attributes to configure the public key.</p>
</div>
</li>
<li>
<p><strong>key-store</strong></p>
<div class="paragraph">
<p>As an alternative to <code>public-key</code>, you can also define a key store from where the certificate with a public key should be loaded from</p>
</div>
</li>
<li>
<p><strong>certificate</strong></p>
<div class="paragraph">
<p>The name of the certificate with a public key to load from the key store in case you defined the <code>key-store</code> attribute</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>jwt</code> validator performs different checks in order to determine the validity of a JWT:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expiration checks based on the values of the <code>exp</code> and <code>nbf</code> claims</p>
</li>
<li>
<p>Signature checks based on the public key provided via <code>public-key</code> or <code>certificate</code> attributes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is strongly recommended that you use signed JWTs in order to guarantee authenticity of tokens and make sure they were not tampered.</p>
</div>
</div>
<div class="sect2">
<h3 id="validating-oauth2-bearer-tokens">9.3. Validating OAuth2 Bearer Tokens</h3>
<div class="paragraph">
<p>Elytron provides built-in support for tokens issued by an OAuth2 compliant authorization server, where these tokens are validated
using a token introspection endpoint as defined by OAuth2 specification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;token-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OAuth2Realm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">principal-claim</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sub</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;oauth2-introspection</span> <span class="attribute-name">client-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-client-id</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">client-secret</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keep_it_secret</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">introspection-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://as.example.com/token/introspect</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">client-ssl-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user-defined-ssl-context</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">host-name-verification-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ANY</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/token-realm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>auth2-introspection</code> element within the <code>token-realm</code> specifies that tokens should be validated using an OAuth2 Token Introspection Endpoint and provides different configuration options on how they
should be validated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>client-id</strong></p>
<div class="paragraph">
<p>The identifier of the client on the OAuth2 Authorization Server</p>
</div>
</li>
<li>
<p><strong>client-secret</strong></p>
<div class="paragraph">
<p>The secret of the client</p>
</div>
</li>
<li>
<p><strong>introspection-url</strong></p>
<div class="paragraph">
<p>The URL of token introspection endpoint</p>
</div>
</li>
<li>
<p><strong>client-ssl-context</strong></p>
<div class="paragraph">
<p>The SSL context to be used if the introspection endpoint is using HTTPS.</p>
</div>
</li>
<li>
<p><strong>host-name-verification-policy</strong></p>
<div class="paragraph">
<p>A policy that defines how host names should be verified when using HTTPS. Allowed values: "ANY".</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="quickstarts">9.4. Quickstarts</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/wildfly/quickstart/tree/master/jaxrs-jwt">JAX-RS secured using JSON Web Tokens</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cli-examples-on-how-to-create-a-token-realm">9.5. CLI Examples on How to Create a Token Realm</h3>
<div class="listingblock">
<div class="title">Create a Token Realm to validate JWT tokens using a key store to retrieve the public key</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Create a Key Store
/subsystem=elytron/key-store=my-keystore:add(path=/path/to/keystore.jks,credential-reference={clear-text=secret},type=JKS)

# Create the realm
/subsystem=elytron/token-realm=jwt-realm:add(principal-claim=sub, jwt={issuer=[&quot;as.example.com&quot;], audience=[&quot;api.example.com&quot;], key-store=my-keystore, certificate=as.example.com})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create a Token Realm to validate OAuth2 tokens</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Create a Client SSLContext
/subsystem=elytron/key-store=default-trust-store:add(path=/path/to/keystore.jks,credential-reference={clear-text=secret},type=JKS)
/subsystem=elytron/trust-manager=default-trust-manager:add(algorithm=PKIX, key-store=default-trust-store)
/subsystem=elytron/client-ssl-context=default-client-ssl-context:add(trust-manager=default-trust-manager)

# Create the realm
/subsystem=elytron/token-realm=oauth2-realm:add(principal-claim=preferred_username, oauth2-introspection={client-id=my-client-id, client-secret=keep_it_secret, client-ssl-context=default-client-ssl-context, introspection-url=https://as.example.com/token/introspect})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="OpenSSL">10. OpenSSL</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="Web_Single_Sign_On">11. Web Single Sign-On</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document will guide on how to enable single sign-on across different applications deployed into different servers, where these applications belong to same security domain.</p>
</div>
<div class="sect2">
<h3 id="create-a-server-configuration-template">11.1. Create a Server Configuration Template</h3>
<div class="paragraph">
<p>For this document, you&#8217;ll need to run at least two server instances in order to check single sign-on and how it affect usability in your applications. Users should be able to log in once and have access to any application using the same security domain.</p>
</div>
<div class="paragraph">
<p>All configuration described in the next sections should be done with a server instance using <strong>standalone-ha.xml</strong> (or standalone-full-ha.xml).</p>
</div>
<div class="paragraph">
<p>Run a server instance using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin/standalone.sh -c standalone-ha.xml</pre>
</div>
</div>
<div class="sect3">
<h4 id="create-a-http-authentication-factory">11.1.1. Create a HTTP Authentication Factory</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you already have a <em>http-authentication-factory</em>&nbsp;defined in Elytron subsystem and just want to use it to enable single sign-on to your applications, please skip this section.{info}
First, you need a <em>security-domain</em> which we&#8217;ll use to authenticate users. Please, execute the following CLI commands:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre># Creates a FileSystem Realm, an identity store where users are stored in the local filesystem
/subsystem=elytron/filesystem-realm=example-realm:add(path=/tmp/example-realm)

# Creates a Security Domain
/subsystem=elytron/security-domain=example-domain:add(default-realm=example-realm, permission-mapper=default-permission-mapper,realms=[{realm=example-realm, role-decoder=groups-to-roles}]

# Creates an user that you can use to access your applications
/subsystem=elytron/filesystem-realm=example-realm:add-identity(identity=alice)
/subsystem=elytron/filesystem-realm=example-realm:add-identity-attribute(identity=alice, name=groups, value=["user"])
/subsystem=elytron/filesystem-realm=example-realm:set-password(identity=alice, clear={password=alice})</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can create a <em>http-authentication-factory</em> that you&#8217;ll use to actually protect your web applications using Undertow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Create a Http Authentication Factory
/subsystem=elytron/http-authentication-factory=example-http-authentication:add(security-domain=example-domain, http-server-mechanism-factory=global, mechanism-configurations=[{mechanism-name=FORM}]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-a-application-security-domain-in-undertow">11.1.2. Create a Application Security Domain in Undertow</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you already have a&nbsp;_application-security-domain_&nbsp;defined in Undertow subsystem and just want to use it to enable single sign-on to your applications, please skip this section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to protect applications using the configuration defined in Elytron subsystem, you should create a application-security-domain definition in Undertow subsystem as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/subsystem=undertow/application-security-domain=other:add(http-authentication-factory=example-http-authentication)</pre>
</div>
</div>
<div class="paragraph">
<p>By default, if your application does not define any specific <em>security-domain</em> in <em>jboss-web.xml</em>, the application server will choose one with a name <strong>other</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-a-key-store">11.1.3. Create a Key Store</h4>
<div class="paragraph">
<p>In order to create a <em>key-store</em> in Elytron subsystem, first create a Java Key Store as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">keytool -genkeypair -alias localhost -keyalg RSA -keysize 1024 -validity 365 -keystore keystore.jks -dname &quot;CN=localhost&quot; -keypass secret -storepass secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the <em>keystore.jks</em> file is created, execute the following CLI commands to create a <em>key-store</em> definition in Elytron:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/subsystem=elytron/key-store=example-keystore:add(path=keystore.jks, relative-to=jboss.server.config.dir, credential-reference={clear-text=secret}, type=JKS)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-single-sign-on">11.1.4. Enable Single Sign-On</h4>
<div class="paragraph">
<p>Single Sign-On is enabled to a specific <em>application-security-domain</em> definition in Undertow subsystem. It is important that the servers you will be using to deploy applications are using the same configuration.</p>
</div>
<div class="paragraph">
<p>To enable single-sign on, just change an existing application-security-domain in Undertow subsystem as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span></span>application-security-domain=other/setting=single-sign-<span class="key">on</span>:add(key-store=example-keystore, key-<span class="keyword">alias</span>=localhost, domain=localhost, credential-reference={clear-text=secret})</code></pre>
</div>
</div>
<div class="paragraph">
<p>After restarting the servers, users should be able to log in once and have access to any application using the same <em>application-security-domain</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-two-server-instances">11.2. Create Two Server Instances</h3>
<div class="paragraph">
<p>All configuration you did so far should be reflect in <em>$JBOSS_HOME</em>/<em>standalone/standalone-ha.xml.</em> You can now create two distinct server configuration directories_:\_</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cp -r standalone standalone-a
cp -r standalone standalone-b</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you can run the two instances using the command below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$JBOSS_HOME/bin/standalone.sh -c standalone-ha.xml -Djboss.node.name=node-a -Djboss.socket.binding.port-offset=200 -Djboss.server.base.dir=$JBOSS_HOME/standalone-a
$JBOSS_HOME/bin/standalone.sh -c standalone-ha.xml -Djboss.node.name=node-b -Djboss.socket.binding.port-offset=300 -Djboss.server.base.dir=$JBOSS_HOME/standalone-b ----</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-an-application">11.3. Deploy an Application</h3>
<div class="paragraph">
<p>For the sake of simplicity, these are the minimum files you need in your application:</p>
</div>
<div class="listingblock">
<div class="title">WEB-INF/web.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;web-app</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;security-constraint&gt;</span>
        <span class="tag">&lt;display-name&gt;</span>SecurityConstraint<span class="tag">&lt;/display-name&gt;</span>
        <span class="tag">&lt;web-resource-collection&gt;</span>
            <span class="tag">&lt;web-resource-name&gt;</span>All Resources<span class="tag">&lt;/web-resource-name&gt;</span>
            <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;/web-resource-collection&gt;</span>
        <span class="tag">&lt;auth-constraint&gt;</span>
            <span class="tag">&lt;role-name&gt;</span>user<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;/auth-constraint&gt;</span>
    <span class="tag">&lt;/security-constraint&gt;</span>

    <span class="tag">&lt;login-config&gt;</span>
        <span class="tag">&lt;auth-method&gt;</span>FORM<span class="tag">&lt;/auth-method&gt;</span>
        <span class="tag">&lt;form-login-config&gt;</span>
            <span class="tag">&lt;form-login-page&gt;</span>/login.html<span class="tag">&lt;/form-login-page&gt;</span>
            <span class="tag">&lt;form-error-page&gt;</span>/login.html<span class="tag">&lt;/form-error-page&gt;</span>
        <span class="tag">&lt;/form-login-config&gt;</span>
    <span class="tag">&lt;/login-config&gt;</span>

    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>user<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span>
<span class="tag">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">login.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_security_check</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Log In</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;/form&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure you have at least a welcome file (e.g.: index.html\|jsp).
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deploy your application into both server instances and try to log in using the user you created at the beginning of this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username: <strong>alice</strong></p>
</li>
<li>
<p>Password: <strong>alice</strong></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Custom_Components">12. Custom Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly Elytron subsystem allows to add custom implementation of different
components in form of WildFly modules into the WildFly instance and use them
by the same way as built-in Elytron subsystem components.
For example, you can create custom security event listener to develop custom
audit mechanisms and store information about user authentication attempts in
custom storage structure. Or you can create custom security realm to
authenticate users against your own identities storage.</p>
</div>
<div class="paragraph">
<p>To find what types of custom components you can implement you can use Tab
completion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /] /subsystem=elytron/custom-
custom-credential-security-factory  custom-realm
custom-modifiable-realm             custom-realm-mapper
custom-permission-mapper            custom-role-decoder
custom-principal-decoder            custom-role-mapper
custom-principal-transformer        custom-security-event-listener</pre>
</div>
</div>
<div class="sect2">
<h3 id="security-event-listener">12.1. Security event listener</h3>
<div class="paragraph">
<p>To create custom security event listener you need to implement <code>java.util.function.Consumer&lt;org.wildfly.security.auth.server.event.SecurityEvent&gt;</code> interface.
Resulting class needs to be packed into JAR and WildFly module created.
You can create appropriate directory structure and module descriptor manually, or you can use following command of WildFly CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin/jboss-cli.sh
module add --name=my.module --resources=my-listener.jar --dependencies=org.wildfly.security.elytron</pre>
</div>
</div>
<div class="paragraph">
<p>Check
<a href="Developer_Guide.html#Class_Loading_in_WildFly">Class loading doc</a>
for more information how to create WildFly module.</p>
</div>
<div class="paragraph">
<p>When appropriate module is on place, you can start using it by adding Elytron subsystem resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/subsystem=elytron/custom-security-event-listener=myListener:add(
        module=my.module, class-name=my.module.MyAuditListener)</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can start to use it as any other security event listener - typically to set it as listener of <code>ApplicationDomain</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/subsystem=elytron/security-domain=ApplicationDomain:write-attribute(name=security-event-listener, value=myListener)</pre>
</div>
</div>
<div class="paragraph">
<p>After server reload the listener will receive all security events from given security domain.</p>
</div>
</div>
<div class="sect2">
<h3 id="configurable-custom-components">12.2. Configurable custom components</h3>
<div class="paragraph">
<p>You can also provide some component configuration from the subsystem, if class of your component will implement following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public void initialize(Map&lt;String, String&gt; configuration)</pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards you can provide configuration into your component from the subsystem using attribute <code>configuration</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/subsystem=elytron/custom-...=my-component:add(module=..., class-name=..., configuration={myAttribute="myValue"})</pre>
</div>
</div>
<div class="paragraph">
<p>After the component construction, the <code>initialize</code> method will be called with the configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Migrate_Legacy_Security_to_Elytron_Security">13. Migrate Legacy Security to Elytron Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="authentication-configuration">13.1. Authentication Configuration</h3>

</div>
<div class="sect2">
<h3 id="Properties_File_Based_Authentication_Migration">13.2. Properties Based Authentication / Authorization</h3>
<div class="sect3">
<h4 id="picketbox-based-configuration">13.2.1. PicketBox Based Configuration</h4>
<div class="paragraph">
<p>This migration example assumes a deployed web application is configured
to require authentication using FORM based authentication and is
referencing a PicketBox based security domain using the
UsersRolesLoginModule to load user information from a pair or properties
files.</p>
</div>
<div class="sect4">
<h5 id="original-configuration">Original Configuration</h5>
<div class="paragraph">
<p>A security domain can be defined in the legacy security subsystem using
the following management operations: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-<span class="key">security</span>:add
./subsystem=security/security-domain=application-security/authentication=<span class="key">classic</span>:add(login-modules=[{code=<span class="constant">UsersRoles</span>, flag=<span class="constant">Required</span>, <span class="keyword">module</span>-options={usersProperties=<span class="key">file</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="error">$</span>{jboss.server.config.dir}/example-users.properties, rolesProperties=<span class="key">file</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="error">$</span>{jboss.server.config.dir}/example-roles.properties}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would result in a security domain definition: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;authentication&gt;</span>
      <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UsersRoles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">usersProperties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file://${jboss.server.config.dir}/example-users.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rolesProperties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file://${jboss.server.config.dir}/example-roles.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/login-module&gt;</span>
    <span class="tag">&lt;/authentication&gt;</span>
  <span class="tag">&lt;/security-domain&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="intermediate-configuration">Intermediate Configuration</h5>
<div class="paragraph">
<p>It is possible to take a previously defined PicketBox security domain
and expose it as an Elytron security realm so it can be wired into a
complete Elytron based configuration, if only properties based
authentication was to be migrated it would be recommended to jump to the
fully migration configuration and avoid the unnecessary dependency on
the legacy security subsystem but for situations where that is not
immediately possible these commands illustrate an intermediate solution.</p>
</div>
<div class="paragraph">
<p>These steps assume the original configuration is already in place.</p>
</div>
<div class="paragraph">
<p>The first step is to add a mapping to an Elytron security realm within
the legacy security subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/elytron-realm=application-<span class="key">security</span>:add(legacy-jaas-config=application-security)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:security:2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;elytron-integration&gt;</span>
      <span class="tag">&lt;security-realms&gt;</span>
        <span class="tag">&lt;elytron-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">legacy-jaas-config</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security-realms&gt;</span>
    <span class="tag">&lt;/elytron-integration&gt;</span>
    ...
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the Elytron subsystem a security domain can be defined which
references the exported security realm and also a http authentication
factory which supports FORM based authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=application-<span class="key">security</span>:add(realms=[{realm=application-security}], default-realm=application-security, permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=application-security-<span class="key">http</span>:add(http-server-mechanism-factory=global, security-domain=application-security, mechanism-configurations=[{mechanism-name=<span class="constant">FORM</span>}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the resulting configuration: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;security-domains&gt;</span>
      ...
      <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permission-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security-domain&gt;</span>
    <span class="tag">&lt;/security-domains&gt;</span>
    ...
    <span class="tag">&lt;http&gt;</span>
      ...
      <span class="tag">&lt;http-authentication-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-http</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">http-server-mechanism-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;mechanism-configuration&gt;</span>
          <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FORM</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/mechanism-configuration&gt;</span>
      <span class="tag">&lt;/http-authentication-factory&gt;</span>
      ...
    <span class="tag">&lt;/http&gt;</span>
    ...
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally configuration needs to be added to the Undertow subsystem to map
the security domain referenced by the deployment to the newly defined
http authentication factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=undertow/application-security-domain=application-<span class="key">security</span>:add(http-authentication-factory=application-security-http)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:undertow:4.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;application-security-domains&gt;</span>
      <span class="tag">&lt;application-security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">http-authentication-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-http</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/application-security-domains&gt;</span>
    ...
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Note: If the deployment was already deployed at this point the
application server should be reloaded or the deployment redeployed for
the application security domain mapping to take effect.</em></p>
</div>
<div class="paragraph">
<p>The following command can then be used to verify the mapping was applied
to the deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">[standalone<span class="instance-variable">@localhost</span>:<span class="integer">9990</span> /] ./subsystem=undertow/application-security-domain=application-<span class="key">security</span>:read-resource(include-runtime=<span class="predefined-constant">true</span>)
{
    <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">enable-jacc</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">false</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http-authentication-factory</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-http</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">override-deployment-config</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">false</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">referencing-deployments</span><span class="delimiter">&quot;</span></span> =&gt; [<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorld.war</span><span class="delimiter">&quot;</span></span>],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">setting</span><span class="delimiter">&quot;</span></span> =&gt; undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The deployment being tested here is 'HelloWorld.war' and the output from
the previous command shows this deployment is referencing the mapping.</p>
</div>
<div class="paragraph">
<p>At this stage the previously defined security domain is used for it&#8217;s
LoginModule configuration but this is wrapped by Elytron components
which take over authentication.</p>
</div>
</div>
<div class="sect4">
<h5 id="fully-migrated-configuration">Fully Migrated Configuration</h5>
<div class="paragraph">
<p>Alternatively the configuration can be completely defined within the
Elytron subsystem, in this case it is assumed none of the previous
commands have been executed and this is started from a clean
configuration - however if the security domain definition does exist in
the legacy security subsystem that will remain completely independent.</p>
</div>
<div class="paragraph">
<p>First a new security realm can be defined within the Elytron subsystem
referencing the files referenced previously: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/properties-realm=application-<span class="key">properties</span>:add(users-properties={path=example-users.properties, relative-to=jboss.server.config.dir, plain-text=<span class="predefined-constant">true</span>, digest-realm-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Application Security</span><span class="delimiter">&quot;</span></span>}, groups-properties={path=example-roles.properties, relative-to=jboss.server.config.dir}, groups-attribute=<span class="constant">Roles</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before a security domain and http authentication factory can be
defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=application-<span class="key">security</span>:add(realms=[{realm=application-properties}], default-realm=application-properties, permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=application-security-<span class="key">http</span>:add(http-server-mechanism-factory=global, security-domain=application-security, mechanism-configurations=[{mechanism-name=<span class="constant">FORM</span>}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following overall configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;security-domains&gt;</span>
      ...
      <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permission-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security-domain&gt;</span>
    <span class="tag">&lt;/security-domains&gt;</span>
    <span class="tag">&lt;security-realms&gt;</span>
      ...
      <span class="tag">&lt;properties-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">groups-attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;users-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">digest-realm-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Application Security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">plain-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;groups-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example-roles.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/properties-realm&gt;</span>
    <span class="tag">&lt;/security-realms&gt;</span>
    ...
    <span class="tag">&lt;http&gt;</span>
      ...
      <span class="tag">&lt;http-authentication-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-http</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">http-server-mechanism-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;mechanism-configuration&gt;</span>
          <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FORM</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/mechanism-configuration&gt;</span>
      <span class="tag">&lt;/http-authentication-factory&gt;</span>
      ...
    <span class="tag">&lt;/http&gt;</span>
    ...
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As before the application-security-domain mapping should be added to the
Undertow subsystem and the server reloaded or the deployment redeployed
as required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=undertow/application-security-domain=application-<span class="key">security</span>:add(http-authentication-factory=application-security-http)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:undertow:4.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;application-security-domains&gt;</span>
      <span class="tag">&lt;application-security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">http-authentication-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-http</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/application-security-domains&gt;</span>
    ...
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At this stage the authentication is the equivalent of the original
configuration however now Elytron components are used exclusively.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="legacy-security-realm">13.2.2. Legacy Security Realm</h4>
<div class="sect4">
<h5 id="original-configuration-1">Original Configuration</h5>
<div class="paragraph">
<p>A legacy security realm can be defined using the following commands to
load users passwords and group information from properties files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/security-realm=<span class="key">ApplicationSecurity</span>:add
./core-service=management/security-realm=<span class="constant">ApplicationSecurity</span>/authentication=<span class="key">properties</span>:add(relative-to=jboss.server.config.dir, path=example-users.properties, plain-text=<span class="predefined-constant">true</span>)
./core-service=management/security-realm=<span class="constant">ApplicationSecurity</span>/authorization=<span class="key">properties</span>:add(relative-to=jboss.server.config.dir, path=example-roles.properties)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following realm definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationSecurity</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;authentication&gt;</span>
      <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">plain-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/authentication&gt;</span>
    <span class="tag">&lt;authorization&gt;</span>
      <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example-roles.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/authorization&gt;</span>
  <span class="tag">&lt;/security-realm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A legacy security realm would typically be used to secure either the
management interfaces or remoting connectors.</p>
</div>
</div>
<div class="sect4">
<h5 id="migrated-configuration">Migrated Configuration</h5>
<div class="paragraph">
<p>One of the motivations for adding the Elytron based security to the
application server is to allow a consistent security solution to be used
across the server, to replace the security realm the same steps as
described in the previous 'Fully Migrated' section can be followed again
up until the http-authentication-factory is defined.</p>
</div>
<div class="paragraph">
<p>A legacy security realm can also be used for SASL based authentication
so a sasl-authentication-factory should also be defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/sasl-authentication-factory=application-security-<span class="key">sasl</span>:add(sasl-server-factory=elytron, security-domain=application-security, mechanism-configurations=[{mechanism-name=<span class="constant">PLAIN</span>}])</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;sasl&gt;</span>
      ...
      <span class="tag">&lt;sasl-authentication-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-sasl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">sasl-server-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">elytron</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;mechanism-configuration&gt;</span>
          <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAIN</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/mechanism-configuration&gt;</span>
      <span class="tag">&lt;/sasl-authentication-factory&gt;</span>
      ...
    <span class="tag">&lt;/sasl&gt;</span>
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be associated with a Remoting connector to use for
authentication and the existing security realm reference cleared.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=remoting/http-connector=http-remoting-<span class="key">connector</span>:write-attribute(name=sasl-authentication-factory, value=application-security-sasl)
./subsystem=remoting/http-connector=http-remoting-<span class="key">connector</span>:undefine-attribute(name=security-realm)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:remoting:4.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;http-connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http-remoting-connector</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">connector-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">sasl-authentication-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-sasl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If this new configuration was to be used to secure the management
interfaces more suitable names should be chosen but the following
commands illustrate how to set the two authentication factories and
clear the existing security realm reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/management-interface=http-<span class="key">interface</span>:write-attribute(name=http-authentication-factory, value=application-security-http)
./core-service=management/management-interface=http-<span class="key">interface</span>:write-attribute(name=http-upgrade.sasl-authentication-factory, value=application-security-sasl)
./core-service=management/management-interface=http-<span class="key">interface</span>:undefine-attribute(name=security-realm)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;management-interfaces&gt;</span>
    <span class="tag">&lt;http-interface</span> <span class="attribute-name">http-authentication-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-http</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http-upgrade</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">sasl-authentication-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-sasl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;socket-binding</span> <span class="attribute-name">http</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">management-http</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http-interface&gt;</span>
  <span class="tag">&lt;/management-interfaces&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="LDAP_Based_Authentication_Migration">13.3. LDAP Authentication Migration</h3>
<div class="paragraph">
<p>The section describing how to migrate from properties based
authentication using either PicketBox or legacy security realms to
Elytron also contained a lot of additional information regarding
defining security domains, authentication factories, and how these are
mapped to be used for authentication. This section will illustrate some
equivalent LDAP configuration using legacy security realms and PicketBox
security domains and show the equivalent configuration using Elytron but
will not repeat the steps to wire it all together covered in the
previous section.</p>
</div>
<div class="paragraph">
<p>These configuration examples are developed against a test LDAP sever
with user entries like: -</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dn: uid=TestUserOne,ou=users,dc=group-to-principal,dc=wildfly,dc=org
objectClass: top
objectClass: inetOrgPerson
objectClass: uidObject
objectClass: person
objectClass: organizationalPerson
cn: Test User One
sn: Test User One
uid: TestUserOne
userPassword: {SSHA}UG8ov2rnrnBKakcARVvraZHqTa7mFWJZlWt2HA==</pre>
</div>
</div>
<div class="paragraph">
<p>The group entries then look like: -</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dn: uid=GroupOne,ou=groups,dc=group-to-principal,dc=wildfly,dc=org
objectClass: top
objectClass: groupOfUniqueNames
objectClass: uidObject
cn: Group One
uid: GroupOne
uniqueMember: uid=TestUserOne,ou=users,dc=group-to-principal,dc=wildfly,dc=org</pre>
</div>
</div>
<div class="paragraph">
<p>For authentication purposes the username will be matched against the
'uid' attribute, also the resulting group name will be taken from the
'uid' attribute of the group entry.</p>
</div>
<div class="sect3">
<h4 id="legacy-security-realm">13.3.1. Legacy Security Realm</h4>
<div class="paragraph">
<p>A connection to the LDAP server and related security realm can be
created with the following commands: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">batch
./core-service=management/ldap-connection=<span class="key">MyLdapConnection</span>:add(url=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span>, search-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, search-credential=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>)
 
./core-service=management/security-realm=<span class="key">LDAPRealm</span>:add
./core-service=management/security-realm=<span class="constant">LDAPRealm</span>/authentication=<span class="key">ldap</span>:add(connection=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyLdapConnection</span><span class="delimiter">&quot;</span></span>, username-attribute=uid, base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>)
 
 
./core-service=management/security-realm=<span class="constant">LDAPRealm</span>/authorization=<span class="key">ldap</span>:add(connection=<span class="constant">MyLdapConnection</span>)
./core-service=management/security-realm=<span class="constant">LDAPRealm</span>/authorization=ldap/username-to-dn=username-<span class="key">filter</span>:add(attribute=uid, base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>)
./core-service=management/security-realm=<span class="constant">LDAPRealm</span>/authorization=ldap/group-search=group-to-<span class="key">principal</span>:add(base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>, iterative=<span class="predefined-constant">true</span>, prefer-original-connection=<span class="predefined-constant">true</span>, principal-attribute=uniqueMember, search-by=<span class="constant">DISTINGUISHED_NAME</span>, group-name=<span class="constant">SIMPLE</span>, group-name-attribute=uid)
run-batch</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;management&gt;</span>
    <span class="tag">&lt;security-realms&gt;</span>
      ...
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LDAPRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;authentication&gt;</span>
          <span class="tag">&lt;ldap</span> <span class="attribute-name">connection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyLdapConnection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;username-filter</span> <span class="attribute-name">attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/ldap&gt;</span>
        <span class="tag">&lt;/authentication&gt;</span>
        <span class="tag">&lt;authorization&gt;</span>
          <span class="tag">&lt;ldap</span> <span class="attribute-name">connection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyLdapConnection</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;username-to-dn&gt;</span>
              <span class="tag">&lt;username-filter</span> <span class="attribute-name">base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/username-to-dn&gt;</span>
            <span class="tag">&lt;group-search</span> <span class="attribute-name">group-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SIMPLE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">iterative</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">group-name-attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;group-to-principal</span> <span class="attribute-name">search-by</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DISTINGUISHED_NAME</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">prefer-original-connection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;membership-filter</span> <span class="attribute-name">principal-attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uniqueMember</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
              <span class="tag">&lt;/group-to-principal&gt;</span>
            <span class="tag">&lt;/group-search&gt;</span>
          <span class="tag">&lt;/ldap&gt;</span>
        <span class="tag">&lt;/authorization&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
    <span class="tag">&lt;/security-realms&gt;</span>
    <span class="tag">&lt;outbound-connections&gt;</span>
      <span class="tag">&lt;ldap</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyLdapConnection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">search-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">search-credential</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/outbound-connections&gt;</span>
    ...
  <span class="tag">&lt;/management&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="picketbox-ldapextloginmodule">13.3.2. PicketBox LdapExtLoginModule</h4>
<div class="paragraph">
<p>The following commands can create a PicketBox security domain configured
to use the LdapExtLoginModule to verify a username and password.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-<span class="key">security</span>:add
./subsystem=security/security-domain=application-security/authentication=<span class="key">classic</span>:add(login-modules=[{code=<span class="constant">LdapExtended</span>, flag=<span class="constant">Required</span>, <span class="keyword">module</span>-options={ \
java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory, \
java.naming.provider.url=<span class="key">ldap</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="key">localhost</span>:<span class="integer">10389</span>, \
java.naming.security.authentication=simple, \
bindDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, \
bindCredential=secret, \
baseCtxDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>, \
baseFilter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uid={0})</span><span class="delimiter">&quot;</span></span>, \
rolesCtxDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>,\
roleFilter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span>, \
roleAttributeID=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> \
}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:security:2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;security-domains&gt;</span>
      ...
      <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;authentication&gt;</span>
          <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LdapExtended</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.factory.initial</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jndi.ldap.LdapCtxFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.provider.url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.security.authentication</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bindDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bindCredential</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseCtxDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseFilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uid={0})</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rolesCtxDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roleFilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roleAttributeID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/login-module&gt;</span>
        <span class="tag">&lt;/authentication&gt;</span>
      <span class="tag">&lt;/security-domain&gt;</span>
    <span class="tag">&lt;/security-domains&gt;</span>
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migrated">13.3.3. Migrated</h4>
<div class="paragraph">
<p>Within the Elytron subsystem a directory context can be defined for the
connection to LDAP: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/dir-context=ldap-<span class="key">connection</span>:add(url=<span class="key">ldap</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="key">localhost</span>:<span class="integer">10389</span>, principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, credential-reference={clear-text=secret})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then a security realm can be created to search LDAP and verify the
supplied password: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/ldap-realm=ldap-<span class="key">realm</span>:add(dir-context=ldap-connection, \
direct-verification=<span class="predefined-constant">true</span>, \
identity-mapping={search-base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>, \
rdn-identifier=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>, \
attribute-mapping=[{filter-base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>,filter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span>,from=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>,to=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>}]})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the prior two examples information is loaded from LDAP to use
directly as groups or roles, in the Elytron case information can be
loaded from LDAP to associate with the identity as attributes - these
can subsequently be mapped to roles but attributes can be loaded for
other purposes as well.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By default, if no <code>role-decoder</code> is defined for given <code>security-domain</code>,
identity attribute " `Roles`" is mapped to the identity roles.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This leads to the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;security-realms&gt;</span>
      ...
      <span class="tag">&lt;ldap-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">dir-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-connection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">direct-verification</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;identity-mapping</span> <span class="attribute-name">rdn-identifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">search-base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;attribute-mapping&gt;</span>
            <span class="tag">&lt;attribute</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filter-base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/attribute-mapping&gt;</span>
        <span class="tag">&lt;/identity-mapping&gt;</span>
      <span class="tag">&lt;/ldap-realm&gt;</span>
    <span class="tag">&lt;/security-realms&gt;</span>
    ...
    <span class="tag">&lt;dir-contexts&gt;</span>
      <span class="tag">&lt;dir-context</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-connection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/dir-context&gt;</span>
    <span class="tag">&lt;/dir-contexts&gt;</span>
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Composite_Stores_Migration">13.4. Composite Stores Migration</h3>
<div class="paragraph">
<p>When using either PicketBox or the legacy security realms it is possible to define a configuration where authentication is performed against one identity store whilst the information used for authorization is loaded from a different store, when using WildFly Elytron this can be achieved by using an aggregate security realm.</p>
</div>
<div class="paragraph">
<p>The example here makes use of a properties file for authentication and then searches LDAP to load group / role information. Both of these are based on the previous examples within this document so the environmental information is not repeated here.</p>
</div>
<div class="sect3">
<h4 id="picketbox-based-configuration-2">13.4.1. PicketBox Based Configuration</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-<span class="key">security</span>:add
./subsystem=security/security-domain=application-security/authentication=<span class="key">classic</span>:add(login-modules=[ \
{code=<span class="constant">UsersRoles</span>, flag=<span class="constant">Required</span>, <span class="keyword">module</span>-options={ \
password-stacking=useFirstPass, \
usersProperties=<span class="key">file</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="error">$</span>{jboss.server.config.dir}/example-users.properties, \
rolesProperties=<span class="key">file</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="error">$</span>{jboss.server.config.dir}/example-roles.properties}} \
{code=<span class="constant">LdapExtended</span>, flag=<span class="constant">Required</span>, <span class="keyword">module</span>-options={ \
password-stacking=useFirstPass, \
java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory, \
java.naming.provider.url=<span class="key">ldap</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="key">localhost</span>:<span class="integer">10389</span>, \
java.naming.security.authentication=simple, \
bindDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, \
bindCredential=secret, \
baseCtxDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>, \
baseFilter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uid={0})</span><span class="delimiter">&quot;</span></span>, \
rolesCtxDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>,\
roleFilter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span>, \
roleAttributeID=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> \
}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following domain definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;authentication&gt;</span>
    <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UsersRoles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password-stacking</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useFirstPass</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">usersProperties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file://${jboss.server.config.dir}/example-users.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rolesProperties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file://${jboss.server.config.dir}/example-roles.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/login-module&gt;</span>
    <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LdapExtended</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password-stacking</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useFirstPass</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.factory.initial</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jndi.ldap.LdapCtxFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.provider.url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.security.authentication</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bindDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bindCredential</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseCtxDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseFilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uid={0})</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rolesCtxDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roleFilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roleAttributeID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/login-module&gt;</span>
  <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/security-domain&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>During an authentication attempt the 'UsersRoles' login module will first be called to perform authentication based on the supplied credential, then the 'LdapExtLoginModule' will be called which will proceed to query LDAP to load the roles for the identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/ldap-connection=<span class="key">MyLdapConnection</span>:add(url=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span>, search-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, search-credential=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>)

./core-service=management/security-realm=<span class="key">ApplicationSecurity</span>:add
./core-service=management/security-realm=<span class="constant">ApplicationSecurity</span>/authentication=<span class="key">properties</span>:add(path=example-users.properties, relative-to=jboss.server.config.dir, plain-text=<span class="predefined-constant">true</span>)

batch
./core-service=management/security-realm=<span class="constant">ApplicationSecurity</span>/authorization=<span class="key">ldap</span>:add(connection=<span class="constant">MyLdapConnection</span>)
./core-service=management/security-realm=<span class="constant">ApplicationSecurity</span>/authorization=ldap/username-to-dn=username-<span class="key">filter</span>:add(attribute=uid, base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>)
./core-service=management/security-realm=<span class="constant">ApplicationSecurity</span>/authorization=ldap/group-search=group-to-<span class="key">principal</span>:add(base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>, iterative=<span class="predefined-constant">true</span>, prefer-original-connection=<span class="predefined-constant">true</span>, principal-attribute=uniqueMember, search-by=<span class="constant">DISTINGUISHED_NAME</span>, group-name=<span class="constant">SIMPLE</span>, group-name-attribute=uid)
run-batch</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following realm definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationSecurity</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;authentication&gt;</span>
    <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">plain-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/authentication&gt;</span>
  <span class="tag">&lt;authorization&gt;</span>
    <span class="tag">&lt;ldap</span> <span class="attribute-name">connection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyLdapConnection</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;username-to-dn&gt;</span>
        <span class="tag">&lt;username-filter</span> <span class="attribute-name">base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/username-to-dn&gt;</span>
      <span class="tag">&lt;group-search</span> <span class="attribute-name">group-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SIMPLE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">iterative</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">group-name-attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;group-to-principal</span> <span class="attribute-name">search-by</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DISTINGUISHED_NAME</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">prefer-original-connection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;membership-filter</span> <span class="attribute-name">principal-attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uniqueMember</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/group-to-principal&gt;</span>
      <span class="tag">&lt;/group-search&gt;</span>
    <span class="tag">&lt;/ldap&gt;</span>
  <span class="tag">&lt;/authorization&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span>

<span class="tag">&lt;outbound-connections&gt;</span>
  <span class="tag">&lt;ldap</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyLdapConnection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">search-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">search-credential</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/outbound-connections&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the PicketBox example, authentication is first performed using the properties file - then group searching is performed against LDAP.</p>
</div>
</div>
<div class="sect3">
<h4 id="migrated-wildfly-elytron-configuration">13.4.2. Migrated WildFly Elytron Configuration</h4>
<div class="paragraph">
<p>The equivalent WildFly Elytron configuration can be defined with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/dir-context=ldap-<span class="key">connection</span>:add(url=<span class="key">ldap</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="key">localhost</span>:<span class="integer">10389</span>, principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, credential-reference={clear-text=secret})

./subsystem=elytron/ldap-realm=ldap-<span class="key">realm</span>:add(dir-context=ldap-connection, \
direct-verification=<span class="predefined-constant">true</span>, \
identity-mapping={search-base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>, \
rdn-identifier=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>, \
attribute-mapping=[{filter-base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>,filter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span>,from=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>,to=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>}]})

./subsystem=elytron/properties-realm=application-<span class="key">properties</span>:add(users-properties={path=example-users.properties, relative-to=jboss.server.config.dir, plain-text=<span class="predefined-constant">true</span>, digest-realm-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Application Security</span><span class="delimiter">&quot;</span></span>}, groups-properties={path=example-roles.properties, relative-to=jboss.server.config.dir}, groups-attribute=<span class="constant">Roles</span>)

./subsystem=elytron/aggregate-realm=combined-<span class="key">realm</span>:add(authentication-realm=application-properties, authorization-realm=ldap-realm)

./subsystem=elytron/security-domain=application-<span class="key">security</span>:add(realms=[{realm=combined-realm}], default-realm=combined-realm, permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=application-security-<span class="key">http</span>:add(http-server-mechanism-factory=global, security-domain=application-security, mechanism-configurations=[{mechanism-name=<span class="constant">BASIC</span>}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following realm definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;security-domains&gt;</span>
    ...
    <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-realm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permission-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-realm</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/security-domain&gt;</span>
  <span class="tag">&lt;/security-domains&gt;</span>
  <span class="tag">&lt;security-realms&gt;</span>
    <span class="tag">&lt;aggregate-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-realm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">authentication-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">authorization-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      ...
      <span class="tag">&lt;properties-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">groups-attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;users-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">digest-realm-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Application Security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">plain-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;groups-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example-roles.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/properties-realm&gt;</span>
      <span class="tag">&lt;ldap-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">dir-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-connection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">direct-verification</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;identity-mapping</span> <span class="attribute-name">rdn-identifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">search-base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;attribute-mapping&gt;</span>
            <span class="tag">&lt;attribute</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filter-base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/attribute-mapping&gt;</span>
        <span class="tag">&lt;/identity-mapping&gt;</span>
      <span class="tag">&lt;/ldap-realm&gt;</span>
  <span class="tag">&lt;/security-realms&gt;</span>
  ...
  <span class="tag">&lt;http&gt;</span>
    ...
    <span class="tag">&lt;http-authentication-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-http</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">http-server-mechanism-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;mechanism-configuration&gt;</span>
        <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BASIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/mechanism-configuration&gt;</span>
    <span class="tag">&lt;/http-authentication-factory&gt;</span>
    ...
  <span class="tag">&lt;/http&gt;</span>
  ...
  <span class="tag">&lt;dir-contexts&gt;</span>
    <span class="tag">&lt;dir-context</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-connection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dir-context&gt;</span>
  <span class="tag">&lt;/dir-contexts&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the WildFly Elytron example a new security realm 'aggregate-realm' has been defined, this definition specifies which of the defined security realms should be used for the authentication step and which of the security realms should be used for the loading of the identity used for subsequent authorization decisions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Database_Authentication_Migration">13.5. Database Authentication</h3>
<div class="paragraph">
<p>The section describing how to migrate from database accessible via JDBC
datasource based authentication using PicketBox to Elytron. This section
will illustrate some equivalent configuration using PicketBox security
domains and show the equivalent configuration using Elytron but will not
repeat the steps to wire it all together covered in the previous
sections.</p>
</div>
<div class="paragraph">
<p>These configuration examples are developed against a test database with
users table like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> User (
    id <span class="predefined-type">BIGINT</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
    username <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>),
    password <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>),
    role <span class="predefined-type">ENUM</span>(<span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">manager</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">user</span><span class="delimiter">'</span></span>),
    <span class="directive">PRIMARY</span> <span class="type">KEY</span> (id),
    <span class="directive">UNIQUE</span> (username)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For authentication purposes the username will be matched against the '
`username&#8217; column, password will be expected in hex-encoded MD5 hash in
' `password&#8217; column. User role for authorization purposes will be taken
from ' `role&#8217; column.</p>
</div>
<div class="sect3">
<h4 id="picketbox-database-loginmodule">13.5.1. PicketBox Database LoginModule</h4>
<div class="paragraph">
<p>The following commands can create a PicketBox security domain configured
to use database accessible via JDBC datasource to verify a username and
password and to assign roles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-security/<span class="symbol">:add</span>
./subsystem=security/security-domain=application-security/authentication=<span class="key">classic</span>:add(login-modules=[{code=<span class="constant">Database</span>, flag=<span class="constant">Required</span>, <span class="keyword">module</span>-options={ \
    dsJndiName=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span>, \
    principalsQuery=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT password FROM User WHERE username = ?</span><span class="delimiter">&quot;</span></span>, \
    rolesQuery=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT role, 'Roles' FROM User WHERE username = ?</span><span class="delimiter">&quot;</span></span>, \
    hashAlgorithm=<span class="constant">MD5</span>, \
    hashEncoding=base64 \
}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:security:2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;security-domains&gt;</span>
                ...
                <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;authentication&gt;</span>
                        <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Database</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dsJndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">principalsQuery</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT password FROM User WHERE username = ?</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rolesQuery</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT role, 'Roles' FROM User WHERE username = ?</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hashAlgorithm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MD5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hashEncoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">base64</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;/login-module&gt;</span>
                    <span class="tag">&lt;/authentication&gt;</span>
                <span class="tag">&lt;/security-domain&gt;</span>
            <span class="tag">&lt;/security-domains&gt;</span>
        <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migrated">13.5.2. Migrated</h4>
<div class="paragraph">
<p>Within the Elytron subsystem to use database accesible via JDBC you need
to define <code>jdbc-realm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/jdbc-realm=jdbc-<span class="key">realm</span>:add(principal-query=[{ \
    data-source=<span class="constant">ExampleDS</span>, \
    sql=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT role, password FROM User WHERE username = ?</span><span class="delimiter">&quot;</span></span>, \
    attribute-mapping=[{index=<span class="integer">1</span>, to=<span class="constant">Roles</span>}] \
    simple-digest-mapper={algorithm=simple-digest-md5, password-index=<span class="integer">2</span>}, \
}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following overall configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            ...
            <span class="tag">&lt;security-realms&gt;</span>
                ...
                <span class="tag">&lt;jdbc-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc-realm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;principal-query</span> <span class="attribute-name">sql</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT role, password FROM User WHERE username = ?</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">data-source</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleDS</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;attribute-mapping&gt;</span>
                            <span class="tag">&lt;attribute</span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;/attribute-mapping&gt;</span>
                        <span class="tag">&lt;simple-digest-mapper</span> <span class="attribute-name">password-index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/principal-query&gt;</span>
                <span class="tag">&lt;/jdbc-realm&gt;</span>
                ...
            <span class="tag">&lt;/security-realms&gt;</span>
            ...
        <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In comparison with PicketBox solution, Elytron <code>jdbc-realm</code> use one SQL
query to obtain all user attributes and credentials. Their extraction
from SQL result specifies mappers.</p>
</div>
</div>
<div class="sect3">
<h4 id="n-m-relation-beetween-user-and-roles">13.5.3. N-M relation beetween user and roles</h4>
<div class="paragraph">
<p>When using a n:m-relation beetween user and roles (which means: the user has multiple roles), the previous configuration does not work.</p>
</div>
<div class="paragraph">
<p>The database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> User (
id <span class="predefined-type">BIGINT</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
username <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>),
password <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>),
<span class="directive">PRIMARY</span> <span class="type">KEY</span> (id),
<span class="directive">UNIQUE</span> (username)
)

<span class="class">CREATE</span> <span class="type">TABLE</span> Role(
id <span class="predefined-type">BIGINT</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
rolename <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>),
<span class="directive">PRIMARY</span> <span class="type">KEY</span> (id),
<span class="directive">UNIQUE</span> (rolename)
)

<span class="class">CREATE</span> <span class="type">TABLE</span> Userrole(
userid <span class="predefined-type">BIGINT</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
roleid <span class="predefined-type">BIGINT</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
<span class="directive">PRIMARY</span> <span class="type">KEY</span> (userid, roleid),
<span class="directive">FOREIGN</span> <span class="type">KEY</span> (userid) <span class="keyword">references</span> User(id,
<span class="directive">FOREIGN</span> <span class="type">KEY</span> (roleid) <span class="keyword">references</span> Role(id)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you need two configure two principal queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jdbc-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc-realm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;principal-query</span> <span class="attribute-name">sql</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT PASSWORD FROM USER WHERE USERNAME = ?</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">data-source</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleDS</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;clear-password-mapper</span> <span class="attribute-name">password-index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/principal-query&gt;</span>
    <span class="tag">&lt;principal-query</span> <span class="attribute-name">sql</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT R.ROLENAME from ROLE AS R, USERROLE AS UR, USER AS U WHERE U.USERNAME=? AND UR.ROLEID = R.ID AND UR.USERID = U.ID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">data-source</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleDS</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;attribute-mapping&gt;</span>
            <span class="tag">&lt;attribute</span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/attribute-mapping&gt;</span>
    <span class="tag">&lt;/principal-query&gt;</span>
<span class="tag">&lt;/jdbc-realm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second query needs an attribute mapping to decode the selected rolename column (index 1):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mappers&gt;</span>
...
<span class="tag">&lt;simple-role-decoder</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from-roles-attribute</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
...
<span class="tag">&lt;/mappers&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The role decoder is referenced by the security domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDomain</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc-realm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permission-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDbRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role-decoder</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from-roles-attribute</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/security-domain&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Kerberos_Based_Authentication_Migration">13.6. Kerberos Authentication Migration</h3>
<div class="paragraph">
<p>When working with Kerberos configuration it is possible for the
application server to rely on configuration from the environment or the
key configuration can be specified using system properties, for the
purpose of these examples I define system properties - these properties
are applicable to both the legacy configuration and the migrated Elytron
configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./system-property=sun.security.krb5.debug<span class="symbol">:add</span>(value=<span class="predefined-constant">true</span>)
./system-property=java.security.krb5.realm<span class="symbol">:add</span>(value=<span class="constant">ELYTRON</span>.ORG)
./system-property=java.security.krb5.kdc<span class="symbol">:add</span>(value=kdc.elytron.org)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line makes debugging easier but the last two lines specify the
Kerberos realm in use and the address of the KDC.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;system-properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sun.security.krb5.debug</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.security.krb5.realm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ELYTRON.ORG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.security.krb5.kdc</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kdc.elytron.org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/system-properties&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="http-authentication">13.6.1. HTTP Authentication</h4>
<div class="sect4">
<h5 id="legacy-security-realm">Legacy Security Realm</h5>
<div class="paragraph">
<p>A legacy security realm can be define so that SPNEGO authentication can
be enabled for the HTTP management interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/security-realm=<span class="key">Kerberos</span>:add
./core-service=management/security-realm=<span class="constant">Kerberos</span>/server-identity=<span class="key">kerberos</span>:add
./core-service=management/security-realm=<span class="constant">Kerberos</span>/server-identity=kerberos/keytab=<span class="constant">HTTP</span><span class="error">\</span>/test-server.elytron.org<span class="instance-variable">@ELYTRON</span>.ORG<span class="symbol">:add</span>(path=<span class="regexp"><span class="delimiter">/</span><span class="content">home</span><span class="delimiter">/</span></span>darranl/src/kerberos/test-server.keytab, debug=<span class="predefined-constant">true</span>)
./core-service=management/security-realm=<span class="constant">Kerberos</span>/authentication=<span class="key">kerberos</span>:add(remove-realm=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following configuration: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;security-realms&gt;</span>
    ...
    <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Kerberos</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;server-identities&gt;</span>
        <span class="tag">&lt;kerberos&gt;</span>
          <span class="tag">&lt;keytab</span> <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/test-server.elytron.org@ELYTRON.ORG</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/darranl/src/kerberos/test-server.keytab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">debug</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/kerberos&gt;</span>
      <span class="tag">&lt;/server-identities&gt;</span>
      <span class="tag">&lt;authentication&gt;</span>
        <span class="tag">&lt;kerberos</span> <span class="attribute-name">remove-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/authentication&gt;</span>
    <span class="tag">&lt;/security-realm&gt;</span>
  <span class="tag">&lt;/security-realms&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="application-spnego">Application SPNEGO</h5>
<div class="paragraph">
<p>Alternatively deployed applications would make use of a pair of security
domains.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">./subsystem=security/security-domain=host:add
./subsystem=security/security-domain=host/authentication=classic:add
./subsystem=security/security-domain=host/authentication=classic/login-module=<span class="integer">1</span>:add(code=Kerberos, flag=Required, module-options={storeKey=<span class="predefined-constant">true</span>, useKeyTab=<span class="predefined-constant">true</span>, principal=HTTP/test-server.elytron.org<span class="annotation">@ELYTRON</span>.ORG, keyTab=/home/darranl/src/kerberos/test-server.keytab, debug=<span class="predefined-constant">true</span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=<span class="key">SPNEGO</span>:add
./subsystem=security/security-domain=<span class="constant">SPNEGO</span>/authentication=<span class="key">classic</span>:add
./subsystem=security/security-domain=<span class="constant">SPNEGO</span>/authentication=classic/login-<span class="keyword">module</span>=<span class="integer">1</span><span class="symbol">:add</span>(code=<span class="constant">SPNEGO</span>, flag=requisite,  <span class="keyword">module</span>-options={password-stacking=useFirstPass, serverSecurityDomain=host})
./subsystem=security/security-domain=<span class="constant">SPNEGO</span>/authentication=classic/login-<span class="keyword">module</span>=<span class="integer">1</span><span class="symbol">:write</span>-attribute(name=<span class="keyword">module</span>, value=org.jboss.security.negotiation)
./subsystem=security/security-domain=<span class="constant">SPNEGO</span>/authentication=classic/login-<span class="keyword">module</span>=<span class="integer">2</span><span class="symbol">:add</span>(code=<span class="constant">UsersRoles</span>, flag=required, <span class="keyword">module</span>-options={password-stacking=useFirstPass, usersProperties=<span class="key">file</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span>/home/darranl/src/kerberos/spnego-users.properties, rolesProperties=<span class="key">file</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span>/home/darranl/src/kerberos/spnego-roles.properties, defaultUsersProperties=<span class="key">file</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span>/home/darranl/src/kerberos/spnego-users.properties, defaultRolesProperties=<span class="key">file</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span>/home/darranl/src/kerberos/spnego-roles.properties})</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:security:2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;security-domains&gt;</span>
      ...
      <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;authentication&gt;</span>
          <span class="tag">&lt;login-module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Kerberos</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">storeKey</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useKeyTab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/test-server.elytron.org@ELYTRON.ORG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyTab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/darranl/src/kerberos/test-server.keytab</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">debug</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/login-module&gt;</span>
        <span class="tag">&lt;/authentication&gt;</span>
      <span class="tag">&lt;/security-domain&gt;</span>
      <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SPNEGO</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;authentication&gt;</span>
          <span class="tag">&lt;login-module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SPNEGO</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">requisite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.security.negotiation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password-stacking</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useFirstPass</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverSecurityDomain</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/login-module&gt;</span>
          <span class="tag">&lt;login-module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UsersRoles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password-stacking</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useFirstPass</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">usersProperties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///home/darranl/src/kerberos/spnego-users.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rolesProperties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///home/darranl/src/kerberos/spnego-roles.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultUsersProperties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///home/darranl/src/kerberos/spnego-users.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultRolesProperties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///home/darranl/src/kerberos/spnego-roles.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/login-module&gt;</span>
        <span class="tag">&lt;/authentication&gt;</span>
      <span class="tag">&lt;/security-domain&gt;</span>
    <span class="tag">&lt;/security-domains&gt;</span>
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An application can now be deployed referencing the SPNEGO security
domain and secured with SPNEGO mechanism.</p>
</div>
</div>
<div class="sect4">
<h5 id="migrated-spnego">Migrated SPNEGO</h5>
<div class="paragraph">
<p>The equivalent configuration can be achieved with WildFly Elytron by
first defining a security realm which will be used to load identity
information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/properties-realm=spnego-<span class="key">properties</span>:add(users-properties={path=<span class="regexp"><span class="delimiter">/</span><span class="content">home</span><span class="delimiter">/</span></span>darranl/src/kerberos/spnego-users.properties, plain-text=<span class="predefined-constant">true</span>, digest-realm-name=<span class="constant">ELYTRON</span>.ORG}, groups-properties={path=<span class="regexp"><span class="delimiter">/</span><span class="content">home</span><span class="delimiter">/</span></span>darranl/src/kerberos/spnego-roles.properties})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next a Kerberos security factory is defined which allows the server to
load it&#8217;s own Kerberos identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/kerberos-security-factory=test-<span class="key">server</span>:add(path=<span class="regexp"><span class="delimiter">/</span><span class="content">home</span><span class="delimiter">/</span></span>darranl/src/kerberos/test-server.keytab, principal=<span class="constant">HTTP</span>/test-server.elytron.org<span class="instance-variable">@ELYTRON</span>.ORG, debug=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the previous examples we define a security realm to pull
together the policy as well as a HTTP authentication factory for the
authentication policy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=<span class="key">SPNEGODomain</span>:add(default-realm=spnego-properties, realms=[{realm=spnego-properties, role-decoder=groups-to-roles}], permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=spnego-http-<span class="key">authentication</span>:add(security-domain=<span class="constant">SPNEGODomain</span>, http-server-mechanism-factory=global,mechanism-configurations=[{mechanism-name=<span class="constant">SPNEGO</span>, credential-security-factory=test-server}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Overall this results in the following configuration: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;security-domains&gt;</span>
    ...
      <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SPNEGODomain</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spnego-properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permission-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spnego-properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role-decoder</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groups-to-roles</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security-domain&gt;</span>
    <span class="tag">&lt;/security-domains&gt;</span>
    <span class="tag">&lt;security-realms&gt;</span>
      ...
      <span class="tag">&lt;properties-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spnego-properties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;users-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/darranl/src/kerberos/spnego-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">digest-realm-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ELYTRON.ORG</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">plain-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;groups-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/darranl/src/kerberos/spnego-roles.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/properties-realm&gt;</span>
    <span class="tag">&lt;/security-realms&gt;</span>
    <span class="tag">&lt;credential-security-factories&gt;</span>
      <span class="tag">&lt;kerberos-security-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/test-server.elytron.org@ELYTRON.ORG</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/darranl/src/kerberos/test-server.keytab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">debug</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/credential-security-factories&gt;</span>
    ...
    <span class="tag">&lt;http&gt;</span>
      ...
      <span class="tag">&lt;http-authentication-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spnego-http-authentication</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">http-server-mechanism-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SPNEGODomain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;mechanism-configuration&gt;</span>
          <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SPNEGO</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">credential-security-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/mechanism-configuration&gt;</span>
      <span class="tag">&lt;/http-authentication-factory&gt;</span>
      ...
    <span class="tag">&lt;/http&gt;</span>
    ...
  <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, to enable SPNEGO authentication for the HTTP management interface,
update this interface to reference the <code>http-authentication-factory</code>
defined above, as described in the
<a href="https://docs.jboss.org/author/display/WFLY/Migrate+Legacy+Security+to+Elytron+Security#MigrateLegacySecuritytoElytronSecurity-MigratedConfiguration">properties
authentication section</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, to secure an application using SPNEGO authentication, an
application security domain can be defined in the Undertow subsystem to
map security domains to the <code>http-authentication-factory</code> defined above,
as described in the
<a href="https://docs.jboss.org/author/display/WFLY/Migrate+Legacy+Security+to+Elytron+Security#MigrateLegacySecuritytoElytronSecurity-FullyMigratedConfiguration">properties
authentication section</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remoting-sasl-authentication">13.6.2. Remoting / SASL Authentication</h4>
<div class="sect4">
<h5 id="legacy-security-realm-1">Legacy Security Realm</h5>
<div class="paragraph">
<p>It is also possible to define a legacy security realm for Kerberos /
GSSAPI SASL authenticatio for Remoting authentication such as the native
management interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./core-service=management/security-realm=<span class="key">Kerberos</span>:add
./core-service=management/security-realm=<span class="constant">Kerberos</span>/server-identity=<span class="key">kerberos</span>:add
./core-service=management/security-realm=<span class="constant">Kerberos</span>/server-identity=kerberos/keytab=remote<span class="error">\</span>/test-server.elytron.org<span class="instance-variable">@ELYTRON</span>.ORG<span class="symbol">:add</span>(path=<span class="regexp"><span class="delimiter">/</span><span class="content">home</span><span class="delimiter">/</span></span>darranl/src/kerberos/remote-test-server.keytab, debug=<span class="predefined-constant">true</span>)
./core-service=management/security-realm=<span class="constant">Kerberos</span>/authentication=<span class="key">kerberos</span>:add(remove-realm=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;management&gt;</span>
    <span class="tag">&lt;security-realms&gt;</span>
      ...
      <span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Kerberos</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;server-identities&gt;</span>
          <span class="tag">&lt;kerberos&gt;</span>
            <span class="tag">&lt;keytab</span> <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote/test-server.elytron.org@ELYTRON.ORG</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/darranl/src/kerberos/remote-test-server.keytab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">debug</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/kerberos&gt;</span>
        <span class="tag">&lt;/server-identities&gt;</span>
        <span class="tag">&lt;authentication&gt;</span>
          <span class="tag">&lt;kerberos</span> <span class="attribute-name">remove-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/authentication&gt;</span>
      <span class="tag">&lt;/security-realm&gt;</span>
    <span class="tag">&lt;/security-realms&gt;</span>
    ...
  <span class="tag">&lt;/management&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="migrated-gssapi">Migrated GSSAPI</h5>
<div class="paragraph">
<p>The steps to define the equivalent Elytron configuration are very
similar to the HTTP example.</p>
</div>
<div class="paragraph">
<p>First define the security realm to load the identity from: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./path=<span class="key">kerberos</span>:add(relative-to=user.home, path=src/kerberos)
./subsystem=elytron/properties-realm=kerberos-<span class="key">properties</span>:add(users-properties={path=kerberos-users.properties, relative-to=kerberos, digest-realm-name=<span class="constant">ELYTRON</span>.ORG}, groups-properties={path=kerberos-groups.properties, relative-to=kerberos})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then define the Kerberos security factory for the server&#8217;s identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/kerberos-security-factory=test-<span class="key">server</span>:add(relative-to=kerberos, path=remote-test-server.keytab, principal=remote/test-server.elytron.org<span class="instance-variable">@ELYTRON</span>.ORG)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally define the security domain and this time a SASL authentication
factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=<span class="key">KerberosDomain</span>:add(default-realm=kerberos-properties, realms=[{realm=kerberos-properties, role-decoder=groups-to-roles}], permission-mapper=default-permission-mapper)
./subsystem=elytron/sasl-authentication-factory=gssapi-authentication-<span class="key">factory</span>:add(security-domain=<span class="constant">KerberosDomain</span>, sasl-server-factory=elytron, mechanism-configurations=[{mechanism-name=<span class="constant">GSSAPI</span>, credential-security-factory=test-server}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in the following subsystem configuration: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;security-domains&gt;</span>
      ...
      <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">KerberosDomain</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permission-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role-decoder</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groups-to-roles</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/security-domain&gt;</span>
    <span class="tag">&lt;/security-domains&gt;</span>
    <span class="tag">&lt;security-realms&gt;</span>
     ...
       <span class="tag">&lt;properties-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-properties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;users-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">digest-realm-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ELYTRON.ORG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;groups-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-groups.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
       <span class="tag">&lt;/properties-realm&gt;</span>
     <span class="tag">&lt;/security-realms&gt;</span>
     <span class="tag">&lt;credential-security-factories&gt;</span>
       <span class="tag">&lt;kerberos-security-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote/test-server.elytron.org@ELYTRON.ORG</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-test-server.keytab</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;/credential-security-factories&gt;</span>
     ...
     <span class="tag">&lt;sasl&gt;</span>
       ...
       <span class="tag">&lt;sasl-authentication-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gssapi-authentication-factory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">sasl-server-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">elytron</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">KerberosDomain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;mechanism-configuration&gt;</span>
           <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GSSAPI</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">credential-security-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/mechanism-configuration&gt;</span>
       <span class="tag">&lt;/sasl-authentication-factory&gt;</span>
       ...
     <span class="tag">&lt;/sasl&gt;</span>
   <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The management interface or Remoting connectors can now be updated to
reference the SASL authentication factory.</p>
</div>
<div class="paragraph">
<p>The two Elytron examples defined here could also be combined into one to
use a shared security domain and security realm and just use protocol
specific authentication factories each referencing their own Kerberos
security factory.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Caching_Migration">13.7. Caching Migration</h3>
<div class="paragraph">
<p>Where a PicketBox based security domain is defined it is possible to enable caching for that security domain, this enables subsequent hits to the identity store to be avoided as an in memory cache can be used instead, this example demonstrates how caching can be used with a WildFly Elytron based configuration.</p>
</div>
<div class="paragraph">
<p>The purpose of this chapter is to highlight the migration of a configuration with caching enabled, this example is based in the previous LDAP example but with caching enabled.</p>
</div>
<div class="sect3">
<h4 id="picketbox-example">13.7.1. PicketBox Example</h4>
<div class="paragraph">
<p>A PicketBox based security domain can be defined with the following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=security/security-domain=application-<span class="key">security</span>:add(cache-type=default)
./subsystem=security/security-domain=application-security/authentication=<span class="key">classic</span>:add(login-modules=[{code=<span class="constant">LdapExtended</span>, flag=<span class="constant">Required</span>, <span class="keyword">module</span>-options={ \
java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory, \
java.naming.provider.url=<span class="key">ldap</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="key">localhost</span>:<span class="integer">10389</span>, \
java.naming.security.authentication=simple, \
bindDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, \
bindCredential=secret, \
baseCtxDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>, \
baseFilter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uid={0})</span><span class="delimiter">&quot;</span></span>, \
rolesCtxDN=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>,\
roleFilter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span>, \
roleAttributeID=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> \
}}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in the following security domain definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:security:2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;security-domains&gt;</span>
    ...
    <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;authentication&gt;</span>
        <span class="tag">&lt;login-module</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LdapExtended</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">flag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.factory.initial</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jndi.ldap.LdapCtxFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.provider.url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.security.authentication</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bindDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bindCredential</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseCtxDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseFilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uid={0})</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rolesCtxDN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roleFilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;module-option</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roleAttributeID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/login-module&gt;</span>
      <span class="tag">&lt;/authentication&gt;</span>
    <span class="tag">&lt;/security-domain&gt;</span>
  <span class="tag">&lt;/security-domains&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="migrated-example">13.7.2. Migrated Example</h4>
<div class="paragraph">
<p>When using WildFly Elytron where caching is required the individual security realm is wrapped using a cache, a migrated configuration can be defined with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/dir-context=ldap-<span class="key">connection</span>:add(url=<span class="key">ldap</span>:<span class="regexp"><span class="delimiter">/</span><span class="delimiter">/</span></span><span class="key">localhost</span>:<span class="integer">10389</span>, principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span>, credential-reference={clear-text=secret})
./subsystem=elytron/ldap-realm=ldap-<span class="key">realm</span>:add(dir-context=ldap-connection, \
direct-verification=<span class="predefined-constant">true</span>, \
identity-mapping={search-base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>, \
rdn-identifier=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>, \
attribute-mapping=[{filter-base-dn=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span>,filter=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span>,from=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span>,to=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span>}]})
./subsystem=elytron/caching-realm=cached-<span class="key">ldap</span>:add(realm=ldap-realm)</code></pre>
</div>
</div>
<div class="paragraph">
<p>These can then be used in a security domain and subsequently an authentication factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=elytron/security-domain=application-<span class="key">security</span>:add(realms=[{realm=cached-ldap}], default-realm=cached-ldap, permission-mapper=default-permission-mapper)
./subsystem=elytron/http-authentication-factory=application-security-<span class="key">http</span>:add(http-server-mechanism-factory=global, security-domain=application-security, mechanism-configurations=[{mechanism-name=<span class="constant">BASIC</span>}])</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this final step it is very important that the caching-realm is referenced rather than the original realm otherwise caching will be bypassed.</p>
</div>
<div class="paragraph">
<p>This results in the following definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;security-domains&gt;</span>
    ...
    <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cached-ldap</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permission-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cached-ldap</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/security-domain&gt;</span>
  <span class="tag">&lt;/security-domains&gt;</span>
  <span class="tag">&lt;security-realms&gt;</span>
    ...
    <span class="tag">&lt;ldap-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">dir-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-connection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">direct-verification</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;identity-mapping</span> <span class="attribute-name">rdn-identifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">search-base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=users,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;attribute-mapping&gt;</span>
          <span class="tag">&lt;attribute</span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(uniqueMember={1})</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filter-base-dn</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ou=groups,dc=group-to-principal,dc=wildfly,dc=org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/attribute-mapping&gt;</span>
      <span class="tag">&lt;/identity-mapping&gt;</span>
    <span class="tag">&lt;/ldap-realm&gt;</span>
    <span class="tag">&lt;caching-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cached-ldap</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-realm</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/security-realms&gt;</span>
  ...
  <span class="tag">&lt;http&gt;</span>
    ...
    <span class="tag">&lt;http-authentication-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security-http</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">http-server-mechanism-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">global</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-security</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;mechanism-configuration&gt;</span>
        <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BASIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/mechanism-configuration&gt;</span>
    <span class="tag">&lt;/http-authentication-factory&gt;</span>
    ...
  <span class="tag">&lt;/http&gt;</span>
  ...
  <span class="tag">&lt;dir-contexts&gt;</span>
    <span class="tag">&lt;dir-context</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap-connection</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://localhost:10389</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">principal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dir-context&gt;</span>
  <span class="tag">&lt;/dir-contexts&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clients">13.8. Clients</h3>

</div>
<div class="sect2">
<h3 id="Application_Client_Migration">13.9. Application Client Migration</h3>
<div class="sect3">
<h4 id="naming-client">13.9.1. Naming Client</h4>
<div class="paragraph">
<p>This migration example assumes a client application performs a remote
JNDI lookup using an ﻿﻿ <code>InitialContext</code> backed by the
<code>org.jboss.naming.remote.client.InitialContextFactory</code> class.</p>
</div>
<div class="sect4">
<h5 id="original-configuration">Original Configuration</h5>
<div class="paragraph">
<p>An <code>InitialContext</code> backed by the
<code>org.jboss.naming.remote.client.InitialContextFactory</code> class can be
created by specifying properties that contain the URL of the naming
provider to connect to along with appropriate user credentials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.naming.remote.client.InitialContextFactory</span><span class="delimiter">&quot;</span></span>);
properties.put(<span class="predefined-type">Context</span>.PROVIDER_URL, <span class="string"><span class="delimiter">&quot;</span><span class="content">http-remoting://127.0.0.1:8080</span><span class="delimiter">&quot;</span></span>);
properties.put(<span class="predefined-type">Context</span>.SECURITY_PRINCIPAL, <span class="string"><span class="delimiter">&quot;</span><span class="content">bob</span><span class="delimiter">&quot;</span></span>);
properties.put(<span class="predefined-type">Context</span>.SECURITY_CREDENTIALS, <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">InitialContext</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(properties);
Bar bar = (Bar) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/bar</span><span class="delimiter">&quot;</span></span>);
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="migrated-configuration">Migrated Configuration</h5>
<div class="paragraph">
<p>An <code>InitialContext</code> backed by the
<code>org.wildfly.naming.client.WildFlyInitialContextFactory</code> class can be
created by specifying a property that contains the URL of the naming
provider to connect to. The user credentials can be specified using a
WildFly client configuration file or programmatically.</p>
</div>
<div class="sect5">
<h6 id="configuration-file-approach">Configuration File Approach</h6>
<div class="paragraph">
<p>A <code>wildfly-config.xml</code> file that contains the user credentials to use
when establishing a connection to the naming provider can be added to
the client application&#8217;s <code>META-INF</code> directory:</p>
</div>
<div class="paragraph">
<p><strong>wildfly-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;authentication-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:elytron:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;authentication-rules&gt;</span>
            <span class="tag">&lt;rule</span> <span class="attribute-name">use-configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingConfig</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;match-host</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/rule&gt;</span>
        <span class="tag">&lt;/authentication-rules&gt;</span>
        <span class="tag">&lt;authentication-configurations&gt;</span>
            <span class="tag">&lt;configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingConfig</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;set-user-name</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bob</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;credentials&gt;</span>
                    <span class="tag">&lt;clear-password</span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/credentials&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/authentication-configurations&gt;</span>
    <span class="tag">&lt;/authentication-client&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An <code>InitialContext</code> can then be created as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.naming.client.WildFlyInitialContextFactory</span><span class="delimiter">&quot;</span></span>);
properties.put(<span class="predefined-type">Context</span>.PROVIDER_URL, <span class="string"><span class="delimiter">&quot;</span><span class="content">remote+http://127.0.0.1:8080</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">InitialContext</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(properties);
Bar bar = (Bar) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/bar</span><span class="delimiter">&quot;</span></span>);
...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="programmatic-approach">Programmatic Approach</h6>
<div class="paragraph">
<p>The user credentials to use when establishing a connection to the naming
provider can be specified directly in the client application&#8217;s code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create your authentication configuration</span>
AuthenticationConfiguration namingConfig = AuthenticationConfiguration.empty().useName(<span class="string"><span class="delimiter">&quot;</span><span class="content">bob</span><span class="delimiter">&quot;</span></span>).usePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span>
<span class="comment">// create your authentication context</span>
AuthenticationContext context = AuthenticationContext.empty().with(MatchRule.ALL.matchHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>), namingConfig);
<span class="error"> </span>
<span class="comment">// create a callable that creates and uses an InitialContext</span>
<span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Void</span>&gt; callable = () -&gt; {
    <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
    properties.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.naming.client.WildFlyInitialContextFactory</span><span class="delimiter">&quot;</span></span>);
    properties.put(<span class="predefined-type">Context</span>.PROVIDER_URL, <span class="string"><span class="delimiter">&quot;</span><span class="content">remote+http://127.0.0.1:8080</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">InitialContext</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(properties);
    Bar bar = (Bar) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/bar</span><span class="delimiter">&quot;</span></span>);
    ...
    return <span class="predefined-constant">null</span>;
};
<span class="error"> </span>
<span class="comment">// use your authentication context to run your callable</span>
context.runCallable(callable);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ejb-client">13.9.2. EJB Client</h4>
<div class="paragraph">
<p>This migration example assumes a client application is configured to
invoke an EJB deployed on a remote server using a
<code>jboss-ejb-client.properties</code> file.</p>
</div>
<div class="sect4">
<h5 id="original-configuration-1">Original Configuration</h5>
<div class="paragraph">
<p>A <code>jboss-ejb-client.properties</code> file that contains the information
needed to connect to the remote server can be specified in a client
application&#8217;s <code>META-INF</code> directory:</p>
</div>
<div class="paragraph">
<p><strong>jboss-ejb-client.properties</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connections=default
remote.connection.default.host=127.0.0.1
remote.connection.default.port = 8080
remote.connection.default.username=bob
remote.connection.default.password=secret</pre>
</div>
</div>
<div class="paragraph">
<p>An EJB can then be looked up and a method can be invoked on it as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create an InitialContext</span>
<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.naming.remote.client.InitialContextFactory</span><span class="delimiter">&quot;</span></span>);
properties.put(<span class="predefined-type">Context</span>.URL_PKG_PREFIXES, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.naming</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">InitialContext</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(properties);
<span class="error"> </span>
<span class="comment">// look up an EJB and invoke one of its methods</span>
RemoteCalculator statelessRemoteCalculator = (RemoteCalculator) context.lookup(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:/ejb-remote-server-side//CalculatorBean!</span><span class="delimiter">&quot;</span></span> + RemoteCalculator.class.getName());
<span class="type">int</span> sum = statelessRemoteCalculator.add(<span class="integer">101</span>, <span class="integer">202</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="migrated-configuration-1">Migrated Configuration</h5>
<div class="paragraph">
<p>The information needed to connect to the remote server can be specified
using a WildFly client configuration file or programmatically.</p>
</div>
<div class="sect5">
<h6 id="configuration-file-approach-1">Configuration File Approach</h6>
<div class="paragraph">
<p>A <code>wildfly-config.xml</code> file that contains the information needed to
connect to the remote server can be added to the client application&#8217;s
<code>META-INF</code> directory:</p>
</div>
<div class="paragraph">
<p><strong>wildfly-config.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;authentication-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:elytron:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;authentication-rules&gt;</span>
            <span class="tag">&lt;rule</span> <span class="attribute-name">use-configuration</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejbConfig</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;match-host</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/rule&gt;</span>
        <span class="tag">&lt;/authentication-rules&gt;</span>
        <span class="tag">&lt;authentication-configurations&gt;</span>
            <span class="tag">&lt;configuration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejbConfig</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;set-user-name</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bob</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;credentials&gt;</span>
                    <span class="tag">&lt;clear-password</span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/credentials&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/authentication-configurations&gt;</span>
    <span class="tag">&lt;/authentication-client&gt;</span>
    <span class="tag">&lt;jboss-ejb-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:wildfly-client-ejb:3.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;connections&gt;</span>
            <span class="tag">&lt;connection</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote+http://127.0.0.1:8080</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/connections&gt;</span>
    <span class="tag">&lt;/jboss-ejb-client&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An EJB can then be looked up and a method can be invoked on it as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create an InitialContext</span>
<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.naming.client.WildFlyInitialContextFactory</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">InitialContext</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(properties);
<span class="error"> </span>
<span class="comment">// look up an EJB and invoke one of its methods (same as before)</span>
RemoteCalculator statelessRemoteCalculator = (RemoteCalculator) context.lookup(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:/ejb-remote-server-side//CalculatorBean!</span><span class="delimiter">&quot;</span></span> + RemoteCalculator.class.getName());
<span class="type">int</span> sum = statelessRemoteCalculator.add(<span class="integer">101</span>, <span class="integer">202</span>);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="programmatic-approach-1">Programmatic Approach</h6>
<div class="paragraph">
<p>The information needed to connect to the remote server can be specified
directly in the client application&#8217;s code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create your authentication configuration</span>
AuthenticationConfiguration ejbConfig = AuthenticationConfiguration.empty().useName(<span class="string"><span class="delimiter">&quot;</span><span class="content">bob</span><span class="delimiter">&quot;</span></span>).usePassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span>
<span class="comment">// create your authentication context</span>
AuthenticationContext context = AuthenticationContext.empty().with(MatchRule.ALL.matchHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>), ejbConfig);
<span class="error"> </span>
<span class="comment">// create a callable that invokes an EJB</span>
<span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Void</span>&gt; callable = () -&gt; {
<span class="error"> </span>
    <span class="comment">// create an InitialContext</span>
    <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
    properties.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.wildfly.naming.client.WildFlyInitialContextFactory</span><span class="delimiter">&quot;</span></span>);
    properties.put(<span class="predefined-type">Context</span>.PROVIDER_URL, <span class="string"><span class="delimiter">&quot;</span><span class="content">remote+http://127.0.0.1:8080</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">InitialContext</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(properties);
<span class="error"> </span>
    <span class="comment">// look up an EJB and invoke one of its methods (same as before)</span>
    RemoteCalculator statelessRemoteCalculator = (RemoteCalculator) context.lookup(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:/ejb-remote-server-side//CalculatorBean!</span><span class="delimiter">&quot;</span></span> + RemoteCalculator.class.getName());
    <span class="type">int</span> sum = statelessRemoteCalculator.add(<span class="integer">101</span>, <span class="integer">202</span>);
    ...
    return <span class="predefined-constant">null</span>;
};
<span class="error"> </span>
<span class="comment">// use your authentication context to run your callable</span>
context.runCallable(callable);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="general-utilities">13.10. General Utilities</h3>

</div>
<div class="sect2">
<h3 id="Security_Vault_Migration">13.11. Security Vault Migration</h3>
<div class="paragraph">
<p>Security Vault is primarily used in legacy configurations, a vault is
used to store sensitive strings outside of the configuration files.
WildFly server may only contain a single security vault.</p>
</div>
<div class="paragraph">
<p>Credential Store introduced in WildFly 11 is meant to expand Security
Vault in terms of storing different credential types and introduce easy
to implemnent SPI which allows to deploy custom implemenations of
CredentialStore SPI. Credentials are stored safely encrypted in storage
file outside WildFly configuration files. Each WildFly server may
contain multiple credential stores.</p>
</div>
<div class="paragraph">
<p>To easily migrate vault content into credential store we have added
"vault" command into WildFly Elytron Tool. The tool could be found at
$JBOSS_HOME/bin directory. It has several scripts named "elytron-tool.*"
dependent on your platform of choice. One can use also simple form "java
-jar $JBOSS_HOME/bin/wildfly-elytron-tool.jar &lt;command&gt; &lt;arguments&gt;" if
it better suites ones needs.</p>
</div>
<div class="sect3">
<h4 id="single-security-vault-conversion">13.11.1. Single Security Vault Conversion</h4>
<div class="paragraph">
<p>To convert <strong>single</strong> security vault credential store use following
example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to get sample vault use testing resources of Elytron Tool project from
<a href="https://github.com/wildfly-security/wildfly-elytron-tool/tree/master/src/test/resources/vault-v1">GitHub</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Command to run actual conversion:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>./bin/elytron-tool.sh vault --enc-dir vault_data/ --keystore vault-jceks.keystore --keystore-password MASK-2hKo56F1a3jYGnJwhPmiF5 --iteration 34 --salt 12345678 --alias test --location cs-v1.store --summary</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>Vault (enc-dir="vault_data/";keystore="vault-jceks.keystore") converted to credential store "cs-v1.store"</code><br>
<code>Vault Conversion summary:</code><br>
<code>--------------------------------------</code><br>
<code>Vault Conversion Successful</code><br>
<code>CLI command to add new credential store:</code><br>
<code>/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,create=true,modifiable=true,location="cs-v1.store",implementation-properties={"keyStoreType"&#8658;"JCEKS"},credential-reference={clear-text="MASK-2hKo56F1a3jYGnJwhPmiF5;12345678;34"})</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Use elytron-tool.sh vault --help to get description of all parameters.</p>
</div>
<div class="sect4">
<h5 id="notes">Notes:</h5>
<div class="ulist">
<ul>
<li>
<p>Elytron Tool cannot handle very first version of Security Vault data
file.<br></p>
</li>
<li>
<p>--keystore-password can come in two forms (1) masked as shown in the
example or (2) clear text. Parameter --salt and --iteration are there to
supply information to decrypt the masked password or to generate masked
password in output. In case --salt and --iteration are omitted default
values are used.<br></p>
</li>
<li>
<p>When --summary parameter is specified, one can see nice output with
CLI command to be used in WildFly console to add converted credential
store to the configuration.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bulk-security-vault-conversion">13.11.2. Bulk Security Vault Conversion</h4>
<div class="paragraph">
<p>There is possibility to convert multiple vaults to credential store
using --bulk-convert parameter with description file.<br>
Example of description file from our <a href="https://github.com/wildfly-security/wildfly-elytron-tool/blob/master/src/test/java/org/wildfly/security/tool/VaultCommandTest.java">tests</a>:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code># Bulk conversion descriptor</code><br>
<code>keystore:target/test-classes/vault-v1/vault-jceks.keystore</code><br>
<code>keystore-password:MASK-2hKo56F1a3jYGnJwhPmiF5</code><br>
<code>enc-dir:target/test-classes/vault-v1/vault_data/</code><br>
<code>salt:12345678</code><br>
<code>iteration:34</code><br>
<code>location:target/v1-cs-1.store</code><br>
<code>alias:test</code></p>
</div>
<div class="paragraph">
<p><code>keystore:target/test-classes/vault-v1/vault-jceks.keystore</code><br>
<code>keystore-password:secretsecret</code><br>
<code>enc-dir:target/test-classes/vault-v1/vault_data/</code><br>
<code>location:target/v1-cs-2.store</code><br>
<code>alias:test</code></p>
</div>
<div class="paragraph">
<p><code># different vault vault-v1-more</code><br>
<code>keystore:target/test-classes/vault-v1-more/vault-jceks.keystore</code><br>
<code>keystore-password:MASK-2hKo56F1a3jYGnJwhPmiF5</code><br>
<code>enc-dir:target/test-classes/vault-v1-more/vault_data/</code><br>
<code>salt:12345678</code><br>
<code>iteration:34</code><br>
<code>location:target/v1-cs-more.store</code><br>
<code>alias:test</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>After each "keystore:" option new conversion starts. All options are
mandatory except "salt:", "iteration:" and "properties:"</p>
</div>
<div class="paragraph">
<p>Execute following command:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>./bin/elytron-tool.sh vault --bulk-convert bulk-vault-conversion-desc --summary</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>Vault (enc-dir="vault-v1/vault_data/";keystore="vault-v1/vault-jceks.keystore") converted to credential store "v1-cs-1.store"</code><br>
<code>Vault Conversion summary:</code><br>
<code>--------------------------------------</code><br>
<code>Vault Conversion Successful</code><br>
<code>CLI command to add new credential store:</code><br>
<code>/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,create=true,modifiable=true,location="v1-cs-1.store",implementation-properties={"keyStoreType"&#8658;"JCEKS"},credential-reference={clear-text="MASK-2hKo56F1a3jYGnJwhPmiF5;12345678;34"})</code><br>
<code>--------------------------------------</code></p>
</div>
<div class="paragraph">
<p><code>Vault (enc-dir="vault-v1/vault_data/";keystore="vault-v1/vault-jceks.keystore") converted to credential store "v1-cs-2.store"</code><br>
<code>Vault Conversion summary:</code><br>
<code>--------------------------------------</code><br>
<code>Vault Conversion Successful</code><br>
<code>CLI command to add new credential store:</code><br>
<code>/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,create=true,modifiable=true,location="v1-cs-2.store",implementation-properties={"keyStoreType"&#8658;"JCEKS"},credential-reference={clear-text="secretsecret"})</code><br>
<code>--------------------------------------</code></p>
</div>
<div class="paragraph">
<p><code>Vault (enc-dir="vault-v1-more/vault_data/";keystore="vault-v1-more/vault-jceks.keystore") converted to credential store "v1-cs-more.store"</code><br>
<code>Vault Conversion summary:</code><br>
<code>--------------------------------------</code><br>
<code>Vault Conversion Successful</code><br>
<code>CLI command to add new credential store:</code><br>
<code>/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,create=true,modifiable=true,location="v1-cs-more.store",implementation-properties={"keyStoreType"&#8658;"JCEKS"},credential-reference={clear-text="MASK-2hKo56F1a3jYGnJwhPmiF5;12345678;34"})</code><br>
<code>--------------------------------------</code></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The result is conversion of all vaults with proper CLI commands.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Security_Property_Migration">13.12. Security Properties</h3>
<div class="paragraph">
<p>Lets suppose security properties "a" and "c" defined in legacy security:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:security:2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            ...
            <span class="tag">&lt;security-properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/security-properties&gt;</span>
        <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To define security properties in Elytron subsystem you need to set
attribute <code>security-properties</code> of the subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=<span class="key">elytron</span>:write-attribute(name=security-properties, value={ \
    a = <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>, \
    c = <span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span> \
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add or change one another property without modification of
others using map operations. Following command will set property "e":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=<span class="key">elytron</span>:map-put(name=security-properties, key=e, value=f)</code></pre>
</div>
</div>
<div class="paragraph">
<p>By the same way you can also remove one of properties - in example newly
created property "e":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">./subsystem=<span class="key">elytron</span>:map-remove(name=security-properties, key=e)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output XML configuration will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;security-properties&gt;</span>
                <span class="tag">&lt;security-property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;security-property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/security-properties&gt;</span>
            ...
        <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ssl-migration">13.13. SSL Migration</h3>

</div>
<div class="sect2">
<h3 id="Simple_SSL_Migration">13.14. Simple SSL Migration</h3>
<div class="sect3">
<h4 id="simple-ssl-migration">13.14.1. Simple SSL Migration</h4>
<div class="paragraph">
<p>This section describe securing HTTP connections to the server using SSL
using Elytron.<br>
It suppose you have already configured SSL using legacy
<code>security-realm</code>, for example by
<a href="Admin_Guide.html#src-557075_AdminGuide-EnableSSL">Admin Guide#Enable
SSL</a>, and your configuration looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;server-identities&gt;</span>
    <span class="tag">&lt;ssl&gt;</span>
      <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.keystore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">key_password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/ssl&gt;</span>
  <span class="tag">&lt;/server-identities&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To switch to Elytron you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create Elytron <code>key-store</code> - specifying where is the keystore file
stored and password by which it is encrypted. Default type of keystore
generated using keytool is JKS:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">LocalhostKeyStore</span>:add(path=server.keystore,relative-to=jboss.server.config.dir,credential-reference={clear-text=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_password</span><span class="delimiter">&quot;</span></span>},type=<span class="constant">JKS</span>)</code></pre>
</div>
</div>
</li>
<li>
<p>Create Elytron <code>key-manager</code> - specifying keystore, alias (using
<code>alias-filter</code>) and password of key:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-manager=<span class="key">LocalhostKeyManager</span>:add(key-store=<span class="constant">LocalhostKeyStore</span>,<span class="keyword">alias</span>-filter=server,credential-reference={clear-text=<span class="string"><span class="delimiter">&quot;</span><span class="content">key_password</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
</li>
<li>
<p>Create Elytron <code>server-ssl-context</code> - specifying only reference to
<code>key-manager</code> defined above:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">LocalhostSslContext</span>:add(key-manager=<span class="constant">LocalhostKeyManager</span>)</code></pre>
</div>
</div>
</li>
<li>
<p>Switch <code>https-listener</code> from legacy <code>security-realm</code> to newly
created Elytron <code>ssl-context</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:undefine-attribute(name=security-realm)
<span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=undertow</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver=default-server/https-listener=<span class="key">https</span>:write-attribute(name=ssl-context,value=<span class="constant">LocalhostSslContext</span>)</code></pre>
</div>
</div>
</li>
<li>
<p>And reload the server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Output XML configuration of Elytron subsystem should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
            ...
            <span class="tag">&lt;tls&gt;</span>
                <span class="tag">&lt;key-stores&gt;</span>
                    <span class="tag">&lt;key-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_password</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;implementation</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JKS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.keystore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/key-store&gt;</span>
                <span class="tag">&lt;/key-stores&gt;</span>
                <span class="tag">&lt;key-managers&gt;</span>
                    <span class="tag">&lt;key-manager</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-store</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">key_password</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/key-manager&gt;</span>
                <span class="tag">&lt;/key-managers&gt;</span>
                <span class="tag">&lt;server-ssl-contexts&gt;</span>
                    <span class="tag">&lt;server-ssl-context</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostSslContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/server-ssl-contexts&gt;</span>
            <span class="tag">&lt;/tls&gt;</span>
        <span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Output <code>https-listener</code> in Undertow subsystem should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https-listener</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ssl-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostSslContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enable-http2</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="client-cert-ssl-authentication-migration">13.14.2. Client-Cert SSL Authentication Migration</h4>
<div class="paragraph">
<p>This suppose you have already configured Client-Cert SSL authentication
using <code>truststore</code> in legacy <code>security-realm</code>, for example by
<a href="Admin_Guide.html#src-557075_AdminGuide-AddClient-CerttoSSL">Admin
Guide#Add Client-Cert to SSL</a>, and your configuration looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;server-identities&gt;</span>
    <span class="tag">&lt;ssl&gt;</span>
      <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.keystore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">key_password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/ssl&gt;</span>
  <span class="tag">&lt;/server-identities&gt;</span>
  <span class="tag">&lt;authentication&gt;</span>
    <span class="tag">&lt;truststore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.truststore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;local</span> <span class="attribute-name">default-user</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Following configuration is sufficient to prevent users without valid
certificate and private key to access the server, but it does not
provide user identity to the application. That require to define
<code>CLIENT_CERT</code> HTTP mechanism / <code>EXTERNAL</code> SASL mechanism, which will be
described later.)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At first use steps above to migrate basic part of the configuration.
Then continue by following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create <code>key-store</code> of truststore - like for keystore above:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>key-store=<span class="key">TrustStore</span>:add(path=server.truststore,relative-to=jboss.server.config.dir,credential-reference={clear-text=<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_password</span><span class="delimiter">&quot;</span></span>},type=<span class="constant">JKS</span>)</code></pre>
</div>
</div>
</li>
<li>
<p>Create <code>trust-manager</code> - specifying <code>key-store</code> of trustore, created
above:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span></span>trust-manager=<span class="key">TrustManager</span>:add(key-store=<span class="constant">TrustStore</span>)</code></pre>
</div>
</div>
</li>
<li>
<p>Modify <code>server-ssl-context</code> to use newly created trustmanager:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">LocalhostSslContext</span>:write-attribute(name=trust-manager,value=<span class="constant">TrustManager</span>)</code></pre>
</div>
</div>
</li>
<li>
<p>Enable client authentication for <code>server-ssl-context</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="regexp"><span class="delimiter">/</span><span class="content">subsystem=elytron</span><span class="delimiter">/</span><span class="modifier">se</span></span>rver-ssl-context=<span class="key">LocalhostSslContext</span>:write-attribute(name=need-client-auth,value=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</li>
<li>
<p>And reload the server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">reload</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Output XML configuration of Elytron subsystem should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;tls&gt;</span>
        <span class="tag">&lt;key-stores&gt;</span>
            <span class="tag">&lt;key-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_password</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;implementation</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JKS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.keystore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/key-store&gt;</span>
            <span class="tag">&lt;key-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_password</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;implementation</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JKS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.truststore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/key-store&gt;</span>
        <span class="tag">&lt;/key-stores&gt;</span>
        <span class="tag">&lt;key-managers&gt;</span>
            <span class="tag">&lt;key-manager</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-store</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyStore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias-filter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">key_password</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/key-manager&gt;</span>
        <span class="tag">&lt;/key-managers&gt;</span>
        <span class="tag">&lt;trust-managers&gt;</span>
            <span class="tag">&lt;trust-manager</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-store</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustStore</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/trust-managers&gt;</span>
        <span class="tag">&lt;server-ssl-contexts&gt;</span>
            <span class="tag">&lt;server-ssl-context</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostSslContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">need-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">trust-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/server-ssl-contexts&gt;</span>
    <span class="tag">&lt;/tls&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="SSL_with_Client_Cert_Migration">13.15. SSL with Client Cert Migration</h3>
<div class="paragraph">
<p>As this documentation is primarily intended for users migrating to WildFly Elytron I am going to jump straight into the configuration required with WildFly Elytron.</p>
</div>
<div class="paragraph">
<p>This section will cover how to create the various resources required to achieve CLIENT_CERT authentication with fallback to username / password authentication for both HTTP and SASL (i.e. Remoting) - both are being covered at the same time as predominantly they require the same core configuration, it is not until the definition of the authentication factories that the configuration becomes really specific.</p>
</div>
<div class="paragraph">
<p>This suppose you have configured legacy Client-Cert SSL authentication using <code>truststore</code> in legacy <code>security-realm</code>, for example by <a href="Admin_Guide.html#src-557075_AdminGuide-AddClient-CerttoSSL">Admin Guide#Add Client-Cert to SSL</a>, and your configuration looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;server-identities&gt;</span>
    <span class="tag">&lt;ssl&gt;</span>
      <span class="tag">&lt;keystore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.keystore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">key_password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/ssl&gt;</span>
  <span class="tag">&lt;/server-identities&gt;</span>
  <span class="tag">&lt;authentication&gt;</span>
    <span class="tag">&lt;truststore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.truststore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystore-password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;local</span> <span class="attribute-name">default-user</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mgmt-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/authentication&gt;</span>
<span class="tag">&lt;/security-realm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This also suppose you have already followed <a href="Simple_SSL_Migration.adoc">Simple SSL Migration</a> section, so your partialy migrated configuration looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;tls&gt;</span>
        <span class="tag">&lt;key-stores&gt;</span>
            <span class="tag">&lt;key-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_password</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;implementation</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JKS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.keystore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/key-store&gt;</span>
            <span class="tag">&lt;key-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_password</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;implementation</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JKS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server.truststore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/key-store&gt;</span>
        <span class="tag">&lt;/key-stores&gt;</span>
        <span class="tag">&lt;key-managers&gt;</span>
            <span class="tag">&lt;key-manager</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-store</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyStore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias-filter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;credential-reference</span> <span class="attribute-name">clear-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">key_password</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/key-manager&gt;</span>
        <span class="tag">&lt;/key-managers&gt;</span>
        <span class="tag">&lt;trust-managers&gt;</span>
            <span class="tag">&lt;trust-manager</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-store</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustStore</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/trust-managers&gt;</span>
        <span class="tag">&lt;server-ssl-contexts&gt;</span>
            <span class="tag">&lt;server-ssl-context</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostSslContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">need-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">trust-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/server-ssl-contexts&gt;</span>
    <span class="tag">&lt;/tls&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However following steps are needed to be user identity provided to your applications or management console.</p>
</div>
<div class="sect3">
<h4 id="realms-and-domains">13.15.1. Realms and Domains</h4>
<div class="paragraph">
<p>We use users stored in standard properties files, so we can predefined Elytron security domain <code>ManagementDomain</code> and realm <code>ManagementRealm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;security-domains&gt;</span>
        <span class="tag">&lt;security-domain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementDomain</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-realm</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">permission-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-permission-mapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role-decoder</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groups-to-roles</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/security-domain&gt;</span>
    <span class="tag">&lt;/security-domains&gt;</span>
    <span class="tag">&lt;security-realms&gt;</span>
        <span class="tag">&lt;properties-realm</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;users-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mgmt-users.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">digest-realm-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;groups-properties</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mgmt-groups.properties</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.config.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/properties-realm&gt;</span>
    <span class="tag">&lt;/security-realms&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The security realm will be used in two situations:
* Authentication in password fallback case, when certificate authentication fails
* Authorization in both - password and certificate auth - cases - the realm will provide roles of individual users</p>
</div>
<div class="paragraph">
<p>This mean, for any client certificate there have to exists user in the security realm.</p>
</div>
</div>
<div class="sect3">
<h4 id="principal-decoder">13.15.2. Principal decoder</h4>
<div class="paragraph">
<p>When certificate authentication is used and the security realm accepts usernames to resolve an identity, there have to be defined way to obtain username from a client certificate.
In this case we will use first CN attribute in certificate subject:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./subsystem=elytron/x500-attribute-principal-decoder=x500-decoder:add(attribute-name=CN, maximum-segments=1)</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;mappers&gt;</span>
    ...
    <span class="tag">&lt;x500-attribute-principal-decoder</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x500-decoder</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">attribute-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maximum-segments</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
  <span class="tag">&lt;/mappers&gt;</span>
  ...
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-authentication-factory">13.15.3. HTTP Authentication Factory</h4>
<div class="paragraph">
<p>For the HTTP connections we now define a HTTP authentication factory using the previously defined resources and it is configured to support CLIENT_CERT and DIGEST authentication.</p>
</div>
<div class="paragraph">
<p>Because our security realm is not able to verify client certificates (properties realm verifies passwords only), we need to add configuring mechanism factory first, which will disable certificate verification against the security realm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/subsystem=elytron/configurable-http-server-mechanism-factory=configured-cert:add(http-server-mechanism-factory=global, properties={org.wildfly.security.http.skip-certificate-verification=true})</pre>
</div>
</div>
<div class="paragraph">
<p>As following, we can create HTTP authentication alone:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./subsystem=elytron/http-authentication-factory=client-cert-digest:add(http-server-mechanism-factory=configured-cert, \
  security-domain=ManagementDomain, \
 mechanism-configurations=[{ \
  mechanism-name=CLIENT_CERT, \
  pre-realm-principal-transformer=x500-decoder}, \
 {mechanism-name=DIGEST, mechanism-realm-configurations=[{realm-name=ManagementRealm}]}])</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;subsystem xmlns="urn:wildfly:elytron:1.1" final-providers="combined-providers" disallowed-providers="OracleUcrypto"&gt;
  ...
  &lt;http&gt;
    ...
    &lt;http-authentication-factory name="client-cert-digest" http-server-mechanism-factory="global" security-domain="ManagementDomain"&gt;
      &lt;mechanism-configuration&gt;
        &lt;mechanism mechanism-name="CLIENT_CERT" pre-realm-principal-transformer="x500-decoder"/&gt;
        &lt;mechanism mechanism-name="DIGEST"&gt;
          &lt;mechanism-realm realm-name="ManagementRealm"/&gt;
        &lt;/mechanism&gt;
      &lt;/mechanism-configuration&gt;
    &lt;/http-authentication-factory&gt;
    ...
    &lt;configurable-http-server-mechanism-factory name="configured-cert" http-server-mechanism-factory="global"&gt;
        &lt;properties&gt;
            &lt;property name="org.wildfly.security.http.skip-certificate-verification" value="true"/&gt;
        &lt;/properties&gt;
    &lt;/configurable-http-server-mechanism-factory&gt;
    ...
  &lt;/http&gt;
  ...
&lt;/subsystem&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sasl-authentication-factory">13.15.4. SASL Authentication Factory</h4>
<div class="paragraph">
<p>The architecture of the two authentication factories if very similar so a SASL authentication factory can be defined in the same way as the HTTP equivalent.
However, as EXTERNAL SASL mechanism does not do any certificate verification, there is no need for configuring SASL server factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./subsystem=elytron/sasl-authentication-factory=client-cert-digest:add(sasl-server-factory=elytron, \
  security-domain=ManagementDomain, \
  mechanism-configurations=[{mechanism-name=EXTERNAL, \
  pre-realm-principal-transformer=x500-decoder}, \
  {mechanism-name=DIGEST-MD5, mechanism-realm-configurations=[{realm-name=ManagementRealm}]}])</pre>
</div>
</div>
<div class="paragraph">
<p>This results in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;sasl&gt;</span>
    ...
    <span class="tag">&lt;sasl-authentication-factory</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client-cert-digest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">sasl-server-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">elytron</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">security-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementDomain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;mechanism-configuration&gt;</span>
        <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EXTERNAL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pre-realm-principal-transformer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x500-decoder</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;mechanism</span> <span class="attribute-name">mechanism-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DIGEST-MD5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;mechanism-realm</span> <span class="attribute-name">realm-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagementRealm</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/mechanism&gt;</span>
      <span class="tag">&lt;/mechanism-configuration&gt;</span>
    <span class="tag">&lt;/sasl-authentication-factory&gt;</span>
    ...
  <span class="tag">&lt;/sasl&gt;</span>
  ...
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is used the same principal transformer as defined for HTTP.</p>
</div>
</div>
<div class="sect3">
<h4 id="ssl-context">13.15.5. SSL Context</h4>
<div class="paragraph">
<p>The SSL context was already defined, but we need to modify it to not fail on client certificate authentication failure, but to fallback to password authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./subsystem=elytron/server-ssl-context=LocalhostSslContext:write-attribute(name=need-client-auth, value=false)
./subsystem=elytron/server-ssl-context=LocalhostSslContext:write-attribute(name=want-client-auth, value=true)</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:wildfly:elytron:1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">final-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined-providers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disallowed-providers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OracleUcrypto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;tls&gt;</span>
    ...
    <span class="tag">&lt;server-ssl-contexts&gt;</span>
      <span class="tag">&lt;server-ssl-context</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostSslContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">want-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">need-client-auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostKeyManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">trust-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TrustManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/server-ssl-contexts&gt;</span>
  <span class="tag">&lt;/tls&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we will be supporting fallback to username/password authentication need-client-auth is set to false. This allows connections to be established but an alternative form of authentication will be required.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-for-management">13.15.6. Using for Management</h4>
<div class="paragraph">
<p>At this point the management interfaces can be updated to use the newly defined resources, we need to add references to the two new authentication factories and the SSL context, we can also remove the existing reference to the legacy security realm. As this is modifying existing interfaces a server reload will also be required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./core-service=management/management-interface=http-interface:write-attribute(name=ssl-context, value=LocalhostSslContext)
./core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)
./core-service=management/management-interface=http-interface:write-attribute(name=http-authentication-factory, value=client-cert-digest)
./core-service=management/management-interface=http-interface:write-attribute(name=http-upgrade.sasl-authentication-factory, value=client-cert-digest)
./core-service=management/management-interface=http-interface:undefine-attribute(name=security-realm)
:reload</pre>
</div>
</div>
<div class="paragraph">
<p>The management interface configuration then becomes: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;management&gt;</span>
  ...
  <span class="tag">&lt;management-interfaces&gt;</span>
    <span class="tag">&lt;http-interface</span> <span class="attribute-name">http-authentication-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client-cert-digest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ssl-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LocalhostSslContext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http-upgrade</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">sasl-authentication-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client-cert-digest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;socket-binding</span> <span class="attribute-name">http</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">management-http</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">https</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">management-https</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http-interface&gt;</span>
  <span class="tag">&lt;/management-interfaces&gt;</span>
  ...
<span class="tag">&lt;/management&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="admin-clients">Admin Clients</h5>
<div class="paragraph">
<p>At this stage assuming the same files have been used as in this example it should be possible to connect to the management interface of the server either using a web browser or the JBoss CLI with username and password from your original <code>mgmt-users.properties</code> file.</p>
</div>
<div class="paragraph">
<p>For certificate based authentication certificates signed by your CA, whose subject DN resolves to username existing in properties realm will be accepted.</p>
</div>
<div class="sect5">
<h6 id="cli-client-configuration">CLI Client Configuration</h6>
<div class="paragraph">
<p>This suppose you have used following configuration in <code>bin/jboss-cli.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ssl&gt;</span>
  <span class="tag">&lt;alias&gt;</span>adminalias<span class="tag">&lt;/alias&gt;</span>
  <span class="tag">&lt;key-store&gt;</span>admin.keystore<span class="tag">&lt;/key-store&gt;</span>
  <span class="tag">&lt;key-store-password&gt;</span>keystore_password<span class="tag">&lt;/key-store-password&gt;</span>
  <span class="tag">&lt;trust-store&gt;</span>ca.truststore<span class="tag">&lt;/trust-store&gt;</span>
  <span class="tag">&lt;trust-store-password&gt;</span>truststore_password<span class="tag">&lt;/trust-store-password&gt;</span>
<span class="tag">&lt;/ssl&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can stay using this configuration, but since the integration of WildFly Elytron it is possible with the CLI to use a configuration file wildfly-config.xml to define the security settings including the settings for the client side SSL context.</p>
</div>
<div class="paragraph">
<p>In such case, following wildfly-config.xml can be created in the location the JBoss CLI is being started from: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;authentication-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:elytron:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;key-stores&gt;</span>
            <span class="tag">&lt;key-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jks</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
                <span class="tag">&lt;file</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin.keystore</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;key-store-clear-password</span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore_password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/key-store&gt;</span>
            <span class="tag">&lt;key-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ca</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jks</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;file</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ca.truststore</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;key-store-clear-password</span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">truststore_password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/key-store&gt;</span>
        <span class="tag">&lt;/key-stores&gt;</span>
        <span class="tag">&lt;ssl-context-rules&gt;</span>
            <span class="tag">&lt;rule</span> <span class="attribute-name">use-ssl-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/ssl-context-rules&gt;</span>
        <span class="tag">&lt;ssl-contexts&gt;</span>
            <span class="tag">&lt;ssl-context</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;key-store-ssl-certificate</span> <span class="attribute-name">key-store-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">adminalias</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;key-store-clear-password</span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">key_password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;/key-store-ssl-certificate&gt;</span>
                <span class="tag">&lt;trust-store</span> <span class="attribute-name">key-store-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ca</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/ssl-context&gt;</span>
        <span class="tag">&lt;/ssl-contexts&gt;</span>
    <span class="tag">&lt;/authentication-client&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The CLI can now be started using the following command: -</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./jboss-cli.sh -c -Dwildfly.config.url=wildfly-config.xml</pre>
</div>
</div>
<div class="paragraph">
<p>The :whoami command can be used within the CLI to double check the current identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9993 /] :whoami(verbose=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "identity" =&gt; {"username" =&gt; "admin"},
        "mapped-roles" =&gt; ["SuperUser"]
    }
}</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="documentation-still-needed">13.16. Documentation Still Needed</h3>
<div class="ulist">
<ul>
<li>
<p>How to migrate application which uses different identity store for
authentication and authorization (migration to Elytron aggregate-realm).</p>
</li>
<li>
<p>How migrate to using cache (migration to caching-realm)</p>
</li>
<li>
<p>Limitations for migration from PicketBox/legacy security to Elytron,
for example, Infinispan cache cannot be used, any others?</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 14.0.0.Beta2<br>
Last updated 2018-08-15 10:46:40 PDT
</div>
</div>
</body>
</html>